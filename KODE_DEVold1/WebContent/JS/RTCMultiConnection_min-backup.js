function getName(e){participants=e}function getS(e){alert(e),sessionStorage.setItem("hello",e)}function getVideoId(){return participants+"-asdf123zwx"}function getdata(){hashmapforuserid[useridforusers]=participants;for(var e in hashmapforuserid)hashmapforuserid.hasOwnProperty(e)&&(reconnectuser=hashmapforuserid[e],console.log("Key is: "+e+". Value is: "+hashmapforuserid[e]),console.log("manish writing code for timer"),-1===array.indexOf(hashmapforuserid[e]+" , ")?array.push(hashmapforuserid[e]+" , "):console.log("This item already exists"),customFunctionForUpdateList(),customFunctionForUserCount(),console.log("nameee="+array),customUserName())}function myDelete(e){$.each(array,function(t){return array[t]===e?(array.splice(t,1),!1):void 0})}function customFunctionForUpdateList(){$("#abc").html(array)}function customFunctionForUserCount(){$("#count").html("# of Users : "+array.length)}function customUserName(){$("#b").html("Users name :")}function getName(e){participants=e}function getS(e){alert(e),sessionStorage.setItem("hello",e)}function getVideoId(){return participants+"-asdf123zwx"}function getdata(){hashmapforuserid[useridforusers]=participants;for(var e in hashmapforuserid)hashmapforuserid.hasOwnProperty(e)&&(reconnectuser=hashmapforuserid[e],console.log("Key is: "+e+". Value is: "+hashmapforuserid[e]),console.log("manish writing code for timer"),-1===array.indexOf(hashmapforuserid[e]+" , ")?array.push(hashmapforuserid[e]+" , "):console.log("This item already exists"),customFunctionForUpdateList(),customFunctionForUserCount(),console.log("nameee="+array),customUserName())}function myDelete(e){$.each(array,function(t){return array[t]===e?(array.splice(t,1),!1):void 0})}function customFunctionForUpdateList(){$("#abc").html(array)}function customFunctionForUserCount(){$("#count").html("# of Users : "+array.length)}function customUserName(){$("#b").html("Users name :")}var participants,reconnectuser,hashmapforuserid={},useridforusers,array=[];!function(){function e(e,t){function u(t){return t.data.checkingPresence&&e.channels[t.userid]?void e.channels[t.userid].send({presenceDetected:!0}):t.data.presenceDetected&&e.peers[t.userid]?void(e.peers[t.userid].connected=!0):void("text"===t.data.type?ee.receive(t.data,t.userid,t.extra):e.autoTranslateText?(t.original=t.data,e.Translator.TranslateText(t.data,function(n){t.data=n,e.onmessage(t)})):e.onmessage(t))}function R(t){return e.skipOnNewSession||(t.session||(t.session={}),t.extra||(t.extra={}),e.sessionid&&t.sessionid!=e.sessionid)?void 0:e.onNewSession?(t.join=function(n){if(!n)return e.join(t);for(var i in n)t.session[i]=n[i];var o=e.dontCaptureUserMedia;e.dontCaptureUserMedia=!1,e.captureUserMedia(function(){e.dontCaptureUserMedia=!0,e.join(t),e.dontCaptureUserMedia=o},n)},t.extra||(t.extra={}),e.onNewSession(t)):void e.join(t)}function D(t){for(var n=0;n<e.localStreamids.length;n++){var i=e.localStreamids[n];e.streams[i]&&e.streams[i].sockets.push(t)}}function O(t){function n(t){return W||j||o(e.waitUntilRemoteStreamStartsFlowing)||!e.waitUntilRemoteStreamStartsFlowing?l(t):(t.numberOfTimes||(t.numberOfTimes=0),t.numberOfTimes++,t.mediaElement.readyState<=HTMLMediaElement.HAVE_CURRENT_DATA||t.mediaElement.paused||t.mediaElement.currentTime<=0?t.numberOfTimes>=60?F.send({failedToReceiveRemoteVideo:!0,streamid:t.stream.streamid}):void setTimeout(function(){m("Waiting for incoming remote stream to be started flowing: "+t.numberOfTimes+" seconds."),n(t)},900):l(t))}function d(){if(e.fakeDataChannels&&!e.channels[t.userid]&&!e.session.data){var n={send:function(e){F.send({fakeData:e})},readyState:"open"};e.channels[t.userid]={channel:n,send:function(e){this.channel.send(e)}},_.onopen(n)}}function l(n){var i=n.mediaElement,o=n.session,r=n.stream;r.onended=function(){a.mediaElement&&!a.mediaElement.parentNode&&document.getElementById(r.streamid)&&(a.mediaElement=document.getElementById(r.streamid)),g(a,e)};var a={mediaElement:i,stream:r,streamid:r.streamid,session:o||e.session,blobURL:j?"":i.mozSrcObject?URL.createObjectURL(r):i.src,type:"remote",extra:t.extra,userid:t.userid,isVideo:j?!!o.video:!!r.isVideo,isAudio:j?!!o.audio&&!o.video:!!r.isAudio,isScreen:!!r.isScreen,isInitiator:!!t.isInitiator,rtcMultiConnection:e,socket:F};if(e.streams[r.streamid]=e._getStream(a),e.onstream(a),!s(n.preMuted)&&(n.preMuted.audio||n.preMuted.video)){var d=b({},a);d.session=b(d.session,n.preMuted),d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!1,e.onmute(d)}m("on:add:stream",a),R(),e.onspeaking&&M({stream:r,streamedObject:a,connection:e})}function C(n){t.channel=n,e.channels[t.userid]={channel:t.channel,send:function(t){e.send(t,this.channel)}},e.onopen({extra:t.extra,userid:t.userid,channel:n});for(var o in e.fileQueue)e.send(e.fileQueue[o],n);i(e.session)&&R(),e.partOfScreen&&e.partOfScreen.sharing&&e.peers[t.userid].sharePartOfScreen(e.partOfScreen)}function x(){F.userid!=t.userid&&(F.userid=t.userid,Q[t.socketIndex]=F,e.numberOfConnectedUsers++,e.peers[t.userid]={socket:F,peer:L,userid:t.userid,extra:t.extra,userinfo:t.userinfo,addStream:function(t){e.addStream(t,this.socket)},removeStream:function(t){return e.streams[t]?(this.peer.connection.removeStream(e.streams[t].stream),void this.renegotiate()):p("No such stream exists. Stream-id:",t)},renegotiate:function(t,n){e.renegotiate(t,n)},changeBandwidth:function(e){if(!e)throw"You MUST pass bandwidth object.";if(r(e))throw"Pass object for bandwidth instead of string; e.g. {audio:10, video:20}";this.peer.bandwidth=e,this.socket.send({changeBandwidth:!0,bandwidth:e})},sendCustomMessage:function(e){this.socket.send({customMessage:!0,message:e})},onCustomMessage:function(e){m('Received "private" message from',this.userid,r(e)?e:f(e))},drop:function(t){for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],n.userid==e.userid&&"local"==n.type&&(this.peer.connection.removeStream(n.stream),g(n,e)),"remote"==n.type&&n.userid==this.userid&&g(n,e));!t&&this.socket.send({drop:!0})},hold:function(t){return"answer"==L.prevCreateType?void this.socket.send({unhold:!0,holdMLine:t||"both",takeAction:!0}):(this.socket.send({hold:!0,holdMLine:t||"both"}),this.peer.hold=!0,void this.fireHoldUnHoldEvents({kind:t,isHold:!0,userid:e.userid,remoteUser:this.userid}))},unhold:function(t){return"answer"==L.prevCreateType?void this.socket.send({unhold:!0,holdMLine:t||"both",takeAction:!0}):(this.socket.send({unhold:!0,holdMLine:t||"both"}),this.peer.hold=!1,void this.fireHoldUnHoldEvents({kind:t,isHold:!1,userid:e.userid,remoteUser:this.userid}))},fireHoldUnHoldEvents:function(t){var n=t.isHold,i=t.kind,o=t.remoteUser||t.userid;for(var r in e.streams)-1==e._skip.indexOf(r)&&(r=e.streams[r],r.userid==o&&(n&&e.onhold(b({kind:i},r)),n||e.onunhold(b({kind:i},r))))},redial:function(){for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],t.userid==this.userid&&"remote"==t.type&&g(t,e));m("ReDialing..."),F.send({recreatePeer:!0}),L=new E,L.create("offer",_)},sharePartOfScreen:function(t){function n(){return i.stopPartOfScreenSharing?(i.stopPartOfScreenSharing=!1,void(e.onpartofscreenstopped&&e.onpartofscreenstopped())):i.pausePartOfScreenSharing?(e.onpartofscreenpaused&&e.onpartofscreenpaused(),setTimeout(n,t.interval||200)):void k({element:t.element,connection:e,callback:function(r){if(!e.channels[i.userid])throw"No such data channel exists.";r!=o&&(o=r,e.channels[i.userid].send({screenshot:r,isPartOfScreen:!0})),!t.once&&setTimeout(n,t.interval||200)}})}var i=this,o="";n()},getConnectionStats:function(t,n){function i(){re.prototype.getConnectionStats=window.getConnectionStats,L.connection&&L.connection.getConnectionStats(t,n)}if(!t)throw"callback is mandatory.";window.getConnectionStats?i():y(e.resources.getConnectionStats,i)},takeSnapshot:function(t){w({userid:this.userid,connection:e,callback:t})}})}function R(){if(e.isInitiator&&h(Z)&&h(Z)<=e.maxParticipantsAllowed&&(e.session.oneway||e.session.broadcast||te.send({sessionid:e.sessionid,newParticipant:t.userid||F.channel,userData:{userid:t.userid||F.channel,extra:t.extra}})),"chrome"==t.userinfo.browser&&!t.renegotiatedOnce)for(var n in e.renegotiatedSessions)t.renegotiatedOnce=!0,e.renegotiatedSessions[n]&&e.renegotiatedSessions[n].stream&&e.peers[t.userid].renegotiate(e.renegotiatedSessions[n].stream,e.renegotiatedSessions[n].session)}function O(n){if(!ne&&n.userid!=e.userid){if(n.sdp){t.userid=n.userid,t.extra=n.extra||{},t.renegotiate=n.renegotiate,t.streaminfo=n.streaminfo,t.isInitiator=n.isInitiator,t.userinfo=n.userinfo;var i=JSON.parse(n.sdp);"offer"==i.type&&(_.preferSCTP=!!n.preferSCTP,e.fakeDataChannels=!!n.fakeDataChannels),d(),I(i,n.labels)}if(n.candidate&&L&&L.addIceCandidate(JSON.parse(n.candidate)),n.streamid&&(X.streamids||(X.streamids={}),X.streamids[n.streamid]||(X.streamids[n.streamid]=n.streamid,e.onstreamid(n))),n.mute||n.unmute)if(n.promptMuteUnmute){if(!e.privileges.canMuteRemoteStream)return void e.onstatechange({userid:n.userid,extra:n.extra,name:"mute-request-denied",reason:n.userid+' tried to mute your stream; however "privileges.canMuteRemoteStream" is "false".'});e.streams[n.streamid]&&(n.mute&&!e.streams[n.streamid].muted&&e.streams[n.streamid].mute(n.session),n.unmute&&e.streams[n.streamid].muted&&e.streams[n.streamid].unmute(n.session))}else{var o={};e.streams[n.streamid]&&(o=e.streams[n.streamid]);var r=n.session,s=b({},o);s.session=r,s.isAudio=!!s.session.audio&&!s.session.video,s.isVideo=!!s.session.video,s.isScreen=!!s.session.screen,n.mute&&e.onmute(s||n),n.unmute&&e.onunmute(s||n)}if(n.isVolumeChanged&&(m("Volume of stream: "+n.streamid+" has changed to: "+n.volume),0==n.volume&&(n.volume=1),e.streams[n.streamid])){var a=e.streams[n.streamid].mediaElement;a&&(a.volume=n.volume)}if(n.stopped&&e.streams[n.streamid]&&g(e.streams[n.streamid],e),n.promptStreamStop){if(!e.privileges.canStopRemoteStream)return void e.onstatechange({userid:n.userid,extra:n.extra,name:"stop-request-denied",reason:n.userid+' tried to stop your stream; however "privileges.canStopRemoteStream" is "false".'});p("Remote stream has been manually stopped!"),e.streams[n.streamid]&&e.streams[n.streamid].stop()}if(n.left){if(N){var u=n.userid;for(var l in e.streams)l=e.streams[l],l.userid==u&&(e.stopMediaStream(l),g(l,e))}if(L&&L.connection&&("closed"!=L.connection.signalingState&&-1==L.connection.iceConnectionState.search(/disconnected|failed/gi)&&L.connection.close(),L.connection=null),Z[n.userid]&&delete Z[n.userid],n.closeEntireSession)return e.onSessionClosed(n),void e.leave();e.remove(n.userid),S({userid:n.userid,extra:n.extra||{},entireSessionClosed:!!n.closeEntireSession},e)}if(n.playRoleOfBroadcaster&&(n.extra&&(e.extra=b(e.extra,n.extra)),n.participants&&(Z=n.participants,Z[e.userid]&&delete Z[e.userid],Q[0]&&Q[0].userid==n.userid&&(delete Q[0],Q=c(Q)),K[n.userid]&&delete K[n.userid]),setTimeout(e.playRoleOfInitiator,2e3)),n.changeBandwidth){if(!e.peers[n.userid])throw"No such peer exists.";e.peers[n.userid].peer.bandwidth=n.bandwidth,e.peers[n.userid].renegotiate()}if(n.customMessage){if(!e.peers[n.userid])throw"No such peer exists.";if(n.message.ejected){if(e.sessionDescriptions[e.sessionid].userid!=n.userid)throw"only initiator can eject a user.";e.leave(),e.onSessionClosed({userid:n.userid,extra:n.extra||t.extra,isEjected:!0})}else e.peers[n.userid].onCustomMessage(n.message);document.getElementById("exit-session").style.visibility="visible",document.getElementById("time-bar").style.visibility="hidden"}if(n.drop){if(!e.peers[n.userid])throw"No such peer exists.";e.peers[n.userid].drop(!0),e.peers[n.userid].renegotiate(),e.ondrop(n.userid)}if(n.hold||n.unhold){if(!e.peers[n.userid])throw"No such peer exists.";if(n.takeAction)return void e.peers[n.userid][n.hold?"hold":"unhold"](n.holdMLine);e.peers[n.userid].peer.hold=!!n.hold,e.peers[n.userid].peer.holdMLine=n.holdMLine,F.send({isRenegotiate:!0}),e.peers[n.userid].fireHoldUnHoldEvents({kind:n.holdMLine,isHold:!!n.hold,userid:n.userid})}n.isRenegotiate&&e.peers[n.userid].renegotiate(null,e.peers[n.userid].peer.session),n.fakeData&&_.onmessage(n.fakeData),n.recreatePeer&&(L=new E),n.failedToReceiveRemoteVideo&&(m("Remote peer hasn't received stream: "+n.streamid+". Renegotiating..."),e.peers[n.userid]&&e.peers[n.userid].renegotiate()),n.redial&&e.peers[n.userid]&&("disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState&&(t.redialing=!1),"disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState||t.redialing||(t.redialing=!0,p("Peer connection is closed.",f(e.peers[n.userid].peer.connection),"ReDialing.."),e.peers[n.userid].redial()))}}function I(n,o){function r(){L.recreateAnswer(n,s,function(t,n){U({sdp:t,socket:F,streaminfo:n}),e.detachStreams=[]})}if("answer"==n.type)return L.setRemoteDescription(n),void x();if(!t.renegotiate&&"offer"==n.type)return _.offerDescription=n,_.session=e.session,L||(L=new E),L.create("answer",_),void x();var s=t.renegotiate;if(A(o,L.connection),s.oneway||i(s))r(),delete t.renegotiate;else{if(t.capturing)return;t.capturing=!0,e.captureUserMedia(function(n){t.capturing=!1,L.addStream(n),e.renegotiatedSessions[JSON.stringify(t.renegotiate)]={session:t.renegotiate,stream:n},delete t.renegotiate,r()},t.renegotiate)}}var P={channel:t.channel,onmessage:O,onopen:function(n){n&&(F=n),V&&!L&&(_.session=e.session,L||(L=new E),L.create("offer",_)),t.socketIndex=F.index=Q.length,K[P.channel]=F,Q[t.socketIndex]=F,D(F),F.__push||(F.__push=F.send,F.send=function(t){t.userid=t.userid||e.userid,t.extra=t.extra||e.extra||{},F.__push(t)})}};P.callback=function(e){F=e,P.onopen()};var F=e.openSignalingChannel(P);F&&P.onopen(F);var L,V=t.isofferer,_={onopen:C,onicecandidate:function(t){if(!e.candidates)throw"ICE candidates are mandatory.";if(!e.iceProtocols)throw"At least one must be true; UDP or TCP.";var n=e.candidates,i=n.stun,r=n.turn;if(o(n.reflexive)||(i=n.reflexive),o(n.relay)||(r=n.relay),(n.host||!t.candidate.match(/a=candidate.*typ host/g))&&(r||!t.candidate.match(/a=candidate.*typ relay/g))&&(i||!t.candidate.match(/a=candidate.*typ srflx/g))){var s=e.iceProtocols;(s.udp||!t.candidate.match(/a=candidate.* udp/g))&&(s.tcp||!t.candidate.match(/a=candidate.* tcp/g))&&(window.selfNPObject||(window.selfNPObject=t),F&&F.send({candidate:JSON.stringify({candidate:t.candidate,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex})}))}},onmessage:function(n){if(n){var i=a(n);if(-1!=i.indexOf('"userid":'))i=JSON.parse(i),u(i);else if(n instanceof ArrayBuffer||n instanceof DataView){if(!e.enableFileSharing)throw'It seems that receiving data is either "Blob" or "File" but file sharing is disabled.';if(!X.fileBufferReader){var o=this;return void T(e,function(e){X.fileBufferReader=e,o.onmessage(n)})}var r=X.fileBufferReader;return void r.convertToObject(n,function(n){return n.maxChunks||n.readyForNextChunk?n.readyForNextChunk?void r.getNextChunk(n.uuid,function(e,t,n){X.send(e)}):void r.addChunk(n,function(e){X.send(e)}):void e.onmessage({data:n,userid:t.userid,extra:t.extra})})}}},onaddstream:function(o,r){function s(){setTimeout(function(){u.muted=!1,l({mediaElement:u,session:r,stream:o,preMuted:a})},3e3),u.removeEventListener("play",s)}if(r=r||t.renegotiate||e.session,!i(r)){r.screen&&(r.audio||r.video)&&(t.gotAudioOrVideo?(r.audio=!1,r.video=!1):(t.gotAudioOrVideo=!0,r.screen=!1));var a={};if(t.streaminfo){var d=t.streaminfo.split("----"),c=JSON.parse(d[d.length-1]);B||(o.streamid=c.streamid,o.isScreen=!!c.isScreen,o.isVideo=!!c.isVideo,o.isAudio=!!c.isAudio,a=c.preMuted),d.pop(),t.streaminfo=d.join("----")}var u=v(o,b({remote:!0},r));return e.setDefaultEventsForMediaElement&&e.setDefaultEventsForMediaElement(u,o.streamid),j||o.getVideoTracks().length?void n({mediaElement:u,session:r,stream:o,preMuted:a}):u.addEventListener("play",s,!1)}},onremovestream:function(t){t&&t.streamid?(t=e.streams[t.streamid],t&&(m("on:stream:ended via on:remove:stream",t),g(t,e))):m("on:remove:stream",t)},onclose:function(n){n.extra=t.extra,n.userid=t.userid,e.onclose(n),e.channels[n.userid]&&delete e.channels[n.userid]},onerror:function(n){n.extra=t.extra,n.userid=t.userid,e.onerror(n)},oniceconnectionstatechange:function(n){var i=t.userid.split("-",1);-1===array.indexOf(i+" , ")?array.push(i+" , "):J.log("This item already exists"),customFunctionForUpdateList(),customFunctionForUserCount(),m("oniceconnectionstatechange",f(n)),L.connection&&"connected"==L.connection.iceConnectionState&&"complete"==L.connection.iceGatheringState&&"stable"==L.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onconnected({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),!e.isInitiator&&L.connection&&"connected"==L.connection.iceConnectionState&&"complete"==L.connection.iceGatheringState&&"stable"==L.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onstatechange({userid:t.userid,extra:t.extra,name:"connected-with-initiator",reason:"ICE connection state seems connected; gathering state is completed; and signaling state is stable."}),e.peers[t.userid]&&e.peers[t.userid].oniceconnectionstatechange&&e.peers[t.userid].oniceconnectionstatechange(n),e.peers[t.userid]&&"failed"==e.peers[t.userid].peer.connection.iceConnectionState&&e.onfailed({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),e.peers[t.userid]&&"disconnected"==e.peers[t.userid].peer.connection.iceConnectionState&&(!L.connection.renegotiate&&e.ondisconnected({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),L.connection.renegotiate=!1),e.autoReDialOnFailure&&e.peers[t.userid]&&("disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState&&(t.redialing=!1),"disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState||t.redialing||(t.redialing=!0,p("Peer connection is closed.",f(e.peers[t.userid].peer.connection),"ReDialing.."),e.peers[t.userid].socket.send({redial:!0}),e.streams.remove({remote:!0,userid:t.userid})))},onsignalingstatechange:function(e){m("onsignalingstatechange",f(e))},attachStreams:e.dontAttachStream?[]:e.attachStreams,iceServers:e.iceServers,rtcConfiguration:e.rtcConfiguration,bandwidth:e.bandwidth,sdpConstraints:e.sdpConstraints,optionalArgument:e.optionalArgument,disableDtlsSrtp:e.disableDtlsSrtp,dataChannelDict:e.dataChannelDict,preferSCTP:e.preferSCTP,onSessionDescription:function(e,t){U({sdp:e,socket:F,streaminfo:t})},trickleIce:e.trickleIce,processSdp:e.processSdp,sendStreamId:function(e){F&&F.send({streamid:e.streamid,isScreen:!!e.isScreen,isAudio:!!e.isAudio,isVideo:!!e.isVideo})},rtcMultiConnection:e};e.playRoleOfInitiator=function(){e.dontCaptureUserMedia=!0,e.open(),Q=c(Q),e.dontCaptureUserMedia=!1},e.askToShareParticipants=function(){te&&te.send({askToShareParticipants:!0})},e.shareParticipants=function(t){var n={joinUsers:Z,userid:e.userid,extra:e.extra};t&&(t.dontShareWith&&(n.dontShareWith=t.dontShareWith),t.shareWith&&(n.shareWith=t.shareWith)),te.send(n)}}function A(t,n){if(t)for(var i=0;i<t.length;i++){var o=t[i];e.streams[o]&&n.removeStream(e.streams[o].stream)}}function U(t){t.socket.send({sdp:JSON.stringify({sdp:t.sdp.sdp,type:t.sdp.type}),renegotiate:t.renegotiate?t.renegotiate:!1,streaminfo:t.streaminfo||"",labels:t.labels||[],preferSCTP:!!e.preferSCTP,fakeDataChannels:!!e.fakeDataChannels,isInitiator:!!e.isInitiator,userinfo:{browser:N?"firefox":"chrome"}})}function L(t){var n=t.newParticipant;if(n&&!Z[n]&&n!=e.userid){var i=e.token();O({channel:i,extra:t.userData?t.userData.extra:t.extra,userid:t.userData?t.userData.userid:t.userid}),te.send({participant:!0,targetUser:n,channel:i})}}function V(){e.numberOfConnectedUsers--;var t={left:!0,extra:e.extra||{},userid:e.userid,sessionid:e.sessionid};e.isInitiator&&(e.autoCloseEntireSession?t.closeEntireSession=!0:Q[0]&&Q[0].send({playRoleOfBroadcaster:!0,userid:e.userid,extra:e.extra,participants:Z})),Q.forEach(function(e,n){e.send(t),K[e.channel]&&delete K[e.channel],delete Q[n]}),Q=c(Q),e.refresh(),F.forEach(function(e){e.disconnect()}),F=[]}function _(){X.signalingReady||(X.signalingReady=!0,setTimeout(t,1e3),e.isInitiator||te&&te.send({searchingForRooms:!0}))}function H(t){for(var n in t)Z[t[n]]||L({sessionid:e.sessionid,newParticipant:t[n],userid:e.userid,extra:e.extra})}function z(){return e.openSignalingChannel({onmessage:function(t){if(!ne&&t.userid!=e.userid){if(t.sessionid&&t.userid&&(e.sessionDescriptions[t.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[t.sessionid]=t,e.isAcceptNewSession&&(e.dontOverrideSession||(e.session=t.session),R(t)))),t.newParticipant&&!e.isAcceptNewSession&&X.broadcasterid===t.userid&&t.newParticipant!=e.userid&&L(t),h(Z)<e.maxParticipantsAllowed&&t.targetUser==e.userid&&t.participant){if(e.peers[t.userid]&&!e.peers[t.userid].peer)return delete Z[t.userid],delete e.peers[t.userid],e.isAcceptNewSession=!0,Y(t);Z[t.userid]||Y(t)}if(t.acceptedRequestOf==e.userid&&e.onstatechange({userid:t.userid,extra:t.extra,name:"request-accepted",reason:t.userid+" accepted your participation request."}),t.rejectedRequestOf==e.userid&&e.onstatechange({userid:t.userid,extra:t.extra,name:"request-rejected",reason:t.userid+" rejected your participation request."}),t.customMessage)if(t.message.drop){e.ondrop(t.userid),e.attachStreams=[];for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],"local"==n.type?(e.detachStreams.push(n.streamid),g(n,e)):g(n,e));t.message.renegotiate&&e.renegotiate()}else e.onCustomMessage&&e.onCustomMessage(t.message);if(e.isInitiator&&t.searchingForRooms&&te&&te.send({sessionDescription:e.sessionDescription,responseFor:t.userid}),t.sessionDescription&&t.responseFor==e.userid){var i=t.sessionDescription;e.sessionDescriptions[i.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[i.sessionid]=i)}e.isInitiator&&t.askToShareParticipants&&te&&e.shareParticipants({shareWith:t.userid}),t.shareWith==e.userid&&t.dontShareWith!=e.userid&&t.joinUsers&&H(t.joinUsers),!t.shareWith&&t.joinUsers&&(t.dontShareWith?e.userid!=t.dontShareWith&&H(t.joinUsers):H(t.joinUsers)),t.messageFor==e.userid&&t.presenceState&&("checking"==t.presenceState&&(te.send({messageFor:t.userid,presenceState:"available",_config:t._config}),m("participant asked for availability")),"available"==t.presenceState&&(X.presenceState="available",e.onstatechange({userid:"browser",extra:{},name:"room-available",reason:"Initiator is available and room is active."}),G(t._config))),t.donotJoin&&t.messageFor==e.userid&&m(t.userid,"is not joining your room."),t.isDisconnectSockets&&(m("Disconnecting your sockets because initiator also disconnected his sockets."),e.disconnect())}},callback:function(e){e&&this.onopen(e)},onopen:function(t){t&&(te=t),_&&_(),X.defaultSocket=te,te.__push||(te.__push=te.send,te.send=function(t){t.userid=t.userid||e.userid,t.extra=t.extra||e.extra||{},te.__push(t)})}})}function q(){var t=0;256!=e.maxParticipantsAllowed&&(t=e.maxParticipantsAllowed),"one-way"==e.direction&&(e.session.oneway=!0),"one-to-one"==e.direction&&(e.maxParticipantsAllowed=1),"one-to-many"==e.direction&&(e.session.broadcast=!0),"many-to-many"==e.direction&&(e.maxParticipantsAllowed&&1!=e.maxParticipantsAllowed||(e.maxParticipantsAllowed=256)),t&&1!=e.maxParticipantsAllowed&&(e.maxParticipantsAllowed=t)}function G(t,i){if(!X.donotJoin||X.donotJoin!=t.sessionid){e.dontOverrideSession||(e.session=t.session||{}),X.broadcasterid=t.userid,t.sessionid&&(e.sessionid=t.sessionid),e.isAcceptNewSession=!1;var o=n();O({channel:o,extra:t.extra||{},userid:t.userid});var r={};if(e.attachStreams.length){var a=e.attachStreams[e.attachStreams.length-1];a.getAudioTracks&&a.getAudioTracks().length&&(r.audio=!0),a.getVideoTracks().length&&(r.video=!0)}m(s(r)?"Seems data-only connection.":f(r)),e.onstatechange({userid:t.userid,extra:{},name:"connecting-with-initiator",reason:"Checking presence of the initiator; and the room."}),te.send({participant:!0,channel:o,targetUser:t.userid,session:e.session,offers:{audio:!!r.audio,video:!!r.video}}),e.skipOnNewSession=!1,C(e)}}function Y(t){if(X.requestsFrom||(X.requestsFrom={}),!X.requestsFrom[t.userid]){var n={userid:t.userid,extra:t.extra,channel:t.channel||t.userid,session:t.session||e.session};if(t.offers){m(t.offers.audio&&t.offers.video?"target user has both audio/video streams.":t.offers.audio&&!t.offers.video?"target user has only audio stream.":!t.offers.audio&&t.offers.video?"target user has only video stream.":"target user has no stream; it seems one-way streaming or data-only connection.");var i=e.sdpConstraints.mandatory;o(i.OfferToReceiveAudio)&&(e.sdpConstraints.mandatory.OfferToReceiveAudio=!!t.offers.audio),o(i.OfferToReceiveVideo)&&(e.sdpConstraints.mandatory.OfferToReceiveVideo=!!t.offers.video),m("target user's SDP has?",f(e.sdpConstraints.mandatory))}X.requestsFrom[t.userid]=n,e.onRequest&&e.isInitiator?e.onRequest(n):$(n)}}function $(t){return X.captureUserMediaOnDemand?(X.captureUserMediaOnDemand=!1,void e.captureUserMedia(function(){$(t),C(e)})):(m("accepting request from",t.userid),Z[t.userid]=t.userid,void O({isofferer:!0,userid:t.userid,channel:t.channel,extra:t.extra||{},session:t.session||e.session}))}var K={},Q=[],X=this,Z={};!X.fileBufferReader&&e.session.data&&e.enableFileSharing&&T(e,function(e){X.fileBufferReader=e});var ee=new I(e);e.remove=function(t){X.requestsFrom&&X.requestsFrom[t]&&delete X.requestsFrom[t],e.peers[t]&&(e.peers[t].peer&&e.peers[t].peer.connection&&("closed"!=e.peers[t].peer.connection.signalingState&&e.peers[t].peer.connection.close(),e.peers[t].peer.connection=null),delete e.peers[t]),Z[t]&&delete Z[t];for(var n in e.streams)n=e.streams[n],n.userid==t&&(g(n,e),delete e.streams[n]);K[t]&&delete K[t]},e.refresh=function(){e.isInitiator&&e.socket&&e.socket.remove&&e.socket.remove(),Z={};for(var t=0;t<e.attachStreams.length;t++)e.stopMediaStream(e.attachStreams[t]);ae={streams:[],mutex:!1,queueRequests:[]},X.isOwnerLeaving=!0,e.isInitiator=!1,e.isAcceptNewSession=!0,e.attachMediaStreams=[],e.sessionDescription=null,e.sessionDescriptions={},e.localStreamids=[],e.preRecordedMedias={},e.snapshots={},e.numberOfConnectedUsers=0,e.numberOfSessions=0,e.attachStreams=[],e.detachStreams=[],e.fileQueue={},e.channels={},e.renegotiatedSessions={};for(var n in e.peers)n!=e.userid&&delete e.peers[n];for(var i in e.streams)-1==e._skip.indexOf(i)&&(g(e.streams[i],e),delete e.streams[i]);K={},Q=[],Z={}},e.reject=function(t){r(t)||(t=t.userid),te.send({rejectedRequestOf:t}),e.remove(t)},X.leaveHandler=function(t){return e.leaveOnPageUnload?o(t.keyCode)?V():void(116==t.keyCode&&V()):void 0},P("beforeunload",X.leaveHandler),P("keyup",X.leaveHandler),X.onLineOffLineHandler=function(){navigator.onLine?X.isOffLine&&(X.isOffLine=!navigator.onLine):X.isOffLine=!0},P("load",X.onLineOffLineHandler),P("online",X.onLineOffLineHandler),P("offline",X.onLineOffLineHandler);var te=z();X.defaultSocket=te,te&&_&&setTimeout(_,2e3),e.session.screen&&x(),0==e.log&&e.skipLogs(),e.onlog&&(m=p=l=function(){var t={},n=0;Array.prototype.slice.call(arguments).forEach(function(e){t[n++]=f(e)}),f=function(e){return e},e.onlog(t)}),this.initSession=function(t){function n(){te&&h(Z)<e.maxParticipantsAllowed&&!X.isOwnerLeaving&&te.send(e.sessionDescription),e.transmitRoomOnce||X.isOwnerLeaving||setTimeout(n,e.interval||3e3)}X.isOwnerLeaving=!1,q(),Z={},X.isOwnerLeaving=!1,o(t.transmitRoomOnce)||(e.transmitRoomOnce=t.transmitRoomOnce),t.dontTransmit||n()},this.joinSession=function(t){function n(){te.send({messageFor:t.userid,presenceState:X.presenceState,_config:{userid:t.userid,extra:t.extra||{},sessionid:t.sessionid,session:t.session||!1}})}function i(){"checking"==X.presenceState&&(p("Unable to reach initiator. Trying again..."),n(),setTimeout(function(){"checking"==X.presenceState&&(e.onstatechange({userid:t.userid,extra:t.extra||{},name:"room-not-available",reason:"Initiator seems absent. Waiting for someone to open the room."}),e.isAcceptNewSession=!0,setTimeout(i,2e3))},2e3))}return te?(t=t||{},Z={},X.presenceState="checking",e.onstatechange({userid:t.userid,extra:t.extra||{},name:"detecting-room-presence",reason:"Checking presence of the room."}),n(),void setTimeout(i,3e3)):setTimeout(function(){p("Default-Socket is not yet initialized."),X.joinSession(t)},1e3)},e.donotJoin=function(t){X.donotJoin=t;var n=e.sessionDescriptions[t];n&&(te.send({donotJoin:!0,messageFor:n.userid,sessionid:t}),Z={},e.isAcceptNewSession=!0,e.sessionid=null)},this.send=function(t,n){if(t instanceof ArrayBuffer||t instanceof DataView||(t=d({extra:e.extra,userid:e.userid,data:t})),n)return void("open"==n.readyState&&n.send(t));for(var i in e.channels){var o=e.channels[i].channel;"open"==o.readyState&&o.send(t)}},this.leave=function(){V()},this.addStream=function(t){function n(n){var o=n.socket;if(!o)return void p(n,"doesn't has socket.");if(D(o),!n||!n.peer)throw"No peer to renegotiate.";var r=n.peer;t.stream&&(r.attachStreams||(r.attachStreams=[]),r.attachStreams.push(t.stream)),A(e.detachStreams,r.connection),t.stream&&(i.audio||i.video||i.screen)&&r.addStream(t.stream),r.recreateOffer(i,function(t,n){U({sdp:t,socket:o,renegotiate:i,labels:e.detachStreams,streaminfo:n}),e.detachStreams=[]})}var i=t.renegotiate;if(e.renegotiatedSessions[JSON.stringify(t.renegotiate)]||(e.renegotiatedSessions[JSON.stringify(t.renegotiate)]={session:t.renegotiate,stream:t.stream}),t.socket)t.socket.userid!=e.userid&&n(e.peers[t.socket.userid]);else for(var o in e.peers)o!=e.userid&&n(e.peers[o])},e.request=function(t,n){e.captureUserMedia(function(){O({channel:e.userid,extra:n||{},userid:t}),te.send({participant:!0,targetUser:t})})},e.accept=function(t){arguments.length>1&&r(arguments[0])&&(t={},arguments[0]&&(t.userid=arguments[0]),arguments[1]&&(t.extra=arguments[1]),arguments[2]&&(t.channel=arguments[2])),e.captureUserMedia(function(){$(t)})};var ne=!1;this.disconnect=function(){if(this.isOwnerLeaving=!0,!e.keepStreamsOpened){for(var t in e.localStreams)e.localStreams[t].stop();e.localStreams={},ae={streams:[],mutex:!1,queueRequests:[]}}e.isInitiator&&te.send({isDisconnectSockets:!0}),e.refresh(),X.defaultSocket=te=null,ne=!0,e.ondisconnected({userid:e.userid,extra:e.extra,peer:e.peers[e.userid],isSocketsDisconnected:!0}),e.close(),window.removeEventListener("beforeunload",X.leaveHandler),window.removeEventListener("keyup",X.leaveHandler),delete this,m("Disconnected your sockets, peers, streams and everything except RTCMultiConnection object.")}}function t(e){if(!e)throw"MediaStream is mandatory.";if(e.getVideoTracks&&!e.getVideoTracks().length)return e;var t=new AudioContext,n=t.createMediaStreamSource(e),i=t.createMediaStreamDestination();return n.connect(i),F.push(n),i.stream}function n(){return participants+"-"+(new Date).getTime().toString(36).replace(/\./g,"")}function i(e){return!e.audio&&!e.video&&!e.screen&&e.data}function o(e){return"undefined"==typeof e}function r(e){return"string"==typeof e}function s(e){var t=0;for(var n in e)t++;return 0==t}function a(e){var t="";try{t=String.fromCharCode.apply(null,new Uint16Array(e))}catch(n){}return t}function d(e){r(e)||(e=JSON.stringify(e));for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),i=0,o=e.length;o>i;i++)n[i]=e.charCodeAt(i);return t}function c(e){for(var t=[],n=e.length,i=0;n>i;i++)e[i]&&e[i]!==!0&&t.push(e[i]);return t}function u(e,t){for(var n in e)t(e[n],n)}function m(){J.log(arguments)}function l(){J.error(arguments)}function p(){J.warn(arguments)}function f(e){return JSON.stringify(e,function(e,t){return t&&t.sdp?(m(t.sdp.type,"	",t.sdp.sdp),""):t},"	")}function h(e){var t=0;for(var n in e)n&&t++;return t}function v(e,t){var n=document.createElement(e.isAudio?"audio":"video");if(n.id=e.streamid,j){var i=document.body||document.documentElement;return i.insertBefore(n,i.firstChild),setTimeout(function(){ie.attachMediaStream(n,e)},1e3),ie.attachMediaStream(n,e)}return n[N?"mozSrcObject":"src"]=N?e:(window.URL||window.webkitURL).createObjectURL(e),n.controls=!0,n.autoplay=!!t.remote,n.muted=t.remote?!1:!0,N&&n.addEventListener("ended",function(){e.onended();
},!1),n.play(),n}function g(e,t){(!e.mediaElement||e.mediaElement.parentNode)&&(Q[e.streamid]||(Q[e.streamid]=e,t.onstreamended(e)))}function S(e,t){X[e.userid]||(X[e.userid]=e,t.onleave(e))}function w(e){function t(t){var o=document.createElement("canvas");o.width=t.videoWidth||t.clientWidth,o.height=t.videoHeight||t.clientHeight;var r=o.getContext("2d");r.drawImage(t,0,0,o.width,o.height),i.snapshots[n]=o.toDataURL("image/png"),e.callback&&e.callback(i.snapshots[n])}var n=e.userid,i=e.connection;if(e.mediaElement)return t(e.mediaElement);for(var o in i.streams)o=i.streams[o],o.userid==n&&o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks().length&&t(o.mediaElement)}function C(e){e.onMediaCaptured&&(e.onMediaCaptured(),delete e.onMediaCaptured)}function b(e,t){if(e||(e={}),!t)return e;for(var n in t)e[n]=t[n];return e}function y(e,t){var n=document.createElement("script");n.src=e,n.onload=function(){m("loaded resource:",e),t&&t()},document.documentElement.appendChild(n)}function k(e){var t=e.connection,n=e.element;if(!window.html2canvas)return y(t.resources.html2canvas,function(){k(e)});if(r(n)&&(n=document.querySelector(n),n||(n=document.getElementById(n))),!n)throw"HTML DOM Element is not accessible!";html2canvas(n,{onrendered:function(t){e.callback(t.toDataURL())}})}function T(e,t){function n(e){return e.userid=e.extra.userid,e}if(!window.FileBufferReader)return void y(e.resources.FileBufferReader,function(){T(e,t)});var i=new FileBufferReader;i.onProgress=function(t){e.onFileProgress(n(t),t.uuid)},i.onBegin=function(t){e.onFileStart(n(t))},i.onEnd=function(t){e.onFileEnd(n(t))},t(i)}function x(e){if(DetectRTC.screen.extensionid==te&&!K){if(!e)return x(!0);K=!0;var t=document.createElement("iframe");t.onload=function(){t.isLoaded=!0,m("Screen Capturing frame is loaded.")},t.src="https://www.webrtc-experiment.com/getSourceId/",t.style.display="none",(document.body||document.documentElement).appendChild(t),Y={postMessage:function(){return t.isLoaded?void t.contentWindow.postMessage({captureSourceId:!0},"*"):void setTimeout(Y.postMessage,100)}}}}function R(e){var t=e.stream,n=e.root,i=e.session||{},o=e.enabled;if(i.audio||i.video||(i=r(i)?{audio:!0,video:!0}:b(i,{audio:!0,video:!0})),i.type){if("remote"==i.type&&"remote"!=n.type)return;if("local"==i.type&&"local"!=n.type)return}if(m(o?"Muting":"UnMuting","session",f(i)),o){var s=e.root.userid.split("-",1);myDelete(s+" , "),customFunctionForUpdateList(),customFunctionForUserCount()}else{var s=e.root.userid.split("-",1);-1===array.indexOf(s+" , ")?array.push(s+" , "):J.log("This item already exists"),customFunctionForUpdateList(),customFunctionForUserCount()}if("local"==n.type&&i.audio&&t.getAudioTracks){var a=t.getAudioTracks()[0];a&&(a.enabled=!o)}if("local"==n.type&&(i.video||i.screen)&&t.getVideoTracks){var d=t.getVideoTracks()[0];d&&(d.enabled=!o)}if(n.sockets.forEach(function(e){"local"==n.type&&e.send({streamid:n.streamid,mute:!!o,unmute:!o,session:i}),"remote"==n.type&&e.send({promptMuteUnmute:!0,streamid:n.streamid,mute:!!o,unmute:!o,session:i})}),"remote"!=n.type){var c=b({},n);c.session=i,c.isAudio=!!c.session.audio&&!c.session.video,c.isVideo=!!c.session.video,c.isScreen=!!c.session.screen,o&&(t.preMuted={audio:t.getAudioTracks().length&&!t.getAudioTracks()[0].enabled,video:t.getVideoTracks().length&&!t.getVideoTracks()[0].enabled},n.rtcMultiConnection.onmute(c)),o||(t.preMuted={},n.rtcMultiConnection.onunmute(c))}}function M(e){if(!window.hark)return void y(e.connection.resources.hark,function(){M(e)});var t=e.connection,n=e.streamedObject,i=e.stream,o={},r=hark(i,o);r.on("speaking",function(){t.onspeaking&&t.onspeaking(n)}),r.on("stopped_speaking",function(){t.onsilence&&t.onsilence(n)}),r.on("volume_change",function(e,i){t.onvolumechange&&t.onvolumechange(b({volume:e,threshold:i},n))})}function D(e){function t(t,i,o){o||(o=getVideoId()),n.localStreams[o]=t;var r=e.video;r&&(r[N?"mozSrcObject":"src"]=N?t:(window.URL||window.webkitURL).createObjectURL(t),r.play()),e.onsuccess(t,i,S,o),ae.streams[S]={stream:t,streamid:o},ae.mutex=!1,ae.queueRequests.length&&D(ae.queueRequests.shift())}if(j)return ie.getUserMedia?ie.getUserMedia(e.constraints||{audio:!0,video:!0},e.onsuccess,e.onerror):void setTimeout(function(){D(e)},1e3);if(ae.mutex===!0)return void ae.queueRequests.push(e);ae.mutex=!0;var n=e.connection,i=e.mediaConstraints||{},o="boolean"==typeof i.video?i.video:i.video||i,r="boolean"==typeof i.audio?i.audio:i.audio||se,a=navigator,d=e.constraints||{audio:se,video:se};d.video&&d.video.mozMediaSource&&(o={}),1==d.video&&(d.video=se),1==d.audio&&(d.audio=se),"boolean"==typeof r&&d.audio&&(d.audio=r),"boolean"==typeof o&&d.video&&(d.video=o);var u=r.mandatory;s(u)||(d.audio.mandatory=b(d.audio.mandatory,u));var h=o.mandatory;if(h){var v={};if(h.minWidth&&(v.minWidth=h.minWidth),h.minHeight&&(v.minHeight=h.minHeight),h.maxWidth&&(v.maxWidth=h.maxWidth),h.maxHeight&&(v.maxHeight=h.maxHeight),h.minAspectRatio&&(v.minAspectRatio=h.minAspectRatio),h.maxFrameRate&&(v.maxFrameRate=h.maxFrameRate),h.minFrameRate&&(v.minFrameRate=h.minFrameRate),v.minWidth&&v.minHeight){var g=["1920:1080","1280:720","960:720","640:360","640:480","320:240","320:180"];(-1==g.indexOf(v.minWidth+":"+v.minHeight)||-1==g.indexOf(v.maxWidth+":"+v.maxHeight))&&l('The min/max width/height constraints you passed "seems" NOT supported.',f(v)),(v.minWidth>v.maxWidth||v.minHeight>v.maxHeight)&&l("Minimum value must not exceed maximum value.",f(v)),v.minWidth>=1280&&v.minHeight>=720&&p("Enjoy HD video! min/"+v.minWidth+":"+v.minHeight+", max/"+v.maxWidth+":"+v.maxHeight)}d.video.mandatory=b(d.video.mandatory,v)}h&&(d.video.mandatory=b(d.video.mandatory,h)),o.optional&&o.optional instanceof Array&&o.optional.length&&(d.video.optional=d.video.optional?d.video.optional.concat(o.optional):o.optional),r.optional&&r.optional instanceof Array&&r.optional.length&&(d.audio.optional=d.audio.optional?d.audio.optional.concat(r.optional):r.optional),d.video.mandatory&&!s(d.video.mandatory)&&n._mediaSources.video&&(d.video.optional.forEach(function(e,t){e.sourceId==n._mediaSources.video&&delete d.video.optional[t]}),d.video.optional=c(d.video.optional),d.video.optional.push({sourceId:n._mediaSources.video})),d.audio.mandatory&&!s(d.audio.mandatory)&&n._mediaSources.audio&&(d.audio.optional.forEach(function(e,t){e.sourceId==n._mediaSources.audio&&delete d.audio.optional[t]}),d.audio.optional=c(d.audio.optional),d.audio.optional.push({sourceId:n._mediaSources.audio})),d.video&&!d.video.mozMediaSource&&d.video.optional&&d.video.mandatory&&!d.video.optional.length&&s(d.video.mandatory)&&(d.video=!0),W&&(d={audio:!!d.audio,video:!!d.video}),getdata(),1==n.numberOfConnectedUsers&&(-1===array.indexOf(participants+" , ")?array.push(participants+" , "):J.log("This item already exists")),customFunctionForUpdateList(),customFunctionForUserCount(),m("invoked getUserMedia with constraints:",f(d));var S=JSON.stringify(d);ae.streams[S]?t(ae.streams[S].stream,!0,ae.streams[S].streamid):(a.getMedia=a.webkitGetUserMedia||a.mozGetUserMedia,a.getMedia(d,t,function(t){e.onerror(t,d)}))}function O(e){var t,n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return t={mandatory:n,optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&G>34&&(t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}),t}function E(){return{create:function(e,t){b(this,t);var n=this;return this.type=e,this.init(),this.attachMediaStreams(),N&&this.session.data?(this.session.data&&"offer"==e&&this.createDataChannel(),this.getLocalDescription(e),this.session.data&&"answer"==e&&this.createDataChannel()):n.getLocalDescription(e),this},getLocalDescription:function(e){function t(){n.connection["offer"==e?"createOffer":"createAnswer"](function(t){t.sdp=n.serializeSdp(t.sdp,e),n.connection.setLocalDescription(t),n.trickleIce&&n.onSessionDescription(t,n.streaminfo),"offer"==t.type&&m("offer sdp",t.sdp),n.prevCreateType=e},n.onSdpError,n.constraints)}m("(getLocalDescription) peer createType is",e),this.session.inactive&&o(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing)&&(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing=!1);var n=this;"answer"==e?this.setRemoteDescription(this.offerDescription,t):t()},serializeSdp:function(e,t){if(e=this.processSdp(e),N)return e;if(this.session.inactive&&!this.holdMLine&&(this.hold=!0,(this.session.screen||this.session.video)&&this.session.audio?this.holdMLine="both":this.session.screen||this.session.video?this.holdMLine="video":this.session.audio&&(this.holdMLine="audio")),e=this.setBandwidth(e),"both"==this.holdMLine){if(this.hold)this.prevSDP=e,e=e.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive");else if(this.prevSDP&&!this.session.inactive&&(e=this.prevSDP,35>=z))return e}else if("audio"==this.holdMLine||"video"==this.holdMLine){e=e.split("m=");var n="",i="";e[1]&&0==e[1].indexOf("audio")&&(n="m="+e[1]),e[2]&&0==e[2].indexOf("audio")&&(n="m="+e[2]),e[1]&&0==e[1].indexOf("video")&&(i="m="+e[1]),e[2]&&0==e[2].indexOf("video")&&(i="m="+e[2]),"audio"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+n+i,e=e[0]+n.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")+i):this.prevSDP&&(e=this.prevSDP)),"video"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+n+i,e=e[0]+n+i.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")):this.prevSDP&&(e=this.prevSDP))}return!this.hold&&this.session.inactive&&(e="offer"==t?e.replace(/a=setup:passive|a=setup:active|a=setup:holdconn/g,"a=setup:actpass"):e.replace(/a=setup:actpass|a=setup:passive|a=setup:holdconn/g,"a=setup:active"),e=e.replace(/a=inactive/g,"a=sendrecv")),e},init:function(){function e(){return t.returnedSDP?void(t.returnedSDP=!1):(t.returnedSDP=!0,void t.onSessionDescription(t.connection.localDescription,t.streaminfo))}this.setConstraints(),this.connection=new re(this.iceServers,this.optionalArgument),this.session.data&&(m("invoked: createDataChannel"),this.createDataChannel()),this.connection.onicecandidate=function(n){return n.candidate?void(t.trickleIce&&t.onicecandidate(n.candidate)):void(t.trickleIce||e())},this.connection.onaddstream=function(e){m("onaddstream",j?e.stream:f(e.stream)),t.onaddstream(e.stream,t.session)},this.connection.onremovestream=function(e){t.onremovestream(e.stream)},this.connection.onsignalingstatechange=function(){t.connection&&t.oniceconnectionstatechange({iceConnectionState:t.connection.iceConnectionState,iceGatheringState:t.connection.iceGatheringState,signalingState:t.connection.signalingState})},this.connection.oniceconnectionstatechange=function(){t.connection&&(t.oniceconnectionstatechange({iceConnectionState:t.connection.iceConnectionState,iceGatheringState:t.connection.iceGatheringState,signalingState:t.connection.signalingState}),t.trickleIce||"complete"==t.connection.iceGatheringState&&(m("iceGatheringState",t.connection.iceGatheringState),e()))};var t=this},setBandwidth:function(e){if(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:80\r\n"),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:256\r\n"),e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:1638400\r\n"),W||N||!this.bandwidth)return e;var t=this.bandwidth;return this.session.screen&&(t.screen?t.screen<300&&p("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):p("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),t.screen&&this.session.screen&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video||t.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(this.session.screen?t.screen:t.video)+"\r\n")),t.data&&!this.preferSCTP&&(e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+t.data+"\r\n")),e},setConstraints:function(){var e=O({OfferToReceiveAudio:!!this.session.audio,OfferToReceiveVideo:!!this.session.video||!!this.session.screen});if(this.sdpConstraints.mandatory&&(e=O(this.sdpConstraints.mandatory)),this.constraints=e,this.constraints&&m("sdp-constraints",f(this.constraints)),this.optionalArgument={optional:this.optionalArgument.optional||[],mandatory:this.optionalArgument.mandatory||{}},this.preferSCTP||this.optionalArgument.optional.push({RtpDataChannels:!0}),m("optional-argument",f(this.optionalArgument)),o(this.iceServers))this.iceServers=null;else{var t=this.rtcMultiConnection.candidates,n=t.stun,i=t.turn,r=t.host;o(t.reflexive)||(n=t.reflexive),o(t.relay)||(i=t.relay),r||n||!i?r||n||i||(this.rtcConfiguration.iceTransports="none"):this.rtcConfiguration.iceTransports="relay",this.iceServers={iceServers:this.iceServers,iceTransports:this.rtcConfiguration.iceTransports}}m("rtc-configuration",f(this.iceServers))},onSdpError:function(e){var t=f(e);t&&-1!=t.indexOf("RTP/SAVPF Expects at least 4 fields")&&(t="It seems that you are trying to interop RTP-datachannels with SCTP. It is not supported!"),l("onSdpError:",t)},onSdpSuccess:function(){m("sdp success")},onMediaError:function(e){l(f(e))},setRemoteDescription:function(e,t){if(!e)throw"Remote session description should NOT be NULL.";if(this.connection){m("setting remote description",e.type,e.sdp);var n=this;this.connection.setRemoteDescription(new ce(e),t||this.onSdpSuccess,function(e){-1==e.search(/STATE_SENTINITIATE|STATE_INPROGRESS/gi)&&n.onSdpError(e)})}},addIceCandidate:function(e){function t(t){n.connection.addIceCandidate(t,function(){m("added:",e.sdpMid,e.candidate)},function(){l("onIceFailure",arguments,e.candidate)})}var n=this;j?ue(e,function(e){t(e)}):t(new ue(e))},createDataChannel:function(e){if(!this.channels||!this.channels.length){var t=this;this.channels||(this.channels=[]);var n={};this.dataChannelDict&&(n=this.dataChannelDict),_&&!this.preferSCTP&&(n.reliable=!1),m("dataChannelDict",f(n)),("answer"==this.type||N)&&(this.connection.ondatachannel=function(e){t.setChannelEvents(e.channel)}),(_&&"offer"==this.type||N)&&this.setChannelEvents(this.connection.createDataChannel(e||"channel",n))}},setChannelEvents:function(e){var t=this;e.binaryType="arraybuffer",this.dataChannelDict.binaryType&&(e.binaryType=this.dataChannelDict.binaryType),e.onmessage=function(e){t.onmessage(e.data)};var n=0;e.onopen=function(){e.push=e.send,e.send=function(i){if("disconnected"!=t.connection.iceConnectionState&&-1==e.readyState.search(/closing|closed/g)&&-1!=e.readyState.search(/connecting|open/g)){if("connecting"==e.readyState)return n++,setTimeout(function(){if(!(20>n))throw"Number of times exceeded to wait for WebRTC data connection to be opened.";e.send(i)},1e3);try{e.push(i)}catch(o){if(n++,p("Data transmission failed. Re-transmitting..",n,f(o)),n>=20)throw"Number of times exceeded to resend data packets over WebRTC data channels.";setTimeout(function(){e.send(i)},100)}}},t.onopen(e)},e.onerror=function(e){t.onerror(e)},e.onclose=function(e){t.onclose(e)},this.channels.push(e)},addStream:function(e){e.streamid||B||(e.streamid=getVideoId()),m("attaching stream:",e.streamid,j?e:f(e)),this.connection.addStream(e),this.sendStreamId(e),this.getStreamInfo()},attachMediaStreams:function(){for(var e=this.attachStreams,t=0;t<e.length;t++)this.addStream(e[t])},getStreamInfo:function(){this.streaminfo="";for(var e=this.connection.getLocalStreams(),t=0;t<e.length;t++)0==t?this.streaminfo=JSON.stringify({streamid:e[t].streamid||"",isScreen:!!e[t].isScreen,isAudio:!!e[t].isAudio,isVideo:!!e[t].isVideo,preMuted:e[t].preMuted||{}}):this.streaminfo+="----"+JSON.stringify({streamid:e[t].streamid||"",isScreen:!!e[t].isScreen,isAudio:!!e[t].isAudio,isVideo:!!e[t].isVideo,preMuted:e[t].preMuted||{}})},recreateOffer:function(e,t){m("recreating offer"),this.type="offer",this.session=e,this.onSessionDescription=t,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("offer")},recreateAnswer:function(e,t,n){m("recreating answer"),this.type="answer",this.session=t,this.onSessionDescription=n,this.offerDescription=e,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("answer")}}}function A(e,t){var n=document.createElement("a");n.href=e,n.target="_blank",n.download=t||e,navigator.mozGetUserMedia&&(n.onclick=function(){(document.body||document.documentElement).removeChild(n)},(document.body||document.documentElement).appendChild(n));var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(i),navigator.mozGetUserMedia||URL.revokeObjectURL(n.href)}function I(e){function t(t,i,o){var r=t.uuid;if(n[r]||(n[r]=[]),n[r].push(t.message),t.last){var s=n[r].join("");t.isobject&&(s=JSON.parse(s));var a=(new Date).getTime(),d=a-t.sendingTime,c={data:s,userid:i,extra:o,latency:d};s.preRecordedMediaChunk?(e.preRecordedMedias[s.streamerid]||e.shareMediaFile(null,null,s.streamerid),e.preRecordedMedias[s.streamerid].onData(s.chunk)):e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(t){c.data=t,e.onmessage(c)})):s.isPartOfScreen?e.onpartofscreen(s):e.onmessage(c),delete n[r]}}var n={};return{receive:t}}function P(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function U(e){function i(e,t){if(-1!=e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}e.userid=n(),e.session={audio:!0,video:!0},e.maxParticipantsAllowed=256,e.direction="many-to-many",e.mediaConstraints={mandatory:{},optional:[],audio:{mandatory:{},optional:[]},video:{mandatory:{maxWidth:100,maxHeight:80,minFrameRate:30,maxFrameRate:30,minAspectRatio:1.77,maxAspectRatio:1.77},optional:[]}},e.candidates={host:!0,stun:!0,turn:!0},e.sdpConstraints={},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.privileges={canStopRemoteStream:!1,canMuteRemoteStream:!1},e.iceProtocols={tcp:!0,udp:!0},e.preferSCTP=N||z>=32?!0:!1,e.chunkInterval=N||z>=32?100:500,e.chunkSize=N||z>=32?13e3:1e3,e.fakeDataChannels=!1,e.waitUntilRemoteStreamStartsFlowing=null,e.leaveOnPageUnload=!0,e.getExternalIceServers=_,e.UA={isFirefox:N,isChrome:_,isMobileDevice:W,version:_?z:G,isNodeWebkit:H,isSafari:V,isIE:B,isOpera:L},e.fileQueue={},e.renegotiatedSessions={},e.channels={},e.extra={},e.bandwidth={screen:300},e.caniuse={RTCPeerConnection:DetectRTC.isWebRTCSupported,getUserMedia:!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia,AudioContext:DetectRTC.isAudioContextSupported,ScreenSharing:DetectRTC.isScreenCapturingSupported,RtpDataChannels:DetectRTC.isRtpDataChannelsSupported,SctpDataChannels:DetectRTC.isSctpDataChannelsSupported},e.snapshots={},e._mediaSources={},e.devices={},e.language="en",e.autoTranslateText=!1,e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.localStreamids=[],e.localStreams={},e.preRecordedMedias={},e.attachStreams=[],e.detachStreams=[],e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300}],mandatory:{}},e.dataChannelDict={},e.dontAttachStream=!1,e.dontCaptureUserMedia=!1,e.preventSSLAutoAllowed=!1,e.autoReDialOnFailure=!0,e.isInitiator=!1,e.DetectRTC=DetectRTC,e.trickleIce=!0,e.sessionDescriptions={},e.sessionDescription=null,e.resources={RecordRTC:"https://cdn.webrtc-experiment.com/RecordRTC.js",PreRecordedMediaStreamer:"https://cdn.webrtc-experiment.com/PreRecordedMediaStreamer.js",customGetUserMediaBar:"https://cdn.webrtc-experiment.com/navigator.customGetUserMediaBar.js",html2canvas:"https://cdn.webrtc-experiment.com/screenshot.js",hark:"https://cdn.webrtc-experiment.com/hark.js",firebase:"https://cdn.webrtc-experiment.com/firebase.js",firebaseio:"https://webrtc.firebaseIO.com/",muted:"https://cdn.webrtc-experiment.com/images/muted.png",getConnectionStats:"https://cdn.webrtc-experiment.com/getConnectionStats.js",FileBufferReader:"https://cdn.webrtc-experiment.com/FileBufferReader.js"},e.body=document.body||document.documentElement,e.peers={},e.firebase="chat",e.numberOfSessions=0,e.numberOfConnectedUsers=0,e.enableFileSharing=!0,e.autoSaveToDisk=!1,e.processSdp=function(e){return e},e.onmessage=function(e){m("onmessage",f(e))},e.onopen=function(e){m("Data connection is opened between you and",e.userid)},e.onerror=function(e){l(onerror,f(e))},e.onclose=function(t){p("onclose",f(t)),e.streams.remove({userid:t.userid})};var a={};e.onFileStart=function(t){var n=document.createElement("div");n.title=t.name,n.innerHTML="<label>0%</label> <progress></progress>",e.body.insertBefore(n,e.body.firstChild),a[t.uuid]={div:n,progress:n.querySelector("progress"),label:n.querySelector("label")},a[t.uuid].progress.max=t.maxChunks},e.onFileProgress=function(e){var t=a[e.uuid];t&&(t.progress.value=e.currentPosition||e.maxChunks||t.progress.max,i(t.progress,t.label))},e.onFileEnd=function(t){a[t.uuid]&&(a[t.uuid].div.innerHTML='<a href="'+t.url+'" target="_blank" download="'+t.name+'">'+t.name+"</a>"),(e.onFileSent||e.onFileReceived)&&(e.onFileSent&&e.onFileSent(t,t.uuid),e.onFileReceived&&e.onFileReceived(t.name,t))},e.onstream=function(t){e.body.insertBefore(t.mediaElement,e.body.firstChild)},e.onstreamended=function(e){if(m("onStreamEndedHandler:",e),!e.mediaElement)return p("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode){if(e.mediaElement=document.getElementById(e.streamid),!e.mediaElement)return p("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode)return p("Event.mediElement.parentNode is null.",e)}e.mediaElement.parentNode.removeChild(e.mediaElement)},e.onSessionClosed=function(e){e.isEjected?p(e.userid,"ejected you."):p("Session has been closed.",e)},e.onmute=function(t){t.isVideo&&t.mediaElement&&(t.mediaElement.pause(),t.mediaElement.setAttribute("poster",t.snapshot||e.resources.muted)),t.isAudio&&t.mediaElement&&(t.mediaElement.muted=!0)},e.onunmute=function(e){e.isVideo&&e.mediaElement&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),e.isAudio&&e.mediaElement&&(e.mediaElement.muted=!1)},e.onleave=function(e){m("onleave",f(e))},e.token=n,e.peers[e.userid]={drop:function(){e.drop()},renegotiate:function(){},addStream:function(){},hold:function(){},unhold:function(){},changeBandwidth:function(){},sharePartOfScreen:function(){}},e._skip=["stop","mute","unmute","_private","_selectStreams","selectFirst","selectAll","remove"],e.streams={mute:function(e){this._private(e,!0)},unmute:function(e){this._private(e,!1)},_private:function(t,n){function i(e,t,n){t.local&&"local"!=e.type||t.remote&&"remote"!=e.type||(!t.isScreen||e.isScreen)&&(!t.isAudio||e.isAudio)&&(!t.isVideo||e.isVideo)&&(n?e.mute(t):e.unmute(t))}if(!t||r(t))for(var o in this)-1==e._skip.indexOf(o)&&this[o]._private(t,n);else for(var o in this)-1==e._skip.indexOf(o)&&i(this[o],t,n)},stop:function(t){function n(e,t){t.userid&&e.userid!=t.userid||t.local&&"local"!=e.type||t.remote&&"remote"!=e.type||(t.screen&&e.isScreen&&e.stop(),t.audio&&e.isAudio&&e.stop(),t.video&&e.isVideo&&e.stop(),t.audio||t.video||t.screen||e.stop())}var i;for(var o in this)if(-1==e._skip.indexOf(o))if(i=this[o],t)if(r(t)){var s={};s[t]=!0,n(i,s)}else n(i,t);else i.stop()},remove:function(t){function n(e,t){t.userid&&e.userid!=t.userid||t.local&&"local"!=e.type||t.remote&&"remote"!=e.type||(t.screen&&e.isScreen&&i(e),t.audio&&e.isAudio&&i(e),t.video&&e.isVideo&&i(e),t.audio||t.video||t.screen||i(e))}function i(t){g(t,e),delete e.streams[t.streamid]}var o;for(var s in this)if(-1==e._skip.indexOf(s))if(o=this[s],t)if(r(t)){var a={};a[t]=!0,n(o,a)}else n(o,t);else n(o,{local:!0,remote:!0})},selectFirst:function(e){return this._selectStreams(e,!1)},selectAll:function(e){return this._selectStreams(e,!0)},_selectStreams:function(t,n){if(!t||r(t)||s(t))throw"Invalid arguments.";o(t.local)&&o(t.remote)&&o(t.userid)&&(t.local=t.remote=!0),t.isAudio||t.isVideo||t.isScreen||(t.isAudio=t.isVideo=t.isScreen=!0);var i=[];for(var a in this)-1==e._skip.indexOf(a)&&(a=this[a])&&(t.local&&"local"==a.type||t.remote&&"remote"==a.type||t.userid&&a.userid==t.userid)&&(t.isVideo&&a.isVideo&&i.push(a),t.isAudio&&a.isAudio&&i.push(a),t.isScreen&&a.isScreen&&i.push(a));return n?i:i[0]}},e.iceServers=de.getIceServers(),e.rtcConfiguration={iceServers:null,iceTransports:"all",peerIdentity:!1},e.media={min:function(t,n){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.minWidth=t,e.mediaConstraints.video.mandatory.minHeight=n)},max:function(t,n){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.maxWidth=t,e.mediaConstraints.video.mandatory.maxHeight=n)}},e._getStream=function(t){function n(e,t,n){if(n){var i=n.onpause,o=n.onplay;n.onpause=n.onplay=function(){},t?n.pause():n.play(),n.onpause=i,n.onplay=o}}var i=b({sockets:t.socket?[t.socket]:[]},t);return i.stop=function(){var e=this;if(e.sockets.forEach(function(t){"local"==e.type&&t.send({streamid:e.streamid,stopped:!0}),"remote"==e.type&&t.send({promptStreamStop:!0,streamid:e.streamid})}),"remote"!=e.type){var t=e.stream;t&&e.rtcMultiConnection.stopMediaStream(t)}},i.mute=function(e){this.muted=!0,this._private(e,!0)},i.unmute=function(e){this.muted=!1,this._private(e,!1)},i._private=function(e,t){return e&&!o(e.sync)&&0==e.sync?void n(e,t,this.mediaElement):void R({root:this,session:e,enabled:t,stream:this.stream})},i.startRecording=function(t){var n=this;return t||(t={audio:!0,video:!0}),r(t)&&(t={audio:"audio"==t,video:"video"==t}),window.RecordRTC?(m("started recording session",t),n.videoRecorder=n.audioRecorder=null,N?n.stream.getAudioTracks().length&&n.stream.getVideoTracks().length?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):t.video?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):t.audio&&(n.audioRecorder=RecordRTC(n.stream,{type:"audio"})):_&&(isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50&&n.stream.getAudioTracks().length&&n.stream.getVideoTracks().length?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50?t.video?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):t.audio&&(n.audioRecorder=RecordRTC(n.stream,{type:"audio"})):(t.video&&(n.videoRecorder=RecordRTC(n.stream,{type:"video"})),t.audio&&(n.audioRecorder=RecordRTC(n.stream,{type:"audio"})))),n.audioRecorder&&n.audioRecorder.startRecording(),void(n.videoRecorder&&n.videoRecorder.startRecording())):y(n.rtcMultiConnection.resources.RecordRTC,function(){n.startRecording(t)})},i.stopRecording=function(e,t){t||(t={audio:!0,video:!0}),r(t)&&(t={audio:"audio"==t,video:"video"==t}),m("stopped recording session",t);var n=this;t.audio&&n.audioRecorder?n.audioRecorder.stopRecording(function(){t.video&&n.videoRecorder?n.videoRecorder.stopRecording(function(){e({audio:n.audioRecorder.getBlob(),video:n.videoRecorder.getBlob()})}):e({audio:n.audioRecorder.getBlob()})}):t.video&&n.videoRecorder&&n.videoRecorder.stopRecording(function(){e({video:n.videoRecorder.getBlob()})})},i.takeSnapshot=function(t){w({mediaElement:this.mediaElement,userid:this.userid,connection:e,callback:t})},i.streamObject=i,i},e.set=function(e){for(var t in e)this[t]=e[t];return this},e.onMediaError=function(e){l("name",e.name),l("constraintName",f(e.constraintName)),l("message",e.message),l("original session",e.session)},e.takeSnapshot=function(t,n){w({userid:t,connection:e,callback:n})},e.saveToDisk=function(e,t){e.size&&e.type?me.SaveToDisk(URL.createObjectURL(e),t||e.name||e.type.replace("/","-")+e.type.split("/")[1]):me.SaveToDisk(e,t)},e.selectDevices=function(t,n){function i(t){t&&(e._mediaSources[t.kind]=t.id)}t&&i(this.devices[t]),n&&i(this.devices[n])},e.getDevices=function(t){return DetectRTC.MediaDevices.length?(DetectRTC.MediaDevices.forEach(function(t){e.devices[t.deviceId]=t}),void(t&&t(e.devices))):setTimeout(function(){e.getDevices(t)},1e3)},e.getMediaDevices=e.enumerateDevices=function(t){if(!t)throw"callback is mandatory.";e.getDevices(function(){t(e.DetectRTC.MediaDevices)})},e.onCustomMessage=function(e){m("Custom message",e)},e.ondrop=function(e){m("Media connection is dropped by "+e)},e.drop=function(t){t=t||{},e.attachStreams=[];for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],"local"==n.type?(e.detachStreams.push(n.streamid),g(n,e)):g(n,e));e.sendCustomMessage({drop:!0,dontRenegotiate:o(t.renegotiate)?!0:t.renegotiate})},e.Translator={TranslateText:function(t,n){var i=document.createElement("script");i.type="text/javascript";var o=encodeURIComponent(t),r="method"+e.token();window[r]=function(e){e.data&&e.data.translations[0]&&n&&n(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"==e.error.message&&(p('Text translation failed. Error message: "Daily Limit Exceeded."'),n(t))};var s="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+o;i.src=s,document.getElementsByTagName("head")[0].appendChild(i)}},e.setDefaultEventsForMediaElement=function(t,n){t.onpause=function(){e.streams[n]&&!e.streams[n].muted&&e.streams[n].mute()},t.onplay=function(){e.streams[n]&&e.streams[n].muted&&e.streams[n].unmute()};var i=!1;t.onvolumechange=function(){i||(i=!0,e.streams[n]&&setTimeout(function(){var o=e.streams[n];e.streams[n].sockets.forEach(function(e){e.send({streamid:o.streamid,isVolumeChanged:!0,volume:t.volume})}),i=!1},2e3))}},e.onMediaFile=function(t){m("onMediaFile",t),e.body.appendChild(t.mediaElement)},e.shareMediaFile=function(t,n,i){return i=i||e.token(),PreRecordedMediaStreamer?PreRecordedMediaStreamer.shareMediaFile({file:t,video:n,streamerid:i,connection:e}):(y(e.resources.PreRecordedMediaStreamer,function(){e.shareMediaFile(t,n,i)}),i)},e.onpartofscreen=function(t){var n=document.createElement("img");n.src=t.screenshot,e.body.appendChild(n)},e.skipLogs=function(){m=l=p=function(){}},e.hold=function(t){for(var n in e.peers)e.peers[n].hold(t)},e.onhold=function(t){m("onhold",t),"audio"!=t.kind&&(t.mediaElement.pause(),t.mediaElement.setAttribute("poster",t.screenshot||e.resources.muted)),"audio"==t.kind&&(t.mediaElement.muted=!0)},e.unhold=function(t){for(var n in e.peers)e.peers[n].unhold(t)},e.onunhold=function(e){m("onunhold",e),"audio"!=e.kind&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),"audio"!=e.kind&&(e.mediaElement.muted=!1)},e.sharePartOfScreen=function(t){function n(){(!e.partOfScreen||e.partOfScreen.sharing)&&k({element:t.element,connection:e,callback:function(o){if(o!=i){i=o;for(var r in e.channels)e.channels[r].send({screenshot:o,isPartOfScreen:!0})}!t.once&&setTimeout(n,t.interval||200)}})}var i="";n(),e.partOfScreen=b({sharing:!0},t)},e.pausePartOfScreenSharing=function(){for(var t in e.peers)e.peers[t].pausePartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.resumePartOfScreenSharing=function(){for(var t in e.peers)e.peers[t].pausePartOfScreenSharing=!1;e.partOfScreen&&(e.partOfScreen.sharing=!0)},e.stopPartOfScreenSharing=function(){for(var t in e.peers)e.peers[t].stopPartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.takeScreenshot=function(t,n){if(!t||!n)throw"Invalid number of arguments.";if(!window.html2canvas)return y(e.resources.html2canvas,function(){e.takeScreenshot(t)});if(r(t)&&(t=document.querySelector(t),t||(t=document.getElementById(t))),!t)throw"HTML Element is inaccessible!";html2canvas(t,{onrendered:function(e){n(e.toDataURL())}})},e.onScreenCapturingExtensionAvailable=function(){m("It seems that screen capturing extension is installed and available on your system!")},!j&&DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable=function(){e.onScreenCapturingExtensionAvailable()}),e.changeBandwidth=function(t){for(var n in e.peers)e.peers[n].changeBandwidth(t)},e.convertToAudioStream=function(e){t(e)},
e.onstatechange=function(e){m("on:state:change ("+e.userid+"):",e.name+":",e.reason||"")},e.onfailed=function(e){e.peer.numOfRetries||(e.peer.numOfRetries=0),e.peer.numOfRetries++,l("ICE connectivity check is failed. Renegotiating peer connection."),e.peer.numOfRetries<2&&e.peer.renegotiate(),e.peer.numOfRetries>=2&&(e.peer.numOfRetries=0)},e.onconnected=function(e){m("Peer connection has been established between you and",e.userid),getdata(),m("Peer connection has been established between "+participants+"(you) and",e.userid);var t=e.userid,n=t.split("-",1);participants.split("-",1);-1===array.indexOf(participants+" , ")?array.push(participants+" , "):J.log("This item already exists"+participants),-1===array.indexOf(n+" , ")?array.push(n+" , "):J.log("This item already exists"+n),customFunctionForUpdateList(),customFunctionForUserCount()},e.ondisconnected=function(t){l("Peer connection seems has been disconnected between you and",t.userid),l("Peer connection seems has been disconnected between "+participants+" you and",t.userid);var n=t.userid,i=n.split("-",1);myDelete(i+" , "),customFunctionForUpdateList(),customFunctionForUserCount(),$("#a").show(),$("#a").html("A Network Problem Occured. "+i[0]+" Reconnecting..."),setTimeout(function(){$("#a").html(" ")},5e3),e.peers["user-id"].renegotiate(),s(e.channels)||e.channels[t.userid]&&(e.channels[t.userid].send({checkingPresence:!0}),setTimeout(function(){return e.peers[t.userid].connected?void delete e.peers[t.userid].connected:(e.streams.remove({remote:!0,userid:t.userid}),void e.remove(t.userid))},3e3))},e.onstreamid=function(e){m("got remote streamid",e.streamid,"from",e.userid);var t=e.streamid.split("-",1);-1===array.indexOf(t+" , ")?array.push(t+" , "):J.log("This item already exists"),customFunctionForUpdateList(),customFunctionForUserCount()},e.stopMediaStream=function(t){if(!t)throw"MediaStream argument is mandatory.";if(e.keepStreamsOpened)return void(t.onended&&t.onended());e.localStreams[t.streamid]&&delete e.localStreams[t.streamid],N&&t.onended&&t.onended();var n=Boolean((t.getAudioTracks||t.getVideoTracks)&&(t.getAudioTracks()[0]&&!t.getAudioTracks()[0].stop||t.getVideoTracks()[0]&&!t.getVideoTracks()[0].stop));return!t.getAudioTracks||n?void(t.stop&&t.stop()):(t.getAudioTracks().length&&t.getAudioTracks()[0].stop&&t.getAudioTracks().forEach(function(e){e.stop()}),void(t.getVideoTracks().length&&t.getVideoTracks()[0].stop&&t.getVideoTracks().forEach(function(e){e.stop()})))},e.changeBandwidth=function(t){if(!t||r(t)||s(t))throw'Invalid "bandwidth" arguments.';u(e.peers,function(e){e.peer.bandwidth=t}),e.renegotiate()},e.openSignalingChannel=function(t){if(!window.Firebase)return y(e.resources.firebase,function(){e.openSignalingChannel(t)});var n=t.channel||e.channel;e.firebase&&(e.resources.firebaseio=e.resources.firebaseio.replace("//chat.","//"+e.firebase+"."));var i=new Firebase(e.resources.firebaseio+n);i.channel=n,i.on("child_added",function(e){t.onmessage(e.val())}),i.send=function(e){for(var t in e)(o(e[t])||"function"==typeof e[t])&&(e[t]=!1);this.push(e)},e.socket||(e.socket=i),i.onDisconnect().remove(),setTimeout(function(){t.callback(i)},1)},e.Plugin=ie}window.RMCDefaultChannel=location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""),window.RTCMultiConnection=function(a){function d(t){return Y&&x(),w?t():void(w=new e(k,t))}function u(e,t){if(r(e)&&(k.skipOnNewSession=!0),!w)return m("Signaling channel is not ready. Connecting..."),void d(function(){m("Signaling channel is connected. Joining the session again..."),setTimeout(function(){u(e,t)},1e3)});if(r(e)){if(!k.sessionDescriptions[e])return setTimeout(function(){m("Session-Descriptions not found. Rechecking.."),u(e,t)},1e3);e=k.sessionDescriptions[e]}if(t)return h(function(){e.oneway=!0,u(e)},t);if(!e||!e.userid||!e.sessionid){n("missing arguments",arguments);var n='Invalid data passed over "connection.join" method.';throw k.onstatechange({userid:"browser",extra:{},name:"Unexpected data detected.",reason:n}),n}k.dontOverrideSession||(k.session=e.session);var o=k.extra||e.extra||{};e.oneway||i(e)?w.joinSession(e,o):h(function(){w.joinSession(e,o)})}function h(e,t,n){function o(n){if(n.data&&n.data.chromeMediaSourceId){window.removeEventListener("message",o);var i=n.data.chromeMediaSourceId;if(DetectRTC.screen.sourceId=i,DetectRTC.screen.chromeMediaSource="desktop","PermissionDeniedError"==i){var r={message:"https:"==location.protocol?"User denied to share content of his screen.":ee,name:"PermissionDeniedError",constraintName:u,session:d};return ae.mutex=!1,DetectRTC.screen.sourceId=null,k.onMediaError(r)}h(e,t)}n.data&&n.data.chromeExtensionStatus&&(p("Screen capturing extension status is:",n.data.chromeExtensionStatus),DetectRTC.screen.chromeMediaSource="screen",h(e,t,!0))}function a(t,n,i,o){if(k.onstatechange({userid:"browser",extra:{},name:"fetching-usermedia",reason:"About to capture user-media with constraints: "+f(t)}),k.preventSSLAutoAllowed&&!o&&_)return navigator.customGetUserMediaBar?void navigator.customGetUserMediaBar(t,function(){a(t,n,i,!0)},function(){k.onMediaError({name:"PermissionDeniedError",message:"User denied permission.",constraintName:t,session:d})}):void y(k.resources.customGetUserMediaBar,function(){a(t,n,i,o)});var s={onsuccess:function(e,o,r,s){S(e,o,r,s,t,n,i,u,c,d)},onerror:function(t,n){if(N&&"PERMISSION_DENIED"==t&&(t={message:"",name:"PermissionDeniedError",constraintName:n,session:d}),N&&n.video&&n.video.mozMediaSource)return i={message:Z,name:t.name||"PermissionDeniedError",constraintName:n,session:d},void k.onMediaError(i);if(r(t))return k.onMediaError({message:"Unknown Error",name:t,constraintName:n,session:d});if(t.name&&("PermissionDeniedError"==t.name||"DevicesNotFoundError"==t.name)){var i="Either: ";i+="\n Media resolutions are not permitted.",i+="\n Another application is using same media device.",i+="\n Media device is not attached or drivers not installed.",i+="\n You denied access once and it is still denied.",t.message&&t.message.length&&(i+="\n "+t.message),i={message:i,name:t.name,constraintName:n,session:d},k.onMediaError(i),_&&(d.audio||d.video)&&DetectRTC.load(function(){d.audio&&!DetectRTC.hasMicrophone&&(p("It seems that you have no microphone attached to your device/system."),d.audio=d.audio=!1,d.video||(alert("It seems that you are capturing microphone and there is no device available or access is denied. Reloading..."),location.reload())),d.video&&!DetectRTC.hasWebcam&&(p("It seems that you have no webcam attached to your device/system."),d.video=d.video=!1,d.audio||(alert("It seems that you are capturing webcam and there is no device available or access is denied. Reloading..."),location.reload())),DetectRTC.hasMicrophone||DetectRTC.hasWebcam?k.getUserMediaPromptedOnce||(k.getUserMediaPromptedOnce=!0,h(e,d)):(alert("It seems that either both microphone/webcam are not available or access is denied. Reloading..."),location.reload())})}if(t.name&&"ConstraintNotSatisfiedError"==t.name){var i="Either: ";i+="\n You are prompting unknown media resolutions.",i+="\n You are using invalid media constraints.",t.message&&t.message.length&&(i+="\n "+t.message),i={message:i,name:t.name,constraintName:n,session:d},k.onMediaError(i)}d.screen&&(N?l(Z):"https:"!==location.protocol?H||"file:"!=location.protocol&&"http:"!=location.protocol||l("You cannot use HTTP or file protocol for screen capturing. You must either use HTTPs or chrome extension page or Node-Webkit page."):l('Unable to detect actual issue. Maybe "deprecated" screen capturing flag was not set using command line or maybe you clicked "No" button or maybe chrome extension returned invalid "sourceId". Please install chrome-extension: http://bit.ly/webrtc-screen-extension')),ae.mutex=!1;var o=JSON.stringify(n);ae.streams[o]&&delete ae.streams[o]},mediaConstraints:k.mediaConstraints||{}};s.constraints=t||c,s.connection=k,D(s)}var d=t||k.session;if(s(d))return void(e&&e());if(k.dontCaptureUserMedia)return e();if(i(d)||!k.isInitiator&&d.oneway)return k.attachStreams=[],e();var c={audio:d.audio?{mandatory:{},optional:[{chromeRenderToAssociatedSink:!0}]}:!1,video:!!d.video};if(k._mediaSources.audio&&c.audio.optional.push({sourceId:k._mediaSources.audio}),k._mediaSources.audiooutput&&c.audio.optional.push({sourceId:k._mediaSources.audiooutput}),k._mediaSources.audioinput&&c.audio.optional.push({sourceId:k._mediaSources.audioinput}),k._mediaSources.video&&(c.video={optional:[{sourceId:k._mediaSources.video}]}),k._mediaSources.videoinput&&(c.video={optional:[{sourceId:k._mediaSources.videoinput}]}),!d.screen&&!c.audio&&!c.video)return e();var u={audio:!1,video:{mandatory:{chromeMediaSource:DetectRTC.screen.chromeMediaSource,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]}};if(N&&d.screen){if("https:"!==location.protocol)return l(ee);p(Z),u.video={mozMediaSource:"window",mediaSource:"window"},c.audio&&(u.audio=!0,c={}),delete u.video.chromeMediaSource}if(d.screen){if(_&&DetectRTC.screen.extensionid!=te&&(ne=!0),_&&!ne&&!n&&!DetectRTC.screen.sourceId)return P("message",o),Y||x(),void Y.postMessage();if(_&&ne&&!n&&"screen"==DetectRTC.screen.chromeMediaSource&&DetectRTC.screen.extensionid)return DetectRTC.screen.extensionid==te&&-1==document.domain.indexOf("webrtc-experiment.com")?h(e,t,!0):(m("checking if chrome extension is installed."),void DetectRTC.screen.getChromeExtensionStatus(function(n){"installed-enabled"==n&&(DetectRTC.screen.chromeMediaSource="desktop"),h(e,t,!0),m("chrome extension is installed?","desktop"==DetectRTC.screen.chromeMediaSource)}));if(_&&ne&&"desktop"==DetectRTC.screen.chromeMediaSource&&!DetectRTC.screen.sourceId)return void DetectRTC.screen.getSourceId(function(n){if("PermissionDeniedError"==n){var i={message:"User denied to share content of his screen.",name:"PermissionDeniedError",constraintName:u,session:d};return ae.mutex=!1,DetectRTC.screen.chromeMediaSource="desktop",k.onMediaError(i)}return"No-Response"==n?(l("Chrome extension seems not available. Make sure that manifest.json#L16 has valid content-script matches pointing to your URL."),DetectRTC.screen.chromeMediaSource="screen",h(e,t,!0)):void h(e,t,!0)});_&&"desktop"==DetectRTC.screen.chromeMediaSource&&(u.video.mandatory.chromeMediaSourceId=DetectRTC.screen.sourceId);var v=R;a(u,c.audio||c.video?function(){v&&(R=!0),a(c,e)}:e)}else a(c,e,d.audio&&!d.video)}function S(e,i,o,r,s,a,d,u,m,l){r||(r=n()),k.onstatechange({userid:"browser",extra:{},name:"usermedia-fetched",reason:"Captured user media using constraints: "+f(s)}),d&&(e=t(e)),k.localStreamids.push(r),e.onended=function(){h.mediaElement&&!h.mediaElement.parentNode&&document.getElementById(e.streamid)&&(h.mediaElement=document.getElementById(e.streamid)),k.attachStreams.forEach(function(t,n){t==e&&(delete k.attachStreams[n],k.attachStreams=c(k.attachStreams))}),g(h,k),k.streams[r]&&k.removeStream(r);var t=k.streams[r];t&&t.sockets.length&&t.sockets.forEach(function(e){e.send({streamid:t.streamid,stopped:!0})}),ae.mutex=!1,ae.streams[o]&&delete ae.streams[o],DetectRTC.screen.sourceId=null},B||(e.streamid=r,e.isScreen=s==u,e.isVideo=s==m&&!!m.video,e.isAudio=s==m&&!!m.audio&&!m.video,e.preMuted={audio:e.getAudioTracks().length&&!e.getAudioTracks()[0].enabled,video:e.getVideoTracks().length&&!e.getVideoTracks()[0].enabled});var p=v(e,l);p.muted=!0;var h={stream:e,streamid:r,mediaElement:p,blobURL:p.mozSrcObject?URL.createObjectURL(e):p.src,type:"local",userid:k.userid,extra:k.extra,session:l,isVideo:!!e.isVideo,isAudio:!!e.isAudio,isScreen:!!e.isScreen,isInitiator:!!k.isInitiator,rtcMultiConnection:k};R&&k.attachStreams.push(e),R=!1,k.streams[r]=k._getStream(h),i||k.onstream(h),k.setDefaultEventsForMediaElement&&k.setDefaultEventsForMediaElement(p,r),a&&a(e,h),k.onspeaking&&M({stream:e,streamedObject:h,connection:k})}var w,k=this;k.channel=a||RMCDefaultChannel,k.isAcceptNewSession=!0,k.open=function(e){k.isAcceptNewSession=!1,k.isInitiator=!0;var t=!1;return e&&(r(e)?k.sessionid=e:(o(e.transmitRoomOnce)||(k.transmitRoomOnce=e.transmitRoomOnce),o(e.dontTransmit)||(t=e.dontTransmit),o(e.sessionid)||(k.sessionid=e.sessionid))),k.socket&&k.socket.remove&&k.socket.remove(),k.sessionid||(k.sessionid=k.channel),k.sessionDescription={sessionid:k.sessionid,userid:k.userid,session:k.session,extra:k.extra},k.sessionDescriptions[k.sessionDescription.sessionid]||(k.numberOfSessions++,k.sessionDescriptions[k.sessionDescription.sessionid]=k.sessionDescription),d(function(){w.captureUserMediaOnDemand=e?!!e.captureUserMediaOnDemand:!1,e&&e.onMediaCaptured&&(k.onMediaCaptured=e.onMediaCaptured),w.captureUserMediaOnDemand||h(function(){w.initSession({sessionDescription:k.sessionDescription,dontTransmit:t}),C(k)}),w.captureUserMediaOnDemand&&w.initSession({sessionDescription:k.sessionDescription,dontTransmit:t})}),k.sessionDescription},k.connect=function(e){return e&&(k.sessionid=e),d(function(){m("Signaling channel is ready.")}),this},k.join=u,k.send=function(e,t){if(k.numberOfConnectedUsers<=0)return void setTimeout(function(){k.send(e,t)},1e3);if(!e)throw"No file, data or text message to share.";if(e instanceof Array&&!o(e[0].size)&&!o(e[0].type))for(var n=0;n<e.length;n++)e[n].size&&e[n].type&&k.send(e[n],t);else if(o(e.size)||o(e.type))le.send({text:e,channel:w,_channel:t,connection:k});else{if(!k.enableFileSharing)throw'"enableFileSharing" boolean MUST be "true" to support file sharing.';if(!w.fileBufferReader)return void T(k,function(n){w.fileBufferReader=n,k.send(e,t)});var i=b({userid:k.userid},e.extra||k.extra);w.fileBufferReader.readAsArrayBuffer(e,function(e){w.fileBufferReader.getNextChunk(e,function(e,n,i){t?t.send(e):w.send(e)})},i)}},k.disconnect=function(){w&&w.disconnect(),w=null};var R=!0;k.captureUserMedia=h,k.leave=function(e){return w?(R=!0,e?void k.eject(e):void w.leave()):void 0},k.eject=function(e){if(!k.isInitiator)throw"Only session-initiator can eject a user.";if(!k.peers[e])throw"You ejected invalid user.";k.peers[e].sendCustomMessage({ejected:!0})},k.close=function(){k.autoCloseEntireSession=!0,k.leave()},k.renegotiate=function(e,t){return k.numberOfConnectedUsers<=0?void setTimeout(function(){k.renegotiate(e,t)},1e3):void w.addStream({renegotiate:t||b({oneway:!0},k.session),stream:e})},k.attachExternalStream=function(e,t){var n={};e.getAudioTracks&&e.getAudioTracks().length&&(n.audio=!0),e.getVideoTracks&&e.getVideoTracks().length&&(n.video=!0);var i={video:{chromeMediaSource:"fake"}},o=t?i:n;S(e,!1,"",null,o,!1,!1,i,n,n)},k.addStream=function(e,t){function n(n){w.addStream({stream:n,renegotiate:e||k.session,socket:t})}if(k.numberOfConnectedUsers<=0)return void setTimeout(function(){k.addStream(e,t)},1e3);if(e){var i;!k.isInitiator&&e.oneway&&(e.oneway=!1,i=!0),h(function(t){i&&(e.oneway=!0),n(t)},e)}else n()},k.removeStream=function(e,t){function n(e,t){t.local&&"local"!=e.type||t.remote&&"remote"!=e.type||(t.screen&&e.isScreen&&k.detachStreams.push(e.streamid),t.audio&&e.isAudio&&k.detachStreams.push(e.streamid),t.video&&e.isVideo&&k.detachStreams.push(e.streamid),t.audio||t.video||t.screen||k.detachStreams.push(e.streamid),-1!=k.detachStreams.indexOf(e.streamid)&&(m("removing stream",e.streamid),g(e,k),t.stop&&k.stopMediaStream(e.stream)))}if(k.numberOfConnectedUsers<=0)return void setTimeout(function(){k.removeStream(e,t)},1e3);if(e||(e="all"),!r(e)||-1!=e.search(/all|audio|video|screen/gi)){for(var i in k.streams)if(-1==k._skip.indexOf(i))if(_stream=k.streams[i],"all"==e)n(_stream,{audio:!0,video:!0,screen:!0});else if(r(e)){var o={};o[e]=!0,n(_stream,o)}else n(_stream,e);return void(!t&&k.detachStreams.length&&k.renegotiate())}var i=k.streams[e];return i?(k.detachStreams.push(i.streamid),m("removing stream",i.streamid),g(i,k),void(t||k.renegotiate())):p("No such stream exists. Stream-id:",e)},k.switchStream=function(e){return k.numberOfConnectedUsers<=0?void setTimeout(function(){k.switchStream(e)},1e3):(k.removeStream("all",!0),void k.addStream(e))},k.sendCustomMessage=function(e){return w&&w.defaultSocket?void w.defaultSocket.send({customMessage:!0,message:e}):setTimeout(function(){k.sendCustomMessage(e)},1e3)},U(k)};var F=[],L=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,N="undefined"!=typeof window.InstallTrigger,V=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,_=!!window.chrome&&!L,B=!!document.documentMode,j=V||B,W=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),H=!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]);window.MediaStream=window.MediaStream||window.webkitMediaStream,window.AudioContext=window.AudioContext||window.webkitAudioContext;var z=50,q=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);_&&q&&q[2]&&(z=parseInt(q[2],10));var G=50;q=navigator.userAgent.match(/Firefox\/(.*)/),N&&q&&q[1]&&(G=parseInt(q[1],10));var J=window.console||{log:function(){},error:function(){},warn:function(){}};if(_||N||V)var m=J.log.bind(J),l=J.error.bind(J),p=J.warn.bind(J);var Y,K,Q={},X={},Z='Make sure that you are using Firefox Nightly and you enabled: media.getusermedia.screensharing.enabled flag from about:config page. You also need to add your domain in "media.getusermedia.screensharing.allowed_domains" flag. If you are using WinXP then also enable "media.getusermedia.screensharing.allow_on_old_platforms" flag. NEVER forget to use "only" HTTPs for screen capturing!',ee="HTTPs i.e. SSL-based URI is mandatory to use screen capturing.",te="ajhifddimkapgcifgcodmmfdlknahffk",ne=-1!=document.domain.indexOf("webrtc-experiment.com");attachEventListener=function(e,t,n,i){e.addEventListener(t,n,i)};var ie=window.PluginRTC||{};window.onPluginRTCInitialized=function(e){ie=e,MediaStreamTrack=ie.MediaStreamTrack,re=ie.RTCPeerConnection,ue=ie.RTCIceCandidate,ce=ie.RTCSessionDescription,m(j?"Java-Applet":"ActiveX","plugin has been loaded.")},s(ie)||window.onPluginRTCInitialized(ie),j&&y("https://cdn.webrtc-experiment.com/Plugin.EveryWhere.js");var oe=window.MediaStream;"undefined"==typeof oe&&"undefined"!=typeof webkitMediaStream&&(oe=webkitMediaStream),"undefined"==typeof oe||"stop"in oe.prototype||(oe.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop()}),this.getVideoTracks().forEach(function(e){e.stop()})});var re,se={mandatory:{},optional:[]},ae={streams:[],mutex:!1,queueRequests:[]},de=function(){function e(e){var i=[];return i.push(t("stun:stun.l.google.com:19302")),i.push(n("stun:webrtcweb.com:7788","muazkh","muazkh")),i.push(n("turn:webrtcweb.com:7788","muazkh","muazkh")),i.push(n("turn:webrtcweb.com:8877","muazkh","muazkh")),i.push(n("turns:webrtcweb.com:7788","muazkh","muazkh")),i.push(n("turns:webrtcweb.com:8877","muazkh","muazkh")),i.push(n("stun:webrtcweb.com:4455","muazkh","muazkh")),i.push(n("turn:webrtcweb.com:4455","muazkh","muazkh")),i.push(n("turn:webrtcweb.com:5544?transport=tcp","muazkh","muazkh")),i}function t(e){var t="urls";"undefined"!=typeof j&&(t="url");var n={};return n[t]=e,n}function n(e,t,n){var i="urls";"undefined"!=typeof j&&(i="url");var o={username:t,credential:n};return o[i]=e,o}return{getIceServers:e}}(),ce=window.RTCSessionDescription||window.mozRTCSessionDescription,ue=window.RTCIceCandidate||window.mozRTCIceCandidate;"undefined"!=typeof mozRTCPeerConnection?re=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection?re=webkitRTCPeerConnection:"undefined"!=typeof window.RTCPeerConnection?re=window.RTCPeerConnection:J.error("WebRTC 1.0 (RTCPeerConnection) API seems NOT available in this browser.");var me={SaveToDisk:A},le={send:function(e){function t(e,n){var r={type:"text",uuid:m,sendingTime:l};e&&(n=e,r.packets=parseInt(n.length/d)),n.length>d?r.message=n.slice(0,d):(r.message=n,r.last=!0,r.isobject=u),o.send(r,s),c=n.slice(r.message.length),c.length&&setTimeout(function(){t(null,c)},i.chunkInterval||100)}var i=e.connection;if(e.text instanceof ArrayBuffer||e.text instanceof DataView)return e.channel.send(e.text,e._channel);var o=e.channel,s=e._channel,a=e.text,d=i.chunkSize||1e3,c="",u=!1;r(a)||(u=!0,a=JSON.stringify(a));var m=n(),l=(new Date).getTime();t(a)}};!function(){"use strict";function e(){var e,t,n,i=(o.appVersion,o.userAgent),r=o.appName,a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10);return-1!==(t=i.indexOf("Opera"))?(r="Opera",a=i.substring(t+6),-1!==(t=i.indexOf("Version"))&&(a=i.substring(t+8))):-1!==(t=i.indexOf("MSIE"))?(r="IE",a=i.substring(t+5)):-1!==(t=i.indexOf("Chrome"))?(r="Chrome",a=i.substring(t+7)):-1!==(t=i.indexOf("Safari"))?(r="Safari",a=i.substring(t+7),-1!==(t=i.indexOf("Version"))&&(a=i.substring(t+8))):-1!==(t=i.indexOf("Firefox"))?(r="Firefox",a=i.substring(t+8)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(r=i.substring(e,t),a=i.substring(t+1),r.toLowerCase()===r.toUpperCase()&&(r=o.appName)),s&&(r="Edge",a=parseInt(o.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10)),-1!==(n=a.indexOf(";"))&&(a=a.substring(0,n)),-1!==(n=a.indexOf(" "))&&(a=a.substring(0,n)),d=parseInt(""+a,10),isNaN(d)&&(a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10)),{fullVersion:a,version:d,name:r}}function t(e){n(function(t){e(t.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+t:"Public: "+t)})}function n(e){function t(t){var i=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,o=i.exec(t)[1];void 0===n[o]&&e(o),n[o]=!0}var n={},i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,o=!!window.webkitRTCPeerConnection;if(!i){var r=document.getElementById("iframe");if(!r)throw"NOTE: you need to have an iframe in the page right above the script tag.";var s=r.contentWindow;i=s.RTCPeerConnection||s.mozRTCPeerConnection||s.webkitRTCPeerConnection,o=!!s.webkitRTCPeerConnection}var a,d={optional:[{RtpDataChannels:!0}]};o&&(a={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},"undefined"!=typeof v&&v.browser.isFirefox&&v.browser.version<=38&&(a[0]={url:a[0].urls}));var c=new i(a,d);c.onicecandidate=function(e){e.candidate&&t(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&t(e)})},1e3)}function i(e){return!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices?(m=[],void o.enumerateDevices(function(t){t.forEach(function(e){var t={};for(var n in e)t[n]=e[n];var i;m.forEach(function(e){e.id===t.id&&(i=!0)}),i||("audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label||(t.label="Please invoke getUserMedia once.",g||(t.label="HTTPs is required to get label of this "+t.kind+" device.")),("audioinput"===t.kind||"audio"===t.kind)&&(p=!0),"audiooutput"===t.kind&&(f=!0),("videoinput"===t.kind||"video"===t.kind)&&(h=!0),m.push(t))}),"undefined"!=typeof v&&(v.MediaDevices=m,v.hasMicrophone=p,v.hasSpeakers=f,v.hasWebcam=h),e&&e()})):void(e&&e())}var o=window.navigator;o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){o.mediaDevices.enumerateDevices().then(e)}),"undefined"!=typeof o?("undefined"!=typeof o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),"undefined"!=typeof o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){}};var r=!!o.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),s=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),a={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return a.Android()||a.BlackBerry()||a.iOS()||a.Opera()||a.Windows()},getOsName:function(){var e="Unknown OS";return a.Android()&&(e="Android"),a.BlackBerry()&&(e="BlackBerry"),a.iOS()&&(e="iOS"),a.Opera()&&(e="Opera Mini"),a.Windows()&&(e="Windows"),e}},d="Unknown OS";a.any()?d=a.getOsName():(-1!==o.appVersion.indexOf("Win")&&(d="Windows"),-1!==o.appVersion.indexOf("Mac")&&(d="MacOS"),-1!==o.appVersion.indexOf("X11")&&(d="UNIX"),-1!==o.appVersion.indexOf("Linux")&&(d="Linux"));var c=!1,u=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(c=!0),e in document.createElement("video")&&(u=!0)});var m=[],l=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?l=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(l=!0);var p=l,f=l,h=l;i();var v={};v.browser=e(),v.browser["is"+v.browser.name]=!0;var g="https:"===location.protocol,S=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){e in window&&(S=!0)}),v.isWebRTCSupported=S,v.isORTCSupported="undefined"!=typeof RTCIceGatherer;var w=!1;v.browser.isChrome&&v.browser.version>=35?w=!0:v.browser.isFirefox&&v.browser.version>=34&&(w=!0),g||(w=!1),v.isScreenCapturingSupported=w;var C={};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){C.isSupported&&C.isCreateMediaStreamSourceSupported||e in window&&(C.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(C.isCreateMediaStreamSourceSupported=!0))}),v.isAudioContextSupported=C.isSupported,v.isCreateMediaStreamSourceSupported=C.isCreateMediaStreamSourceSupported;var b=!1;v.browser.isChrome&&v.browser.version>31&&(b=!0),v.isRtpDataChannelsSupported=b;var y=!1;if(v.browser.isFirefox&&v.browser.version>28?y=!0:v.browser.isChrome&&v.browser.version>25?y=!0:v.browser.isOpera&&v.browser.version>=11&&(y=!0),v.isSctpDataChannelsSupported=y,v.isMobileDevice=r,v.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,v.isWebSocketsBlocked="Checking",v.isWebSocketsSupported){var k=new WebSocket("wss://echo.websocket.org:443/");k.onopen=function(){v.isWebSocketsBlocked=!1,v.loadCallback&&v.loadCallback()},k.onerror=function(){v.isWebSocketsBlocked=!0,v.loadCallback&&v.loadCallback()}}var T=!1;o.getUserMedia?T=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(T=!0),v.browser.isChrome&&v.browser.version>=47&&!g&&(v.isGetUserMediaSupported="Requires HTTPs"),v.isGetUserMediaSupported=T,v.osName=d,v.isCanvasSupportsStreamCapturing=c,v.isVideoSupportsStreamCapturing=u,v.DetectLocalIPAddress=t,v.load=function(e){this.loadCallback=e,i(e)},v.MediaDevices=m,v.hasMicrophone=p,v.hasSpeakers=f,v.hasWebcam=h;var x=!1;"setSinkId"in document.createElement("video")&&(x=!0),v.isSetSinkIdSupported=x;var R=!1;v.browser.isFirefox?"getSenders"in mozRTCPeerConnection.prototype&&(R=!0):v.browser.isChrome&&"getSenders"in webkitRTCPeerConnection.prototype&&(R=!0),v.isRTPSenderReplaceTracksSupported=R;var M=!1;v.browser.isFirefox&&v.browser.version>38&&(M=!0),v.isRemoteStreamProcessingSupported=M;var D=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(D=!0),v.isApplyConstraintsSupported=D;var O=!1;v.browser.isFirefox&&v.browser.version>=43&&(O=!0),v.isMultiMonitorScreenCapturingSupported=O,window.DetectRTC=v}();var pe;DetectRTC.screen={chromeMediaSource:"screen",extensionid:te,getSourceId:function(e){function t(t){return"installed-enabled"==t?(pe=e,void window.postMessage("get-sourceId","*")):(DetectRTC.screen.chromeMediaSource="screen",void e("No-Response"))}if(!e)throw'"callback" parameter is mandatory.';DetectRTC.screen.status?t(DetectRTC.screen.status):DetectRTC.screen.getChromeExtensionStatus(t)},onMessageCallback:function(e){if(r(e)||e.sourceId){if(m("chrome message",e),"PermissionDeniedError"==e){if(DetectRTC.screen.chromeMediaSource="PermissionDeniedError",pe)return pe("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(DetectRTC.screen.chromeMediaSource="desktop",DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable(),DetectRTC.screen.onScreenCapturingExtensionAvailable=null)),e.sourceId&&(DetectRTC.screen.sourceId=e.sourceId,pe&&pe(DetectRTC.screen.sourceId))}},getChromeExtensionStatus:function(e,t){function n(e){DetectRTC.screen.status=e,t(e)}if(N)return n("not-chrome");2!=arguments.length&&(t=e,e=this.extensionid);var i=document.createElement("img");i.src="chrome-extension://"+e+"/icon.png",i.onload=function(){DetectRTC.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){n("screen"==DetectRTC.screen.chromeMediaSource?"desktop"==DetectRTC.screen.chromeMediaSource?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},i.onerror=function(){n("not-installed")}}},window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.addEventListener("message",function(e){e.origin==window.location.origin&&DetectRTC.screen.onMessageCallback(e.data)})}();var participants,reconnectuser,hashmapforuserid={},useridforusers,array=[];!function(){function e(e,t){function u(t){return t.data.checkingPresence&&e.channels[t.userid]?void e.channels[t.userid].send({presenceDetected:!0}):t.data.presenceDetected&&e.peers[t.userid]?void(e.peers[t.userid].connected=!0):void("text"===t.data.type?ee.receive(t.data,t.userid,t.extra):e.autoTranslateText?(t.original=t.data,e.Translator.TranslateText(t.data,function(n){t.data=n,e.onmessage(t)})):e.onmessage(t))}function R(t){return e.skipOnNewSession||(t.session||(t.session={}),t.extra||(t.extra={}),e.sessionid&&t.sessionid!=e.sessionid)?void 0:e.onNewSession?(t.join=function(n){if(!n)return e.join(t);for(var i in n)t.session[i]=n[i];var o=e.dontCaptureUserMedia;e.dontCaptureUserMedia=!1,e.captureUserMedia(function(){e.dontCaptureUserMedia=!0,e.join(t),e.dontCaptureUserMedia=o},n)},t.extra||(t.extra={}),e.onNewSession(t)):void e.join(t)}function D(t){for(var n=0;n<e.localStreamids.length;n++){var i=e.localStreamids[n];e.streams[i]&&e.streams[i].sockets.push(t)}}function O(t){function n(t){return W||j||o(e.waitUntilRemoteStreamStartsFlowing)||!e.waitUntilRemoteStreamStartsFlowing?l(t):(t.numberOfTimes||(t.numberOfTimes=0),t.numberOfTimes++,t.mediaElement.readyState<=HTMLMediaElement.HAVE_CURRENT_DATA||t.mediaElement.paused||t.mediaElement.currentTime<=0?t.numberOfTimes>=60?F.send({failedToReceiveRemoteVideo:!0,streamid:t.stream.streamid}):void setTimeout(function(){m("Waiting for incoming remote stream to be started flowing: "+t.numberOfTimes+" seconds."),n(t)},900):l(t))}function d(){if(e.fakeDataChannels&&!e.channels[t.userid]&&!e.session.data){var n={send:function(e){F.send({fakeData:e})},readyState:"open"};e.channels[t.userid]={channel:n,send:function(e){this.channel.send(e)}},_.onopen(n)}}function l(n){var i=n.mediaElement,o=n.session,r=n.stream;r.onended=function(){a.mediaElement&&!a.mediaElement.parentNode&&document.getElementById(r.streamid)&&(a.mediaElement=document.getElementById(r.streamid)),g(a,e)};var a={mediaElement:i,stream:r,streamid:r.streamid,session:o||e.session,blobURL:j?"":i.mozSrcObject?URL.createObjectURL(r):i.src,type:"remote",extra:t.extra,userid:t.userid,isVideo:j?!!o.video:!!r.isVideo,isAudio:j?!!o.audio&&!o.video:!!r.isAudio,isScreen:!!r.isScreen,isInitiator:!!t.isInitiator,rtcMultiConnection:e,socket:F};if(e.streams[r.streamid]=e._getStream(a),e.onstream(a),!s(n.preMuted)&&(n.preMuted.audio||n.preMuted.video)){var d=b({},a);d.session=b(d.session,n.preMuted),d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!1,
e.onmute(d)}m("on:add:stream",a),R(),e.onspeaking&&M({stream:r,streamedObject:a,connection:e})}function C(n){t.channel=n,e.channels[t.userid]={channel:t.channel,send:function(t){e.send(t,this.channel)}},e.onopen({extra:t.extra,userid:t.userid,channel:n});for(var o in e.fileQueue)e.send(e.fileQueue[o],n);i(e.session)&&R(),e.partOfScreen&&e.partOfScreen.sharing&&e.peers[t.userid].sharePartOfScreen(e.partOfScreen)}function x(){F.userid!=t.userid&&(F.userid=t.userid,Q[t.socketIndex]=F,e.numberOfConnectedUsers++,e.peers[t.userid]={socket:F,peer:L,userid:t.userid,extra:t.extra,userinfo:t.userinfo,addStream:function(t){e.addStream(t,this.socket)},removeStream:function(t){return e.streams[t]?(this.peer.connection.removeStream(e.streams[t].stream),void this.renegotiate()):p("No such stream exists. Stream-id:",t)},renegotiate:function(t,n){e.renegotiate(t,n)},changeBandwidth:function(e){if(!e)throw"You MUST pass bandwidth object.";if(r(e))throw"Pass object for bandwidth instead of string; e.g. {audio:10, video:20}";this.peer.bandwidth=e,this.socket.send({changeBandwidth:!0,bandwidth:e})},sendCustomMessage:function(e){this.socket.send({customMessage:!0,message:e})},onCustomMessage:function(e){m('Received "private" message from',this.userid,r(e)?e:f(e))},drop:function(t){for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],n.userid==e.userid&&"local"==n.type&&(this.peer.connection.removeStream(n.stream),g(n,e)),"remote"==n.type&&n.userid==this.userid&&g(n,e));!t&&this.socket.send({drop:!0})},hold:function(t){return"answer"==L.prevCreateType?void this.socket.send({unhold:!0,holdMLine:t||"both",takeAction:!0}):(this.socket.send({hold:!0,holdMLine:t||"both"}),this.peer.hold=!0,void this.fireHoldUnHoldEvents({kind:t,isHold:!0,userid:e.userid,remoteUser:this.userid}))},unhold:function(t){return"answer"==L.prevCreateType?void this.socket.send({unhold:!0,holdMLine:t||"both",takeAction:!0}):(this.socket.send({unhold:!0,holdMLine:t||"both"}),this.peer.hold=!1,void this.fireHoldUnHoldEvents({kind:t,isHold:!1,userid:e.userid,remoteUser:this.userid}))},fireHoldUnHoldEvents:function(t){var n=t.isHold,i=t.kind,o=t.remoteUser||t.userid;for(var r in e.streams)-1==e._skip.indexOf(r)&&(r=e.streams[r],r.userid==o&&(n&&e.onhold(b({kind:i},r)),n||e.onunhold(b({kind:i},r))))},redial:function(){for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],t.userid==this.userid&&"remote"==t.type&&g(t,e));m("ReDialing..."),F.send({recreatePeer:!0}),L=new E,L.create("offer",_)},sharePartOfScreen:function(t){function n(){return i.stopPartOfScreenSharing?(i.stopPartOfScreenSharing=!1,void(e.onpartofscreenstopped&&e.onpartofscreenstopped())):i.pausePartOfScreenSharing?(e.onpartofscreenpaused&&e.onpartofscreenpaused(),setTimeout(n,t.interval||200)):void k({element:t.element,connection:e,callback:function(r){if(!e.channels[i.userid])throw"No such data channel exists.";r!=o&&(o=r,e.channels[i.userid].send({screenshot:r,isPartOfScreen:!0})),!t.once&&setTimeout(n,t.interval||200)}})}var i=this,o="";n()},getConnectionStats:function(t,n){function i(){re.prototype.getConnectionStats=window.getConnectionStats,L.connection&&L.connection.getConnectionStats(t,n)}if(!t)throw"callback is mandatory.";window.getConnectionStats?i():y(e.resources.getConnectionStats,i)},takeSnapshot:function(t){w({userid:this.userid,connection:e,callback:t})}})}function R(){if(e.isInitiator&&h(Z)&&h(Z)<=e.maxParticipantsAllowed&&(e.session.oneway||e.session.broadcast||te.send({sessionid:e.sessionid,newParticipant:t.userid||F.channel,userData:{userid:t.userid||F.channel,extra:t.extra}})),"chrome"==t.userinfo.browser&&!t.renegotiatedOnce)for(var n in e.renegotiatedSessions)t.renegotiatedOnce=!0,e.renegotiatedSessions[n]&&e.renegotiatedSessions[n].stream&&e.peers[t.userid].renegotiate(e.renegotiatedSessions[n].stream,e.renegotiatedSessions[n].session)}function O(n){if(!ne&&n.userid!=e.userid){if(n.sdp){t.userid=n.userid,t.extra=n.extra||{},t.renegotiate=n.renegotiate,t.streaminfo=n.streaminfo,t.isInitiator=n.isInitiator,t.userinfo=n.userinfo;var i=JSON.parse(n.sdp);"offer"==i.type&&(_.preferSCTP=!!n.preferSCTP,e.fakeDataChannels=!!n.fakeDataChannels),d(),I(i,n.labels)}if(n.candidate&&L&&L.addIceCandidate(JSON.parse(n.candidate)),n.streamid&&(X.streamids||(X.streamids={}),X.streamids[n.streamid]||(X.streamids[n.streamid]=n.streamid,e.onstreamid(n))),n.mute||n.unmute)if(n.promptMuteUnmute){if(!e.privileges.canMuteRemoteStream)return void e.onstatechange({userid:n.userid,extra:n.extra,name:"mute-request-denied",reason:n.userid+' tried to mute your stream; however "privileges.canMuteRemoteStream" is "false".'});e.streams[n.streamid]&&(n.mute&&!e.streams[n.streamid].muted&&e.streams[n.streamid].mute(n.session),n.unmute&&e.streams[n.streamid].muted&&e.streams[n.streamid].unmute(n.session))}else{var o={};e.streams[n.streamid]&&(o=e.streams[n.streamid]);var r=n.session,s=b({},o);s.session=r,s.isAudio=!!s.session.audio&&!s.session.video,s.isVideo=!!s.session.video,s.isScreen=!!s.session.screen,n.mute&&e.onmute(s||n),n.unmute&&e.onunmute(s||n)}if(n.isVolumeChanged&&(m("Volume of stream: "+n.streamid+" has changed to: "+n.volume),0==n.volume&&(n.volume=1),e.streams[n.streamid])){var a=e.streams[n.streamid].mediaElement;a&&(a.volume=n.volume)}if(n.stopped&&e.streams[n.streamid]&&g(e.streams[n.streamid],e),n.promptStreamStop){if(!e.privileges.canStopRemoteStream)return void e.onstatechange({userid:n.userid,extra:n.extra,name:"stop-request-denied",reason:n.userid+' tried to stop your stream; however "privileges.canStopRemoteStream" is "false".'});p("Remote stream has been manually stopped!"),e.streams[n.streamid]&&e.streams[n.streamid].stop()}if(n.left){if(N){var u=n.userid;for(var l in e.streams)l=e.streams[l],l.userid==u&&(e.stopMediaStream(l),g(l,e))}if(L&&L.connection&&("closed"!=L.connection.signalingState&&-1==L.connection.iceConnectionState.search(/disconnected|failed/gi)&&L.connection.close(),L.connection=null),Z[n.userid]&&delete Z[n.userid],n.closeEntireSession)return e.onSessionClosed(n),void e.leave();e.remove(n.userid),S({userid:n.userid,extra:n.extra||{},entireSessionClosed:!!n.closeEntireSession},e)}if(n.playRoleOfBroadcaster&&(n.extra&&(e.extra=b(e.extra,n.extra)),n.participants&&(Z=n.participants,Z[e.userid]&&delete Z[e.userid],Q[0]&&Q[0].userid==n.userid&&(delete Q[0],Q=c(Q)),K[n.userid]&&delete K[n.userid]),setTimeout(e.playRoleOfInitiator,2e3)),n.changeBandwidth){if(!e.peers[n.userid])throw"No such peer exists.";e.peers[n.userid].peer.bandwidth=n.bandwidth,e.peers[n.userid].renegotiate()}if(n.customMessage){if(!e.peers[n.userid])throw"No such peer exists.";if(n.message.ejected){if(e.sessionDescriptions[e.sessionid].userid!=n.userid)throw"only initiator can eject a user.";e.leave(),e.onSessionClosed({userid:n.userid,extra:n.extra||t.extra,isEjected:!0})}else e.peers[n.userid].onCustomMessage(n.message);document.getElementById("exit-session").style.visibility="visible",document.getElementById("time-bar").style.visibility="hidden"}if(n.drop){if(!e.peers[n.userid])throw"No such peer exists.";e.peers[n.userid].drop(!0),e.peers[n.userid].renegotiate(),e.ondrop(n.userid)}if(n.hold||n.unhold){if(!e.peers[n.userid])throw"No such peer exists.";if(n.takeAction)return void e.peers[n.userid][n.hold?"hold":"unhold"](n.holdMLine);e.peers[n.userid].peer.hold=!!n.hold,e.peers[n.userid].peer.holdMLine=n.holdMLine,F.send({isRenegotiate:!0}),e.peers[n.userid].fireHoldUnHoldEvents({kind:n.holdMLine,isHold:!!n.hold,userid:n.userid})}n.isRenegotiate&&e.peers[n.userid].renegotiate(null,e.peers[n.userid].peer.session),n.fakeData&&_.onmessage(n.fakeData),n.recreatePeer&&(L=new E),n.failedToReceiveRemoteVideo&&(m("Remote peer hasn't received stream: "+n.streamid+". Renegotiating..."),e.peers[n.userid]&&e.peers[n.userid].renegotiate()),n.redial&&e.peers[n.userid]&&("disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState&&(t.redialing=!1),"disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState||t.redialing||(t.redialing=!0,p("Peer connection is closed.",f(e.peers[n.userid].peer.connection),"ReDialing.."),e.peers[n.userid].redial()))}}function I(n,o){function r(){L.recreateAnswer(n,s,function(t,n){U({sdp:t,socket:F,streaminfo:n}),e.detachStreams=[]})}if("answer"==n.type)return L.setRemoteDescription(n),void x();if(!t.renegotiate&&"offer"==n.type)return _.offerDescription=n,_.session=e.session,L||(L=new E),L.create("answer",_),void x();var s=t.renegotiate;if(A(o,L.connection),s.oneway||i(s))r(),delete t.renegotiate;else{if(t.capturing)return;t.capturing=!0,e.captureUserMedia(function(n){t.capturing=!1,L.addStream(n),e.renegotiatedSessions[JSON.stringify(t.renegotiate)]={session:t.renegotiate,stream:n},delete t.renegotiate,r()},t.renegotiate)}}var P={channel:t.channel,onmessage:O,onopen:function(n){n&&(F=n),V&&!L&&(_.session=e.session,L||(L=new E),L.create("offer",_)),t.socketIndex=F.index=Q.length,K[P.channel]=F,Q[t.socketIndex]=F,D(F),F.__push||(F.__push=F.send,F.send=function(t){t.userid=t.userid||e.userid,t.extra=t.extra||e.extra||{},F.__push(t)})}};P.callback=function(e){F=e,P.onopen()};var F=e.openSignalingChannel(P);F&&P.onopen(F);var L,V=t.isofferer,_={onopen:C,onicecandidate:function(t){if(!e.candidates)throw"ICE candidates are mandatory.";if(!e.iceProtocols)throw"At least one must be true; UDP or TCP.";var n=e.candidates,i=n.stun,r=n.turn;if(o(n.reflexive)||(i=n.reflexive),o(n.relay)||(r=n.relay),(n.host||!t.candidate.match(/a=candidate.*typ host/g))&&(r||!t.candidate.match(/a=candidate.*typ relay/g))&&(i||!t.candidate.match(/a=candidate.*typ srflx/g))){var s=e.iceProtocols;(s.udp||!t.candidate.match(/a=candidate.* udp/g))&&(s.tcp||!t.candidate.match(/a=candidate.* tcp/g))&&(window.selfNPObject||(window.selfNPObject=t),F&&F.send({candidate:JSON.stringify({candidate:t.candidate,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex})}))}},onmessage:function(n){if(n){var i=a(n);if(-1!=i.indexOf('"userid":'))i=JSON.parse(i),u(i);else if(n instanceof ArrayBuffer||n instanceof DataView){if(!e.enableFileSharing)throw'It seems that receiving data is either "Blob" or "File" but file sharing is disabled.';if(!X.fileBufferReader){var o=this;return void T(e,function(e){X.fileBufferReader=e,o.onmessage(n)})}var r=X.fileBufferReader;return void r.convertToObject(n,function(n){return n.maxChunks||n.readyForNextChunk?n.readyForNextChunk?void r.getNextChunk(n.uuid,function(e,t,n){X.send(e)}):void r.addChunk(n,function(e){X.send(e)}):void e.onmessage({data:n,userid:t.userid,extra:t.extra})})}}},onaddstream:function(o,r){function s(){setTimeout(function(){u.muted=!1,l({mediaElement:u,session:r,stream:o,preMuted:a})},3e3),u.removeEventListener("play",s)}if(r=r||t.renegotiate||e.session,!i(r)){r.screen&&(r.audio||r.video)&&(t.gotAudioOrVideo?(r.audio=!1,r.video=!1):(t.gotAudioOrVideo=!0,r.screen=!1));var a={};if(t.streaminfo){var d=t.streaminfo.split("----"),c=JSON.parse(d[d.length-1]);B||(o.streamid=c.streamid,o.isScreen=!!c.isScreen,o.isVideo=!!c.isVideo,o.isAudio=!!c.isAudio,a=c.preMuted),d.pop(),t.streaminfo=d.join("----")}var u=v(o,b({remote:!0},r));return e.setDefaultEventsForMediaElement&&e.setDefaultEventsForMediaElement(u,o.streamid),j||o.getVideoTracks().length?void n({mediaElement:u,session:r,stream:o,preMuted:a}):u.addEventListener("play",s,!1)}},onremovestream:function(t){t&&t.streamid?(t=e.streams[t.streamid],t&&(m("on:stream:ended via on:remove:stream",t),g(t,e))):m("on:remove:stream",t)},onclose:function(n){n.extra=t.extra,n.userid=t.userid,e.onclose(n),e.channels[n.userid]&&delete e.channels[n.userid]},onerror:function(n){n.extra=t.extra,n.userid=t.userid,e.onerror(n)},oniceconnectionstatechange:function(n){var i=t.userid.split("-",1);-1===array.indexOf(i+" , ")?array.push(i+" , "):J.log("This item already exists"),customFunctionForUpdateList(),customFunctionForUserCount(),m("oniceconnectionstatechange",f(n)),L.connection&&"connected"==L.connection.iceConnectionState&&"complete"==L.connection.iceGatheringState&&"stable"==L.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onconnected({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),!e.isInitiator&&L.connection&&"connected"==L.connection.iceConnectionState&&"complete"==L.connection.iceGatheringState&&"stable"==L.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onstatechange({userid:t.userid,extra:t.extra,name:"connected-with-initiator",reason:"ICE connection state seems connected; gathering state is completed; and signaling state is stable."}),e.peers[t.userid]&&e.peers[t.userid].oniceconnectionstatechange&&e.peers[t.userid].oniceconnectionstatechange(n),e.peers[t.userid]&&"failed"==e.peers[t.userid].peer.connection.iceConnectionState&&e.onfailed({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),e.peers[t.userid]&&"disconnected"==e.peers[t.userid].peer.connection.iceConnectionState&&(!L.connection.renegotiate&&e.ondisconnected({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),L.connection.renegotiate=!1),e.autoReDialOnFailure&&e.peers[t.userid]&&("disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState&&(t.redialing=!1),"disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState||t.redialing||(t.redialing=!0,p("Peer connection is closed.",f(e.peers[t.userid].peer.connection),"ReDialing.."),e.peers[t.userid].socket.send({redial:!0}),e.streams.remove({remote:!0,userid:t.userid})))},onsignalingstatechange:function(e){m("onsignalingstatechange",f(e))},attachStreams:e.dontAttachStream?[]:e.attachStreams,iceServers:e.iceServers,rtcConfiguration:e.rtcConfiguration,bandwidth:e.bandwidth,sdpConstraints:e.sdpConstraints,optionalArgument:e.optionalArgument,disableDtlsSrtp:e.disableDtlsSrtp,dataChannelDict:e.dataChannelDict,preferSCTP:e.preferSCTP,onSessionDescription:function(e,t){U({sdp:e,socket:F,streaminfo:t})},trickleIce:e.trickleIce,processSdp:e.processSdp,sendStreamId:function(e){F&&F.send({streamid:e.streamid,isScreen:!!e.isScreen,isAudio:!!e.isAudio,isVideo:!!e.isVideo})},rtcMultiConnection:e};e.playRoleOfInitiator=function(){e.dontCaptureUserMedia=!0,e.open(),Q=c(Q),e.dontCaptureUserMedia=!1},e.askToShareParticipants=function(){te&&te.send({askToShareParticipants:!0})},e.shareParticipants=function(t){var n={joinUsers:Z,userid:e.userid,extra:e.extra};t&&(t.dontShareWith&&(n.dontShareWith=t.dontShareWith),t.shareWith&&(n.shareWith=t.shareWith)),te.send(n)}}function A(t,n){if(t)for(var i=0;i<t.length;i++){var o=t[i];e.streams[o]&&n.removeStream(e.streams[o].stream)}}function U(t){t.socket.send({sdp:JSON.stringify({sdp:t.sdp.sdp,type:t.sdp.type}),renegotiate:t.renegotiate?t.renegotiate:!1,streaminfo:t.streaminfo||"",labels:t.labels||[],preferSCTP:!!e.preferSCTP,fakeDataChannels:!!e.fakeDataChannels,isInitiator:!!e.isInitiator,userinfo:{browser:N?"firefox":"chrome"}})}function L(t){var n=t.newParticipant;if(n&&!Z[n]&&n!=e.userid){var i=e.token();O({channel:i,extra:t.userData?t.userData.extra:t.extra,userid:t.userData?t.userData.userid:t.userid}),te.send({participant:!0,targetUser:n,channel:i})}}function V(){e.numberOfConnectedUsers--;var t={left:!0,extra:e.extra||{},userid:e.userid,sessionid:e.sessionid};e.isInitiator&&(e.autoCloseEntireSession?t.closeEntireSession=!0:Q[0]&&Q[0].send({playRoleOfBroadcaster:!0,userid:e.userid,extra:e.extra,participants:Z})),Q.forEach(function(e,n){e.send(t),K[e.channel]&&delete K[e.channel],delete Q[n]}),Q=c(Q),e.refresh(),F.forEach(function(e){e.disconnect()}),F=[]}function _(){X.signalingReady||(X.signalingReady=!0,setTimeout(t,1e3),e.isInitiator||te&&te.send({searchingForRooms:!0}))}function H(t){for(var n in t)Z[t[n]]||L({sessionid:e.sessionid,newParticipant:t[n],userid:e.userid,extra:e.extra})}function z(){return e.openSignalingChannel({onmessage:function(t){if(!ne&&t.userid!=e.userid){if(t.sessionid&&t.userid&&(e.sessionDescriptions[t.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[t.sessionid]=t,e.isAcceptNewSession&&(e.dontOverrideSession||(e.session=t.session),R(t)))),t.newParticipant&&!e.isAcceptNewSession&&X.broadcasterid===t.userid&&t.newParticipant!=e.userid&&L(t),h(Z)<e.maxParticipantsAllowed&&t.targetUser==e.userid&&t.participant){if(e.peers[t.userid]&&!e.peers[t.userid].peer)return delete Z[t.userid],delete e.peers[t.userid],e.isAcceptNewSession=!0,Y(t);Z[t.userid]||Y(t)}if(t.acceptedRequestOf==e.userid&&e.onstatechange({userid:t.userid,extra:t.extra,name:"request-accepted",reason:t.userid+" accepted your participation request."}),t.rejectedRequestOf==e.userid&&e.onstatechange({userid:t.userid,extra:t.extra,name:"request-rejected",reason:t.userid+" rejected your participation request."}),t.customMessage)if(t.message.drop){e.ondrop(t.userid),e.attachStreams=[];for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],"local"==n.type?(e.detachStreams.push(n.streamid),g(n,e)):g(n,e));t.message.renegotiate&&e.renegotiate()}else e.onCustomMessage&&e.onCustomMessage(t.message);if(e.isInitiator&&t.searchingForRooms&&te&&te.send({sessionDescription:e.sessionDescription,responseFor:t.userid}),t.sessionDescription&&t.responseFor==e.userid){var i=t.sessionDescription;e.sessionDescriptions[i.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[i.sessionid]=i)}e.isInitiator&&t.askToShareParticipants&&te&&e.shareParticipants({shareWith:t.userid}),t.shareWith==e.userid&&t.dontShareWith!=e.userid&&t.joinUsers&&H(t.joinUsers),!t.shareWith&&t.joinUsers&&(t.dontShareWith?e.userid!=t.dontShareWith&&H(t.joinUsers):H(t.joinUsers)),t.messageFor==e.userid&&t.presenceState&&("checking"==t.presenceState&&(te.send({messageFor:t.userid,presenceState:"available",_config:t._config}),m("participant asked for availability")),"available"==t.presenceState&&(X.presenceState="available",e.onstatechange({userid:"browser",extra:{},name:"room-available",reason:"Initiator is available and room is active."}),G(t._config))),t.donotJoin&&t.messageFor==e.userid&&m(t.userid,"is not joining your room."),t.isDisconnectSockets&&(m("Disconnecting your sockets because initiator also disconnected his sockets."),e.disconnect())}},callback:function(e){e&&this.onopen(e)},onopen:function(t){t&&(te=t),_&&_(),X.defaultSocket=te,te.__push||(te.__push=te.send,te.send=function(t){t.userid=t.userid||e.userid,t.extra=t.extra||e.extra||{},te.__push(t)})}})}function q(){var t=0;256!=e.maxParticipantsAllowed&&(t=e.maxParticipantsAllowed),"one-way"==e.direction&&(e.session.oneway=!0),"one-to-one"==e.direction&&(e.maxParticipantsAllowed=1),"one-to-many"==e.direction&&(e.session.broadcast=!0),"many-to-many"==e.direction&&(e.maxParticipantsAllowed&&1!=e.maxParticipantsAllowed||(e.maxParticipantsAllowed=256)),t&&1!=e.maxParticipantsAllowed&&(e.maxParticipantsAllowed=t)}function G(t,i){if(!X.donotJoin||X.donotJoin!=t.sessionid){e.dontOverrideSession||(e.session=t.session||{}),X.broadcasterid=t.userid,t.sessionid&&(e.sessionid=t.sessionid),e.isAcceptNewSession=!1;var o=n();O({channel:o,extra:t.extra||{},userid:t.userid});var r={};if(e.attachStreams.length){var a=e.attachStreams[e.attachStreams.length-1];a.getAudioTracks&&a.getAudioTracks().length&&(r.audio=!0),a.getVideoTracks().length&&(r.video=!0)}m(s(r)?"Seems data-only connection.":f(r)),e.onstatechange({userid:t.userid,extra:{},name:"connecting-with-initiator",reason:"Checking presence of the initiator; and the room."}),te.send({participant:!0,channel:o,targetUser:t.userid,session:e.session,offers:{audio:!!r.audio,video:!!r.video}}),e.skipOnNewSession=!1,C(e)}}function Y(t){if(X.requestsFrom||(X.requestsFrom={}),!X.requestsFrom[t.userid]){var n={userid:t.userid,extra:t.extra,channel:t.channel||t.userid,session:t.session||e.session};if(t.offers){m(t.offers.audio&&t.offers.video?"target user has both audio/video streams.":t.offers.audio&&!t.offers.video?"target user has only audio stream.":!t.offers.audio&&t.offers.video?"target user has only video stream.":"target user has no stream; it seems one-way streaming or data-only connection.");var i=e.sdpConstraints.mandatory;o(i.OfferToReceiveAudio)&&(e.sdpConstraints.mandatory.OfferToReceiveAudio=!!t.offers.audio),o(i.OfferToReceiveVideo)&&(e.sdpConstraints.mandatory.OfferToReceiveVideo=!!t.offers.video),m("target user's SDP has?",f(e.sdpConstraints.mandatory))}X.requestsFrom[t.userid]=n,e.onRequest&&e.isInitiator?e.onRequest(n):$(n)}}function $(t){return X.captureUserMediaOnDemand?(X.captureUserMediaOnDemand=!1,void e.captureUserMedia(function(){$(t),C(e)})):(m("accepting request from",t.userid),Z[t.userid]=t.userid,void O({isofferer:!0,userid:t.userid,channel:t.channel,extra:t.extra||{},session:t.session||e.session}))}var K={},Q=[],X=this,Z={};!X.fileBufferReader&&e.session.data&&e.enableFileSharing&&T(e,function(e){X.fileBufferReader=e});var ee=new I(e);e.remove=function(t){X.requestsFrom&&X.requestsFrom[t]&&delete X.requestsFrom[t],e.peers[t]&&(e.peers[t].peer&&e.peers[t].peer.connection&&("closed"!=e.peers[t].peer.connection.signalingState&&e.peers[t].peer.connection.close(),e.peers[t].peer.connection=null),delete e.peers[t]),Z[t]&&delete Z[t];for(var n in e.streams)n=e.streams[n],n.userid==t&&(g(n,e),delete e.streams[n]);K[t]&&delete K[t]},e.refresh=function(){e.isInitiator&&e.socket&&e.socket.remove&&e.socket.remove(),Z={};for(var t=0;t<e.attachStreams.length;t++)e.stopMediaStream(e.attachStreams[t]);ae={streams:[],mutex:!1,queueRequests:[]},X.isOwnerLeaving=!0,e.isInitiator=!1,e.isAcceptNewSession=!0,e.attachMediaStreams=[],e.sessionDescription=null,e.sessionDescriptions={},e.localStreamids=[],e.preRecordedMedias={},e.snapshots={},e.numberOfConnectedUsers=0,e.numberOfSessions=0,e.attachStreams=[],e.detachStreams=[],e.fileQueue={},e.channels={},e.renegotiatedSessions={};for(var n in e.peers)n!=e.userid&&delete e.peers[n];for(var i in e.streams)-1==e._skip.indexOf(i)&&(g(e.streams[i],e),delete e.streams[i]);K={},Q=[],Z={}},e.reject=function(t){r(t)||(t=t.userid),te.send({rejectedRequestOf:t}),e.remove(t)},X.leaveHandler=function(t){return e.leaveOnPageUnload?o(t.keyCode)?V():void(116==t.keyCode&&V()):void 0},P("beforeunload",X.leaveHandler),P("keyup",X.leaveHandler),X.onLineOffLineHandler=function(){navigator.onLine?X.isOffLine&&(X.isOffLine=!navigator.onLine):X.isOffLine=!0},P("load",X.onLineOffLineHandler),P("online",X.onLineOffLineHandler),P("offline",X.onLineOffLineHandler);var te=z();X.defaultSocket=te,te&&_&&setTimeout(_,2e3),e.session.screen&&x(),0==e.log&&e.skipLogs(),e.onlog&&(m=p=l=function(){var t={},n=0;Array.prototype.slice.call(arguments).forEach(function(e){t[n++]=f(e)}),f=function(e){return e},e.onlog(t)}),this.initSession=function(t){function n(){te&&h(Z)<e.maxParticipantsAllowed&&!X.isOwnerLeaving&&te.send(e.sessionDescription),e.transmitRoomOnce||X.isOwnerLeaving||setTimeout(n,e.interval||3e3)}X.isOwnerLeaving=!1,q(),Z={},X.isOwnerLeaving=!1,o(t.transmitRoomOnce)||(e.transmitRoomOnce=t.transmitRoomOnce),t.dontTransmit||n()},this.joinSession=function(t){function n(){te.send({messageFor:t.userid,presenceState:X.presenceState,_config:{userid:t.userid,extra:t.extra||{},sessionid:t.sessionid,session:t.session||!1}})}function i(){"checking"==X.presenceState&&(p("Unable to reach initiator. Trying again..."),n(),setTimeout(function(){"checking"==X.presenceState&&(e.onstatechange({userid:t.userid,extra:t.extra||{},name:"room-not-available",reason:"Initiator seems absent. Waiting for someone to open the room."}),e.isAcceptNewSession=!0,setTimeout(i,2e3))},2e3))}return te?(t=t||{},Z={},X.presenceState="checking",e.onstatechange({userid:t.userid,extra:t.extra||{},name:"detecting-room-presence",reason:"Checking presence of the room."}),n(),void setTimeout(i,3e3)):setTimeout(function(){p("Default-Socket is not yet initialized."),X.joinSession(t)},1e3)},e.donotJoin=function(t){X.donotJoin=t;var n=e.sessionDescriptions[t];n&&(te.send({donotJoin:!0,messageFor:n.userid,sessionid:t}),Z={},e.isAcceptNewSession=!0,e.sessionid=null)},this.send=function(t,n){if(t instanceof ArrayBuffer||t instanceof DataView||(t=d({extra:e.extra,userid:e.userid,data:t})),n)return void("open"==n.readyState&&n.send(t));for(var i in e.channels){var o=e.channels[i].channel;"open"==o.readyState&&o.send(t)}},this.leave=function(){V()},this.addStream=function(t){function n(n){var o=n.socket;if(!o)return void p(n,"doesn't has socket.");if(D(o),!n||!n.peer)throw"No peer to renegotiate.";var r=n.peer;t.stream&&(r.attachStreams||(r.attachStreams=[]),r.attachStreams.push(t.stream)),A(e.detachStreams,r.connection),t.stream&&(i.audio||i.video||i.screen)&&r.addStream(t.stream),r.recreateOffer(i,function(t,n){U({sdp:t,socket:o,renegotiate:i,labels:e.detachStreams,streaminfo:n}),e.detachStreams=[]})}var i=t.renegotiate;if(e.renegotiatedSessions[JSON.stringify(t.renegotiate)]||(e.renegotiatedSessions[JSON.stringify(t.renegotiate)]={session:t.renegotiate,stream:t.stream}),t.socket)t.socket.userid!=e.userid&&n(e.peers[t.socket.userid]);else for(var o in e.peers)o!=e.userid&&n(e.peers[o])},e.request=function(t,n){e.captureUserMedia(function(){O({channel:e.userid,extra:n||{},userid:t}),te.send({participant:!0,targetUser:t})})},e.accept=function(t){arguments.length>1&&r(arguments[0])&&(t={},arguments[0]&&(t.userid=arguments[0]),arguments[1]&&(t.extra=arguments[1]),arguments[2]&&(t.channel=arguments[2])),e.captureUserMedia(function(){$(t)})};var ne=!1;this.disconnect=function(){if(this.isOwnerLeaving=!0,!e.keepStreamsOpened){for(var t in e.localStreams)e.localStreams[t].stop();e.localStreams={},ae={streams:[],mutex:!1,queueRequests:[]}}e.isInitiator&&te.send({isDisconnectSockets:!0}),e.refresh(),X.defaultSocket=te=null,ne=!0,e.ondisconnected({userid:e.userid,extra:e.extra,peer:e.peers[e.userid],isSocketsDisconnected:!0}),e.close(),window.removeEventListener("beforeunload",X.leaveHandler),window.removeEventListener("keyup",X.leaveHandler),delete this,m("Disconnected your sockets, peers, streams and everything except RTCMultiConnection object.")}}function t(e){if(!e)throw"MediaStream is mandatory.";if(e.getVideoTracks&&!e.getVideoTracks().length)return e;var t=new AudioContext,n=t.createMediaStreamSource(e),i=t.createMediaStreamDestination();return n.connect(i),F.push(n),i.stream}function n(){return participants+"-"+(new Date).getTime().toString(36).replace(/\./g,"")}function i(e){return!e.audio&&!e.video&&!e.screen&&e.data}function o(e){return"undefined"==typeof e}function r(e){return"string"==typeof e}function s(e){var t=0;for(var n in e)t++;return 0==t}function a(e){var t="";try{t=String.fromCharCode.apply(null,new Uint16Array(e))}catch(n){}return t}function d(e){r(e)||(e=JSON.stringify(e));for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),i=0,o=e.length;o>i;i++)n[i]=e.charCodeAt(i);return t}function c(e){for(var t=[],n=e.length,i=0;n>i;i++)e[i]&&e[i]!==!0&&t.push(e[i]);return t}function u(e,t){for(var n in e)t(e[n],n)}function m(){J.log(arguments)}function l(){J.error(arguments)}function p(){J.warn(arguments)}function f(e){return JSON.stringify(e,function(e,t){return t&&t.sdp?(m(t.sdp.type,"	",t.sdp.sdp),""):t},"	")}function h(e){var t=0;for(var n in e)n&&t++;return t}function v(e,t){var n=document.createElement(e.isAudio?"audio":"video");if(n.id=e.streamid,j){var i=document.body||document.documentElement;return i.insertBefore(n,i.firstChild),setTimeout(function(){ie.attachMediaStream(n,e)},1e3),ie.attachMediaStream(n,e)}return n[N?"mozSrcObject":"src"]=N?e:(window.URL||window.webkitURL).createObjectURL(e),n.controls=!0,n.autoplay=!!t.remote,n.muted=t.remote?!1:!0,N&&n.addEventListener("ended",function(){e.onended()},!1),n.play(),n}function g(e,t){(!e.mediaElement||e.mediaElement.parentNode)&&(Q[e.streamid]||(Q[e.streamid]=e,t.onstreamended(e)))}function S(e,t){X[e.userid]||(X[e.userid]=e,t.onleave(e))}function w(e){function t(t){var o=document.createElement("canvas");o.width=t.videoWidth||t.clientWidth,o.height=t.videoHeight||t.clientHeight;var r=o.getContext("2d");r.drawImage(t,0,0,o.width,o.height),i.snapshots[n]=o.toDataURL("image/png"),e.callback&&e.callback(i.snapshots[n])}var n=e.userid,i=e.connection;if(e.mediaElement)return t(e.mediaElement);for(var o in i.streams)o=i.streams[o],o.userid==n&&o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks().length&&t(o.mediaElement)}function C(e){e.onMediaCaptured&&(e.onMediaCaptured(),delete e.onMediaCaptured)}function b(e,t){if(e||(e={}),!t)return e;for(var n in t)e[n]=t[n];return e}function y(e,t){var n=document.createElement("script");n.src=e,n.onload=function(){m("loaded resource:",e),t&&t()},document.documentElement.appendChild(n)}function k(e){var t=e.connection,n=e.element;if(!window.html2canvas)return y(t.resources.html2canvas,function(){k(e)});if(r(n)&&(n=document.querySelector(n),n||(n=document.getElementById(n))),!n)throw"HTML DOM Element is not accessible!";html2canvas(n,{onrendered:function(t){e.callback(t.toDataURL())}})}function T(e,t){function n(e){return e.userid=e.extra.userid,e}if(!window.FileBufferReader)return void y(e.resources.FileBufferReader,function(){T(e,t)});var i=new FileBufferReader;i.onProgress=function(t){e.onFileProgress(n(t),t.uuid)},i.onBegin=function(t){e.onFileStart(n(t))},i.onEnd=function(t){e.onFileEnd(n(t))},t(i)}function x(e){if(DetectRTC.screen.extensionid==te&&!K){if(!e)return x(!0);K=!0;var t=document.createElement("iframe");t.onload=function(){t.isLoaded=!0,m("Screen Capturing frame is loaded.")},t.src="https://www.webrtc-experiment.com/getSourceId/",t.style.display="none",(document.body||document.documentElement).appendChild(t),Y={postMessage:function(){return t.isLoaded?void t.contentWindow.postMessage({captureSourceId:!0},"*"):void setTimeout(Y.postMessage,100)}}}}function R(e){var t=e.stream,n=e.root,i=e.session||{},o=e.enabled;if(i.audio||i.video||(i=r(i)?{audio:!0,video:!0}:b(i,{audio:!0,video:!0})),i.type){if("remote"==i.type&&"remote"!=n.type)return;if("local"==i.type&&"local"!=n.type)return}if(m(o?"Muting":"UnMuting","session",f(i)),o){var s=e.root.userid.split("-",1);myDelete(s+" , "),customFunctionForUpdateList(),customFunctionForUserCount()}else{var s=e.root.userid.split("-",1);-1===array.indexOf(s+" , ")?array.push(s+" , "):J.log("This item already exists"),customFunctionForUpdateList(),customFunctionForUserCount()}if("local"==n.type&&i.audio&&t.getAudioTracks){var a=t.getAudioTracks()[0];a&&(a.enabled=!o)}if("local"==n.type&&(i.video||i.screen)&&t.getVideoTracks){var d=t.getVideoTracks()[0];d&&(d.enabled=!o)}if(n.sockets.forEach(function(e){"local"==n.type&&e.send({streamid:n.streamid,mute:!!o,unmute:!o,session:i}),"remote"==n.type&&e.send({promptMuteUnmute:!0,streamid:n.streamid,mute:!!o,unmute:!o,session:i})}),"remote"!=n.type){var c=b({},n);c.session=i,c.isAudio=!!c.session.audio&&!c.session.video,c.isVideo=!!c.session.video,c.isScreen=!!c.session.screen,o&&(t.preMuted={audio:t.getAudioTracks().length&&!t.getAudioTracks()[0].enabled,video:t.getVideoTracks().length&&!t.getVideoTracks()[0].enabled},n.rtcMultiConnection.onmute(c)),o||(t.preMuted={},n.rtcMultiConnection.onunmute(c))}}function M(e){if(!window.hark)return void y(e.connection.resources.hark,function(){M(e)});var t=e.connection,n=e.streamedObject,i=e.stream,o={},r=hark(i,o);r.on("speaking",function(){t.onspeaking&&t.onspeaking(n)}),r.on("stopped_speaking",function(){t.onsilence&&t.onsilence(n)}),r.on("volume_change",function(e,i){t.onvolumechange&&t.onvolumechange(b({volume:e,threshold:i},n))})}function D(e){function t(t,i,o){o||(o=getVideoId()),n.localStreams[o]=t;var r=e.video;r&&(r[N?"mozSrcObject":"src"]=N?t:(window.URL||window.webkitURL).createObjectURL(t),r.play()),e.onsuccess(t,i,S,o),ae.streams[S]={stream:t,streamid:o},ae.mutex=!1,ae.queueRequests.length&&D(ae.queueRequests.shift())}if(j)return ie.getUserMedia?ie.getUserMedia(e.constraints||{audio:!0,video:!0},e.onsuccess,e.onerror):void setTimeout(function(){D(e)},1e3);if(ae.mutex===!0)return void ae.queueRequests.push(e);ae.mutex=!0;var n=e.connection,i=e.mediaConstraints||{},o="boolean"==typeof i.video?i.video:i.video||i,r="boolean"==typeof i.audio?i.audio:i.audio||se,a=navigator,d=e.constraints||{
audio:se,video:se};d.video&&d.video.mozMediaSource&&(o={}),1==d.video&&(d.video=se),1==d.audio&&(d.audio=se),"boolean"==typeof r&&d.audio&&(d.audio=r),"boolean"==typeof o&&d.video&&(d.video=o);var u=r.mandatory;s(u)||(d.audio.mandatory=b(d.audio.mandatory,u));var h=o.mandatory;if(h){var v={};if(h.minWidth&&(v.minWidth=h.minWidth),h.minHeight&&(v.minHeight=h.minHeight),h.maxWidth&&(v.maxWidth=h.maxWidth),h.maxHeight&&(v.maxHeight=h.maxHeight),h.minAspectRatio&&(v.minAspectRatio=h.minAspectRatio),h.maxFrameRate&&(v.maxFrameRate=h.maxFrameRate),h.minFrameRate&&(v.minFrameRate=h.minFrameRate),v.minWidth&&v.minHeight){var g=["1920:1080","1280:720","960:720","640:360","640:480","320:240","320:180"];(-1==g.indexOf(v.minWidth+":"+v.minHeight)||-1==g.indexOf(v.maxWidth+":"+v.maxHeight))&&l('The min/max width/height constraints you passed "seems" NOT supported.',f(v)),(v.minWidth>v.maxWidth||v.minHeight>v.maxHeight)&&l("Minimum value must not exceed maximum value.",f(v)),v.minWidth>=1280&&v.minHeight>=720&&p("Enjoy HD video! min/"+v.minWidth+":"+v.minHeight+", max/"+v.maxWidth+":"+v.maxHeight)}d.video.mandatory=b(d.video.mandatory,v)}h&&(d.video.mandatory=b(d.video.mandatory,h)),o.optional&&o.optional instanceof Array&&o.optional.length&&(d.video.optional=d.video.optional?d.video.optional.concat(o.optional):o.optional),r.optional&&r.optional instanceof Array&&r.optional.length&&(d.audio.optional=d.audio.optional?d.audio.optional.concat(r.optional):r.optional),d.video.mandatory&&!s(d.video.mandatory)&&n._mediaSources.video&&(d.video.optional.forEach(function(e,t){e.sourceId==n._mediaSources.video&&delete d.video.optional[t]}),d.video.optional=c(d.video.optional),d.video.optional.push({sourceId:n._mediaSources.video})),d.audio.mandatory&&!s(d.audio.mandatory)&&n._mediaSources.audio&&(d.audio.optional.forEach(function(e,t){e.sourceId==n._mediaSources.audio&&delete d.audio.optional[t]}),d.audio.optional=c(d.audio.optional),d.audio.optional.push({sourceId:n._mediaSources.audio})),d.video&&!d.video.mozMediaSource&&d.video.optional&&d.video.mandatory&&!d.video.optional.length&&s(d.video.mandatory)&&(d.video=!0),W&&(d={audio:!!d.audio,video:!!d.video}),getdata(),1==n.numberOfConnectedUsers&&(-1===array.indexOf(participants+" , ")?array.push(participants+" , "):J.log("This item already exists")),customFunctionForUpdateList(),customFunctionForUserCount(),m("invoked getUserMedia with constraints:",f(d));var S=JSON.stringify(d);ae.streams[S]?t(ae.streams[S].stream,!0,ae.streams[S].streamid):(a.getMedia=a.webkitGetUserMedia||a.mozGetUserMedia,a.getMedia(d,t,function(t){e.onerror(t,d)}))}function O(e){var t,n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return t={mandatory:n,optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&G>34&&(t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}),t}function E(){return{create:function(e,t){b(this,t);var n=this;return this.type=e,this.init(),this.attachMediaStreams(),N&&this.session.data?(this.session.data&&"offer"==e&&this.createDataChannel(),this.getLocalDescription(e),this.session.data&&"answer"==e&&this.createDataChannel()):n.getLocalDescription(e),this},getLocalDescription:function(e){function t(){n.connection["offer"==e?"createOffer":"createAnswer"](function(t){t.sdp=n.serializeSdp(t.sdp,e),n.connection.setLocalDescription(t),n.trickleIce&&n.onSessionDescription(t,n.streaminfo),"offer"==t.type&&m("offer sdp",t.sdp),n.prevCreateType=e},n.onSdpError,n.constraints)}m("(getLocalDescription) peer createType is",e),this.session.inactive&&o(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing)&&(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing=!1);var n=this;"answer"==e?this.setRemoteDescription(this.offerDescription,t):t()},serializeSdp:function(e,t){if(e=this.processSdp(e),N)return e;if(this.session.inactive&&!this.holdMLine&&(this.hold=!0,(this.session.screen||this.session.video)&&this.session.audio?this.holdMLine="both":this.session.screen||this.session.video?this.holdMLine="video":this.session.audio&&(this.holdMLine="audio")),e=this.setBandwidth(e),"both"==this.holdMLine){if(this.hold)this.prevSDP=e,e=e.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive");else if(this.prevSDP&&!this.session.inactive&&(e=this.prevSDP,35>=z))return e}else if("audio"==this.holdMLine||"video"==this.holdMLine){e=e.split("m=");var n="",i="";e[1]&&0==e[1].indexOf("audio")&&(n="m="+e[1]),e[2]&&0==e[2].indexOf("audio")&&(n="m="+e[2]),e[1]&&0==e[1].indexOf("video")&&(i="m="+e[1]),e[2]&&0==e[2].indexOf("video")&&(i="m="+e[2]),"audio"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+n+i,e=e[0]+n.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")+i):this.prevSDP&&(e=this.prevSDP)),"video"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+n+i,e=e[0]+n+i.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")):this.prevSDP&&(e=this.prevSDP))}return!this.hold&&this.session.inactive&&(e="offer"==t?e.replace(/a=setup:passive|a=setup:active|a=setup:holdconn/g,"a=setup:actpass"):e.replace(/a=setup:actpass|a=setup:passive|a=setup:holdconn/g,"a=setup:active"),e=e.replace(/a=inactive/g,"a=sendrecv")),e},init:function(){function e(){return t.returnedSDP?void(t.returnedSDP=!1):(t.returnedSDP=!0,void t.onSessionDescription(t.connection.localDescription,t.streaminfo))}this.setConstraints(),this.connection=new re(this.iceServers,this.optionalArgument),this.session.data&&(m("invoked: createDataChannel"),this.createDataChannel()),this.connection.onicecandidate=function(n){return n.candidate?void(t.trickleIce&&t.onicecandidate(n.candidate)):void(t.trickleIce||e())},this.connection.onaddstream=function(e){m("onaddstream",j?e.stream:f(e.stream)),t.onaddstream(e.stream,t.session)},this.connection.onremovestream=function(e){t.onremovestream(e.stream)},this.connection.onsignalingstatechange=function(){t.connection&&t.oniceconnectionstatechange({iceConnectionState:t.connection.iceConnectionState,iceGatheringState:t.connection.iceGatheringState,signalingState:t.connection.signalingState})},this.connection.oniceconnectionstatechange=function(){t.connection&&(t.oniceconnectionstatechange({iceConnectionState:t.connection.iceConnectionState,iceGatheringState:t.connection.iceGatheringState,signalingState:t.connection.signalingState}),t.trickleIce||"complete"==t.connection.iceGatheringState&&(m("iceGatheringState",t.connection.iceGatheringState),e()))};var t=this},setBandwidth:function(e){if(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:80\r\n"),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:256\r\n"),e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:1638400\r\n"),W||N||!this.bandwidth)return e;var t=this.bandwidth;return this.session.screen&&(t.screen?t.screen<300&&p("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):p("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),t.screen&&this.session.screen&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video||t.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(this.session.screen?t.screen:t.video)+"\r\n")),t.data&&!this.preferSCTP&&(e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+t.data+"\r\n")),e},setConstraints:function(){var e=O({OfferToReceiveAudio:!!this.session.audio,OfferToReceiveVideo:!!this.session.video||!!this.session.screen});if(this.sdpConstraints.mandatory&&(e=O(this.sdpConstraints.mandatory)),this.constraints=e,this.constraints&&m("sdp-constraints",f(this.constraints)),this.optionalArgument={optional:this.optionalArgument.optional||[],mandatory:this.optionalArgument.mandatory||{}},this.preferSCTP||this.optionalArgument.optional.push({RtpDataChannels:!0}),m("optional-argument",f(this.optionalArgument)),o(this.iceServers))this.iceServers=null;else{var t=this.rtcMultiConnection.candidates,n=t.stun,i=t.turn,r=t.host;o(t.reflexive)||(n=t.reflexive),o(t.relay)||(i=t.relay),r||n||!i?r||n||i||(this.rtcConfiguration.iceTransports="none"):this.rtcConfiguration.iceTransports="relay",this.iceServers={iceServers:this.iceServers,iceTransports:this.rtcConfiguration.iceTransports}}m("rtc-configuration",f(this.iceServers))},onSdpError:function(e){var t=f(e);t&&-1!=t.indexOf("RTP/SAVPF Expects at least 4 fields")&&(t="It seems that you are trying to interop RTP-datachannels with SCTP. It is not supported!"),l("onSdpError:",t)},onSdpSuccess:function(){m("sdp success")},onMediaError:function(e){l(f(e))},setRemoteDescription:function(e,t){if(!e)throw"Remote session description should NOT be NULL.";if(this.connection){m("setting remote description",e.type,e.sdp);var n=this;this.connection.setRemoteDescription(new ce(e),t||this.onSdpSuccess,function(e){-1==e.search(/STATE_SENTINITIATE|STATE_INPROGRESS/gi)&&n.onSdpError(e)})}},addIceCandidate:function(e){function t(t){n.connection.addIceCandidate(t,function(){m("added:",e.sdpMid,e.candidate)},function(){l("onIceFailure",arguments,e.candidate)})}var n=this;j?ue(e,function(e){t(e)}):t(new ue(e))},createDataChannel:function(e){if(!this.channels||!this.channels.length){var t=this;this.channels||(this.channels=[]);var n={};this.dataChannelDict&&(n=this.dataChannelDict),_&&!this.preferSCTP&&(n.reliable=!1),m("dataChannelDict",f(n)),("answer"==this.type||N)&&(this.connection.ondatachannel=function(e){t.setChannelEvents(e.channel)}),(_&&"offer"==this.type||N)&&this.setChannelEvents(this.connection.createDataChannel(e||"channel",n))}},setChannelEvents:function(e){var t=this;e.binaryType="arraybuffer",this.dataChannelDict.binaryType&&(e.binaryType=this.dataChannelDict.binaryType),e.onmessage=function(e){t.onmessage(e.data)};var n=0;e.onopen=function(){e.push=e.send,e.send=function(i){if("disconnected"!=t.connection.iceConnectionState&&-1==e.readyState.search(/closing|closed/g)&&-1!=e.readyState.search(/connecting|open/g)){if("connecting"==e.readyState)return n++,setTimeout(function(){if(!(20>n))throw"Number of times exceeded to wait for WebRTC data connection to be opened.";e.send(i)},1e3);try{e.push(i)}catch(o){if(n++,p("Data transmission failed. Re-transmitting..",n,f(o)),n>=20)throw"Number of times exceeded to resend data packets over WebRTC data channels.";setTimeout(function(){e.send(i)},100)}}},t.onopen(e)},e.onerror=function(e){t.onerror(e)},e.onclose=function(e){t.onclose(e)},this.channels.push(e)},addStream:function(e){e.streamid||B||(e.streamid=getVideoId()),m("attaching stream:",e.streamid,j?e:f(e)),this.connection.addStream(e),this.sendStreamId(e),this.getStreamInfo()},attachMediaStreams:function(){for(var e=this.attachStreams,t=0;t<e.length;t++)this.addStream(e[t])},getStreamInfo:function(){this.streaminfo="";for(var e=this.connection.getLocalStreams(),t=0;t<e.length;t++)0==t?this.streaminfo=JSON.stringify({streamid:e[t].streamid||"",isScreen:!!e[t].isScreen,isAudio:!!e[t].isAudio,isVideo:!!e[t].isVideo,preMuted:e[t].preMuted||{}}):this.streaminfo+="----"+JSON.stringify({streamid:e[t].streamid||"",isScreen:!!e[t].isScreen,isAudio:!!e[t].isAudio,isVideo:!!e[t].isVideo,preMuted:e[t].preMuted||{}})},recreateOffer:function(e,t){m("recreating offer"),this.type="offer",this.session=e,this.onSessionDescription=t,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("offer")},recreateAnswer:function(e,t,n){m("recreating answer"),this.type="answer",this.session=t,this.onSessionDescription=n,this.offerDescription=e,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("answer")}}}function A(e,t){var n=document.createElement("a");n.href=e,n.target="_blank",n.download=t||e,navigator.mozGetUserMedia&&(n.onclick=function(){(document.body||document.documentElement).removeChild(n)},(document.body||document.documentElement).appendChild(n));var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(i),navigator.mozGetUserMedia||URL.revokeObjectURL(n.href)}function I(e){function t(t,i,o){var r=t.uuid;if(n[r]||(n[r]=[]),n[r].push(t.message),t.last){var s=n[r].join("");t.isobject&&(s=JSON.parse(s));var a=(new Date).getTime(),d=a-t.sendingTime,c={data:s,userid:i,extra:o,latency:d};s.preRecordedMediaChunk?(e.preRecordedMedias[s.streamerid]||e.shareMediaFile(null,null,s.streamerid),e.preRecordedMedias[s.streamerid].onData(s.chunk)):e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(t){c.data=t,e.onmessage(c)})):s.isPartOfScreen?e.onpartofscreen(s):e.onmessage(c),delete n[r]}}var n={};return{receive:t}}function P(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function U(e){function i(e,t){if(-1!=e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}e.userid=n(),e.session={audio:!0,video:!0},e.maxParticipantsAllowed=256,e.direction="many-to-many",e.mediaConstraints={mandatory:{},optional:[],audio:{mandatory:{},optional:[]},video:{mandatory:{maxWidth:100,maxHeight:80,minFrameRate:30,maxFrameRate:30,minAspectRatio:1.77,maxAspectRatio:1.77},optional:[]}},e.candidates={host:!0,stun:!0,turn:!0},e.sdpConstraints={},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.privileges={canStopRemoteStream:!1,canMuteRemoteStream:!1},e.iceProtocols={tcp:!0,udp:!0},e.preferSCTP=N||z>=32?!0:!1,e.chunkInterval=N||z>=32?100:500,e.chunkSize=N||z>=32?13e3:1e3,e.fakeDataChannels=!1,e.waitUntilRemoteStreamStartsFlowing=null,e.leaveOnPageUnload=!0,e.getExternalIceServers=_,e.UA={isFirefox:N,isChrome:_,isMobileDevice:W,version:_?z:G,isNodeWebkit:H,isSafari:V,isIE:B,isOpera:L},e.fileQueue={},e.renegotiatedSessions={},e.channels={},e.extra={},e.bandwidth={screen:300},e.caniuse={RTCPeerConnection:DetectRTC.isWebRTCSupported,getUserMedia:!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia,AudioContext:DetectRTC.isAudioContextSupported,ScreenSharing:DetectRTC.isScreenCapturingSupported,RtpDataChannels:DetectRTC.isRtpDataChannelsSupported,SctpDataChannels:DetectRTC.isSctpDataChannelsSupported},e.snapshots={},e._mediaSources={},e.devices={},e.language="en",e.autoTranslateText=!1,e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.localStreamids=[],e.localStreams={},e.preRecordedMedias={},e.attachStreams=[],e.detachStreams=[],e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300}],mandatory:{}},e.dataChannelDict={},e.dontAttachStream=!1,e.dontCaptureUserMedia=!1,e.preventSSLAutoAllowed=!1,e.autoReDialOnFailure=!0,e.isInitiator=!1,e.DetectRTC=DetectRTC,e.trickleIce=!0,e.sessionDescriptions={},e.sessionDescription=null,e.resources={RecordRTC:"https://cdn.webrtc-experiment.com/RecordRTC.js",PreRecordedMediaStreamer:"https://cdn.webrtc-experiment.com/PreRecordedMediaStreamer.js",customGetUserMediaBar:"https://cdn.webrtc-experiment.com/navigator.customGetUserMediaBar.js",html2canvas:"https://cdn.webrtc-experiment.com/screenshot.js",hark:"https://cdn.webrtc-experiment.com/hark.js",firebase:"https://cdn.webrtc-experiment.com/firebase.js",firebaseio:"https://webrtc.firebaseIO.com/",muted:"https://cdn.webrtc-experiment.com/images/muted.png",getConnectionStats:"https://cdn.webrtc-experiment.com/getConnectionStats.js",FileBufferReader:"https://cdn.webrtc-experiment.com/FileBufferReader.js"},e.body=document.body||document.documentElement,e.peers={},e.firebase="chat",e.numberOfSessions=0,e.numberOfConnectedUsers=0,e.enableFileSharing=!0,e.autoSaveToDisk=!1,e.processSdp=function(e){return e},e.onmessage=function(e){m("onmessage",f(e))},e.onopen=function(e){m("Data connection is opened between you and",e.userid)},e.onerror=function(e){l(onerror,f(e))},e.onclose=function(t){p("onclose",f(t)),e.streams.remove({userid:t.userid})};var a={};e.onFileStart=function(t){var n=document.createElement("div");n.title=t.name,n.innerHTML="<label>0%</label> <progress></progress>",e.body.insertBefore(n,e.body.firstChild),a[t.uuid]={div:n,progress:n.querySelector("progress"),label:n.querySelector("label")},a[t.uuid].progress.max=t.maxChunks},e.onFileProgress=function(e){var t=a[e.uuid];t&&(t.progress.value=e.currentPosition||e.maxChunks||t.progress.max,i(t.progress,t.label))},e.onFileEnd=function(t){a[t.uuid]&&(a[t.uuid].div.innerHTML='<a href="'+t.url+'" target="_blank" download="'+t.name+'">'+t.name+"</a>"),(e.onFileSent||e.onFileReceived)&&(e.onFileSent&&e.onFileSent(t,t.uuid),e.onFileReceived&&e.onFileReceived(t.name,t))},e.onstream=function(t){e.body.insertBefore(t.mediaElement,e.body.firstChild)},e.onstreamended=function(e){if(m("onStreamEndedHandler:",e),!e.mediaElement)return p("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode){if(e.mediaElement=document.getElementById(e.streamid),!e.mediaElement)return p("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode)return p("Event.mediElement.parentNode is null.",e)}e.mediaElement.parentNode.removeChild(e.mediaElement)},e.onSessionClosed=function(e){e.isEjected?p(e.userid,"ejected you."):p("Session has been closed.",e),document.getElementById("exit-session").style.visibility = "visible",document.getElementById("exit-session").style.visibility = "visible",document.getElementById("time-bar").style.visibility = "hidden",document.getElementById("stopwatch-duration").style.visibility = "hidden";},e.onmute=function(t){t.isVideo&&t.mediaElement&&(t.mediaElement.pause(),t.mediaElement.setAttribute("poster",t.snapshot||e.resources.muted)),t.isAudio&&t.mediaElement&&(t.mediaElement.muted=!0)},e.onunmute=function(e){e.isVideo&&e.mediaElement&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),e.isAudio&&e.mediaElement&&(e.mediaElement.muted=!1)},e.onleave=function(e){m("onleave",f(e))},e.token=n,e.peers[e.userid]={drop:function(){e.drop()},renegotiate:function(){},addStream:function(){},hold:function(){},unhold:function(){},changeBandwidth:function(){},sharePartOfScreen:function(){}},e._skip=["stop","mute","unmute","_private","_selectStreams","selectFirst","selectAll","remove"],e.streams={mute:function(e){this._private(e,!0)},unmute:function(e){this._private(e,!1)},_private:function(t,n){function i(e,t,n){t.local&&"local"!=e.type||t.remote&&"remote"!=e.type||(!t.isScreen||e.isScreen)&&(!t.isAudio||e.isAudio)&&(!t.isVideo||e.isVideo)&&(n?e.mute(t):e.unmute(t))}if(!t||r(t))for(var o in this)-1==e._skip.indexOf(o)&&this[o]._private(t,n);else for(var o in this)-1==e._skip.indexOf(o)&&i(this[o],t,n)},stop:function(t){function n(e,t){t.userid&&e.userid!=t.userid||t.local&&"local"!=e.type||t.remote&&"remote"!=e.type||(t.screen&&e.isScreen&&e.stop(),t.audio&&e.isAudio&&e.stop(),t.video&&e.isVideo&&e.stop(),t.audio||t.video||t.screen||e.stop())}var i;for(var o in this)if(-1==e._skip.indexOf(o))if(i=this[o],t)if(r(t)){var s={};s[t]=!0,n(i,s)}else n(i,t);else i.stop()},remove:function(t){function n(e,t){t.userid&&e.userid!=t.userid||t.local&&"local"!=e.type||t.remote&&"remote"!=e.type||(t.screen&&e.isScreen&&i(e),t.audio&&e.isAudio&&i(e),t.video&&e.isVideo&&i(e),t.audio||t.video||t.screen||i(e))}function i(t){g(t,e),delete e.streams[t.streamid]}var o;for(var s in this)if(-1==e._skip.indexOf(s))if(o=this[s],t)if(r(t)){var a={};a[t]=!0,n(o,a)}else n(o,t);else n(o,{local:!0,remote:!0})},selectFirst:function(e){return this._selectStreams(e,!1)},selectAll:function(e){return this._selectStreams(e,!0)},_selectStreams:function(t,n){if(!t||r(t)||s(t))throw"Invalid arguments.";o(t.local)&&o(t.remote)&&o(t.userid)&&(t.local=t.remote=!0),t.isAudio||t.isVideo||t.isScreen||(t.isAudio=t.isVideo=t.isScreen=!0);var i=[];for(var a in this)-1==e._skip.indexOf(a)&&(a=this[a])&&(t.local&&"local"==a.type||t.remote&&"remote"==a.type||t.userid&&a.userid==t.userid)&&(t.isVideo&&a.isVideo&&i.push(a),t.isAudio&&a.isAudio&&i.push(a),t.isScreen&&a.isScreen&&i.push(a));return n?i:i[0]}},e.iceServers=de.getIceServers(),e.rtcConfiguration={iceServers:null,iceTransports:"all",peerIdentity:!1},e.media={min:function(t,n){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.minWidth=t,e.mediaConstraints.video.mandatory.minHeight=n)},max:function(t,n){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.maxWidth=t,e.mediaConstraints.video.mandatory.maxHeight=n)}},e._getStream=function(t){function n(e,t,n){if(n){var i=n.onpause,o=n.onplay;n.onpause=n.onplay=function(){},t?n.pause():n.play(),n.onpause=i,n.onplay=o}}var i=b({sockets:t.socket?[t.socket]:[]},t);return i.stop=function(){var e=this;if(e.sockets.forEach(function(t){"local"==e.type&&t.send({streamid:e.streamid,stopped:!0}),"remote"==e.type&&t.send({promptStreamStop:!0,streamid:e.streamid})}),"remote"!=e.type){var t=e.stream;t&&e.rtcMultiConnection.stopMediaStream(t)}},i.mute=function(e){this.muted=!0,this._private(e,!0)},i.unmute=function(e){this.muted=!1,this._private(e,!1)},i._private=function(e,t){return e&&!o(e.sync)&&0==e.sync?void n(e,t,this.mediaElement):void R({root:this,session:e,enabled:t,stream:this.stream})},i.startRecording=function(t){var n=this;return t||(t={audio:!0,video:!0}),r(t)&&(t={audio:"audio"==t,video:"video"==t}),window.RecordRTC?(m("started recording session",t),n.videoRecorder=n.audioRecorder=null,N?n.stream.getAudioTracks().length&&n.stream.getVideoTracks().length?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):t.video?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):t.audio&&(n.audioRecorder=RecordRTC(n.stream,{type:"audio"})):_&&(isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50&&n.stream.getAudioTracks().length&&n.stream.getVideoTracks().length?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50?t.video?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):t.audio&&(n.audioRecorder=RecordRTC(n.stream,{type:"audio"})):(t.video&&(n.videoRecorder=RecordRTC(n.stream,{type:"video"})),t.audio&&(n.audioRecorder=RecordRTC(n.stream,{type:"audio"})))),n.audioRecorder&&n.audioRecorder.startRecording(),void(n.videoRecorder&&n.videoRecorder.startRecording())):y(n.rtcMultiConnection.resources.RecordRTC,function(){n.startRecording(t)})},i.stopRecording=function(e,t){t||(t={audio:!0,video:!0}),r(t)&&(t={audio:"audio"==t,video:"video"==t}),m("stopped recording session",t);var n=this;t.audio&&n.audioRecorder?n.audioRecorder.stopRecording(function(){t.video&&n.videoRecorder?n.videoRecorder.stopRecording(function(){e({audio:n.audioRecorder.getBlob(),video:n.videoRecorder.getBlob()})}):e({audio:n.audioRecorder.getBlob()})}):t.video&&n.videoRecorder&&n.videoRecorder.stopRecording(function(){e({video:n.videoRecorder.getBlob()})})},i.takeSnapshot=function(t){w({mediaElement:this.mediaElement,userid:this.userid,connection:e,callback:t})},i.streamObject=i,i},e.set=function(e){for(var t in e)this[t]=e[t];return this},e.onMediaError=function(e){l("name",e.name),l("constraintName",f(e.constraintName)),l("message",e.message),l("original session",e.session)},e.takeSnapshot=function(t,n){w({userid:t,connection:e,callback:n})},e.saveToDisk=function(e,t){e.size&&e.type?me.SaveToDisk(URL.createObjectURL(e),t||e.name||e.type.replace("/","-")+e.type.split("/")[1]):me.SaveToDisk(e,t)},e.selectDevices=function(t,n){function i(t){t&&(e._mediaSources[t.kind]=t.id)}t&&i(this.devices[t]),n&&i(this.devices[n])},e.getDevices=function(t){return DetectRTC.MediaDevices.length?(DetectRTC.MediaDevices.forEach(function(t){e.devices[t.deviceId]=t}),void(t&&t(e.devices))):setTimeout(function(){e.getDevices(t)},1e3)},e.getMediaDevices=e.enumerateDevices=function(t){if(!t)throw"callback is mandatory.";e.getDevices(function(){t(e.DetectRTC.MediaDevices)})},e.onCustomMessage=function(e){m("Custom message",e)},e.ondrop=function(e){m("Media connection is dropped by "+e)},e.drop=function(t){t=t||{},e.attachStreams=[];for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],"local"==n.type?(e.detachStreams.push(n.streamid),g(n,e)):g(n,e));e.sendCustomMessage({drop:!0,dontRenegotiate:o(t.renegotiate)?!0:t.renegotiate})},e.Translator={TranslateText:function(t,n){var i=document.createElement("script");i.type="text/javascript";var o=encodeURIComponent(t),r="method"+e.token();window[r]=function(e){e.data&&e.data.translations[0]&&n&&n(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"==e.error.message&&(p('Text translation failed. Error message: "Daily Limit Exceeded."'),n(t))};var s="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+o;i.src=s,document.getElementsByTagName("head")[0].appendChild(i)}},e.setDefaultEventsForMediaElement=function(t,n){t.onpause=function(){e.streams[n]&&!e.streams[n].muted&&e.streams[n].mute()},t.onplay=function(){e.streams[n]&&e.streams[n].muted&&e.streams[n].unmute()};var i=!1;t.onvolumechange=function(){i||(i=!0,e.streams[n]&&setTimeout(function(){var o=e.streams[n];e.streams[n].sockets.forEach(function(e){e.send({streamid:o.streamid,isVolumeChanged:!0,volume:t.volume})}),i=!1},2e3))}},e.onMediaFile=function(t){m("onMediaFile",t),e.body.appendChild(t.mediaElement)},e.shareMediaFile=function(t,n,i){return i=i||e.token(),PreRecordedMediaStreamer?PreRecordedMediaStreamer.shareMediaFile({file:t,video:n,streamerid:i,connection:e}):(y(e.resources.PreRecordedMediaStreamer,function(){e.shareMediaFile(t,n,i)}),i)},e.onpartofscreen=function(t){var n=document.createElement("img");n.src=t.screenshot,e.body.appendChild(n)},e.skipLogs=function(){m=l=p=function(){}},e.hold=function(t){for(var n in e.peers)e.peers[n].hold(t)},e.onhold=function(t){m("onhold",t),"audio"!=t.kind&&(t.mediaElement.pause(),t.mediaElement.setAttribute("poster",t.screenshot||e.resources.muted)),"audio"==t.kind&&(t.mediaElement.muted=!0)},e.unhold=function(t){for(var n in e.peers)e.peers[n].unhold(t)},e.onunhold=function(e){m("onunhold",e),"audio"!=e.kind&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),"audio"!=e.kind&&(e.mediaElement.muted=!1)},e.sharePartOfScreen=function(t){function n(){(!e.partOfScreen||e.partOfScreen.sharing)&&k({element:t.element,connection:e,callback:function(o){if(o!=i){i=o;for(var r in e.channels)e.channels[r].send({screenshot:o,isPartOfScreen:!0})}!t.once&&setTimeout(n,t.interval||200)}})}var i="";n(),e.partOfScreen=b({sharing:!0},t)},e.pausePartOfScreenSharing=function(){for(var t in e.peers)e.peers[t].pausePartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.resumePartOfScreenSharing=function(){for(var t in e.peers)e.peers[t].pausePartOfScreenSharing=!1;e.partOfScreen&&(e.partOfScreen.sharing=!0)},e.stopPartOfScreenSharing=function(){for(var t in e.peers)e.peers[t].stopPartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.takeScreenshot=function(t,n){if(!t||!n)throw"Invalid number of arguments.";if(!window.html2canvas)return y(e.resources.html2canvas,function(){e.takeScreenshot(t)});if(r(t)&&(t=document.querySelector(t),t||(t=document.getElementById(t))),!t)throw"HTML Element is inaccessible!";html2canvas(t,{onrendered:function(e){n(e.toDataURL())}})},e.onScreenCapturingExtensionAvailable=function(){m("It seems that screen capturing extension is installed and available on your system!")},!j&&DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable=function(){e.onScreenCapturingExtensionAvailable()}),e.changeBandwidth=function(t){for(var n in e.peers)e.peers[n].changeBandwidth(t)},e.convertToAudioStream=function(e){t(e)},e.onstatechange=function(e){m("on:state:change ("+e.userid+"):",e.name+":",e.reason||"")},e.onfailed=function(e){e.peer.numOfRetries||(e.peer.numOfRetries=0),e.peer.numOfRetries++,l("ICE connectivity check is failed. Renegotiating peer connection."),e.peer.numOfRetries<2&&e.peer.renegotiate(),e.peer.numOfRetries>=2&&(e.peer.numOfRetries=0)},e.onconnected=function(e){m("Peer connection has been established between you and",e.userid),getdata(),m("Peer connection has been established between "+participants+"(you) and",e.userid);var t=e.userid,n=t.split("-",1);participants.split("-",1);-1===array.indexOf(participants+" , ")?array.push(participants+" , "):J.log("This item already exists"+participants),-1===array.indexOf(n+" , ")?array.push(n+" , "):J.log("This item already exists"+n),customFunctionForUpdateList(),customFunctionForUserCount()},e.ondisconnected=function(t){l("Peer connection seems has been disconnected between you and",t.userid),l("Peer connection seems has been disconnected between "+participants+" you and",t.userid);var n=t.userid,i=n.split("-",1);myDelete(i+" , "),customFunctionForUpdateList(),customFunctionForUserCount(),$("#a").show(),$("#a").html("A Network Problem Occured. "+i[0]+" Reconnecting..."),setTimeout(function(){$("#a").html(" ")},5e3),e.peers["user-id"].renegotiate(),s(e.channels)||e.channels[t.userid]&&(e.channels[t.userid].send({checkingPresence:!0}),setTimeout(function(){return e.peers[t.userid].connected?void delete e.peers[t.userid].connected:(e.streams.remove({remote:!0,userid:t.userid}),void e.remove(t.userid))},3e3))},e.onstreamid=function(e){m("got remote streamid",e.streamid,"from",e.userid);var t=e.streamid.split("-",1);-1===array.indexOf(t+" , ")?array.push(t+" , "):J.log("This item already exists"),customFunctionForUpdateList(),customFunctionForUserCount()},e.stopMediaStream=function(t){if(!t)throw"MediaStream argument is mandatory.";if(e.keepStreamsOpened)return void(t.onended&&t.onended());e.localStreams[t.streamid]&&delete e.localStreams[t.streamid],N&&t.onended&&t.onended();var n=Boolean((t.getAudioTracks||t.getVideoTracks)&&(t.getAudioTracks()[0]&&!t.getAudioTracks()[0].stop||t.getVideoTracks()[0]&&!t.getVideoTracks()[0].stop));return!t.getAudioTracks||n?void(t.stop&&t.stop()):(t.getAudioTracks().length&&t.getAudioTracks()[0].stop&&t.getAudioTracks().forEach(function(e){e.stop()}),void(t.getVideoTracks().length&&t.getVideoTracks()[0].stop&&t.getVideoTracks().forEach(function(e){e.stop()})))},e.changeBandwidth=function(t){if(!t||r(t)||s(t))throw'Invalid "bandwidth" arguments.';u(e.peers,function(e){e.peer.bandwidth=t}),e.renegotiate()},e.openSignalingChannel=function(t){if(!window.Firebase)return y(e.resources.firebase,function(){e.openSignalingChannel(t)});var n=t.channel||e.channel;e.firebase&&(e.resources.firebaseio=e.resources.firebaseio.replace("//chat.","//"+e.firebase+"."));var i=new Firebase(e.resources.firebaseio+n);i.channel=n,i.on("child_added",function(e){t.onmessage(e.val())}),i.send=function(e){for(var t in e)(o(e[t])||"function"==typeof e[t])&&(e[t]=!1);this.push(e)},e.socket||(e.socket=i),i.onDisconnect().remove(),setTimeout(function(){t.callback(i)},1)},e.Plugin=ie}window.RMCDefaultChannel=location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""),window.RTCMultiConnection=function(a){function d(t){return Y&&x(),w?t():void(w=new e(k,t))}function u(e,t){if(r(e)&&(k.skipOnNewSession=!0),!w)return m("Signaling channel is not ready. Connecting..."),void d(function(){m("Signaling channel is connected. Joining the session again..."),setTimeout(function(){u(e,t)},1e3)});if(r(e)){if(!k.sessionDescriptions[e])return setTimeout(function(){m("Session-Descriptions not found. Rechecking.."),u(e,t)},1e3);e=k.sessionDescriptions[e]}if(t)return h(function(){e.oneway=!0,u(e)},t);if(!e||!e.userid||!e.sessionid){n("missing arguments",arguments);var n='Invalid data passed over "connection.join" method.';throw k.onstatechange({userid:"browser",extra:{},name:"Unexpected data detected.",reason:n}),n}k.dontOverrideSession||(k.session=e.session);var o=k.extra||e.extra||{};e.oneway||i(e)?w.joinSession(e,o):h(function(){w.joinSession(e,o)})}function h(e,t,n){function o(n){if(n.data&&n.data.chromeMediaSourceId){window.removeEventListener("message",o);var i=n.data.chromeMediaSourceId;if(DetectRTC.screen.sourceId=i,DetectRTC.screen.chromeMediaSource="desktop","PermissionDeniedError"==i){var r={message:"https:"==location.protocol?"User denied to share content of his screen.":ee,
name:"PermissionDeniedError",constraintName:u,session:d};return ae.mutex=!1,DetectRTC.screen.sourceId=null,k.onMediaError(r)}h(e,t)}n.data&&n.data.chromeExtensionStatus&&(p("Screen capturing extension status is:",n.data.chromeExtensionStatus),DetectRTC.screen.chromeMediaSource="screen",h(e,t,!0))}function a(t,n,i,o){if(k.onstatechange({userid:"browser",extra:{},name:"fetching-usermedia",reason:"About to capture user-media with constraints: "+f(t)}),k.preventSSLAutoAllowed&&!o&&_)return navigator.customGetUserMediaBar?void navigator.customGetUserMediaBar(t,function(){a(t,n,i,!0)},function(){k.onMediaError({name:"PermissionDeniedError",message:"User denied permission.",constraintName:t,session:d})}):void y(k.resources.customGetUserMediaBar,function(){a(t,n,i,o)});var s={onsuccess:function(e,o,r,s){S(e,o,r,s,t,n,i,u,c,d)},onerror:function(t,n){if(N&&"PERMISSION_DENIED"==t&&(t={message:"",name:"PermissionDeniedError",constraintName:n,session:d}),N&&n.video&&n.video.mozMediaSource)return i={message:Z,name:t.name||"PermissionDeniedError",constraintName:n,session:d},void k.onMediaError(i);if(r(t))return k.onMediaError({message:"Unknown Error",name:t,constraintName:n,session:d});if(t.name&&("PermissionDeniedError"==t.name||"DevicesNotFoundError"==t.name)){var i="Either: ";i+="\n Media resolutions are not permitted.",i+="\n Another application is using same media device.",i+="\n Media device is not attached or drivers not installed.",i+="\n You denied access once and it is still denied.",t.message&&t.message.length&&(i+="\n "+t.message),i={message:i,name:t.name,constraintName:n,session:d},k.onMediaError(i),_&&(d.audio||d.video)&&DetectRTC.load(function(){d.audio&&!DetectRTC.hasMicrophone&&(p("It seems that you have no microphone attached to your device/system."),d.audio=d.audio=!1,d.video||(alert("It seems that you are capturing microphone and there is no device available or access is denied. Reloading..."),location.reload())),d.video&&!DetectRTC.hasWebcam&&(p("It seems that you have no webcam attached to your device/system."),d.video=d.video=!1,d.audio||(alert("It seems that you are capturing webcam and there is no device available or access is denied. Reloading..."),location.reload())),DetectRTC.hasMicrophone||DetectRTC.hasWebcam?k.getUserMediaPromptedOnce||(k.getUserMediaPromptedOnce=!0,h(e,d)):(alert("It seems that either both microphone/webcam are not available or access is denied. Reloading..."),location.reload())})}if(t.name&&"ConstraintNotSatisfiedError"==t.name){var i="Either: ";i+="\n You are prompting unknown media resolutions.",i+="\n You are using invalid media constraints.",t.message&&t.message.length&&(i+="\n "+t.message),i={message:i,name:t.name,constraintName:n,session:d},k.onMediaError(i)}d.screen&&(N?l(Z):"https:"!==location.protocol?H||"file:"!=location.protocol&&"http:"!=location.protocol||l("You cannot use HTTP or file protocol for screen capturing. You must either use HTTPs or chrome extension page or Node-Webkit page."):l('Unable to detect actual issue. Maybe "deprecated" screen capturing flag was not set using command line or maybe you clicked "No" button or maybe chrome extension returned invalid "sourceId". Please install chrome-extension: http://bit.ly/webrtc-screen-extension')),ae.mutex=!1;var o=JSON.stringify(n);ae.streams[o]&&delete ae.streams[o]},mediaConstraints:k.mediaConstraints||{}};s.constraints=t||c,s.connection=k,D(s)}var d=t||k.session;if(s(d))return void(e&&e());if(k.dontCaptureUserMedia)return e();if(i(d)||!k.isInitiator&&d.oneway)return k.attachStreams=[],e();var c={audio:d.audio?{mandatory:{},optional:[{chromeRenderToAssociatedSink:!0}]}:!1,video:!!d.video};if(k._mediaSources.audio&&c.audio.optional.push({sourceId:k._mediaSources.audio}),k._mediaSources.audiooutput&&c.audio.optional.push({sourceId:k._mediaSources.audiooutput}),k._mediaSources.audioinput&&c.audio.optional.push({sourceId:k._mediaSources.audioinput}),k._mediaSources.video&&(c.video={optional:[{sourceId:k._mediaSources.video}]}),k._mediaSources.videoinput&&(c.video={optional:[{sourceId:k._mediaSources.videoinput}]}),!d.screen&&!c.audio&&!c.video)return e();var u={audio:!1,video:{mandatory:{chromeMediaSource:DetectRTC.screen.chromeMediaSource,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]}};if(N&&d.screen){if("https:"!==location.protocol)return l(ee);p(Z),u.video={mozMediaSource:"window",mediaSource:"window"},c.audio&&(u.audio=!0,c={}),delete u.video.chromeMediaSource}if(d.screen){if(_&&DetectRTC.screen.extensionid!=te&&(ne=!0),_&&!ne&&!n&&!DetectRTC.screen.sourceId)return P("message",o),Y||x(),void Y.postMessage();if(_&&ne&&!n&&"screen"==DetectRTC.screen.chromeMediaSource&&DetectRTC.screen.extensionid)return DetectRTC.screen.extensionid==te&&-1==document.domain.indexOf("webrtc-experiment.com")?h(e,t,!0):(m("checking if chrome extension is installed."),void DetectRTC.screen.getChromeExtensionStatus(function(n){"installed-enabled"==n&&(DetectRTC.screen.chromeMediaSource="desktop"),h(e,t,!0),m("chrome extension is installed?","desktop"==DetectRTC.screen.chromeMediaSource)}));if(_&&ne&&"desktop"==DetectRTC.screen.chromeMediaSource&&!DetectRTC.screen.sourceId)return void DetectRTC.screen.getSourceId(function(n){if("PermissionDeniedError"==n){var i={message:"User denied to share content of his screen.",name:"PermissionDeniedError",constraintName:u,session:d};return ae.mutex=!1,DetectRTC.screen.chromeMediaSource="desktop",k.onMediaError(i)}return"No-Response"==n?(l("Chrome extension seems not available. Make sure that manifest.json#L16 has valid content-script matches pointing to your URL."),DetectRTC.screen.chromeMediaSource="screen",h(e,t,!0)):void h(e,t,!0)});_&&"desktop"==DetectRTC.screen.chromeMediaSource&&(u.video.mandatory.chromeMediaSourceId=DetectRTC.screen.sourceId);var v=R;a(u,c.audio||c.video?function(){v&&(R=!0),a(c,e)}:e)}else a(c,e,d.audio&&!d.video)}function S(e,i,o,r,s,a,d,u,m,l){r||(r=n()),k.onstatechange({userid:"browser",extra:{},name:"usermedia-fetched",reason:"Captured user media using constraints: "+f(s)}),d&&(e=t(e)),k.localStreamids.push(r),e.onended=function(){h.mediaElement&&!h.mediaElement.parentNode&&document.getElementById(e.streamid)&&(h.mediaElement=document.getElementById(e.streamid)),k.attachStreams.forEach(function(t,n){t==e&&(delete k.attachStreams[n],k.attachStreams=c(k.attachStreams))}),g(h,k),k.streams[r]&&k.removeStream(r);var t=k.streams[r];t&&t.sockets.length&&t.sockets.forEach(function(e){e.send({streamid:t.streamid,stopped:!0})}),ae.mutex=!1,ae.streams[o]&&delete ae.streams[o],DetectRTC.screen.sourceId=null},B||(e.streamid=r,e.isScreen=s==u,e.isVideo=s==m&&!!m.video,e.isAudio=s==m&&!!m.audio&&!m.video,e.preMuted={audio:e.getAudioTracks().length&&!e.getAudioTracks()[0].enabled,video:e.getVideoTracks().length&&!e.getVideoTracks()[0].enabled});var p=v(e,l);p.muted=!0;var h={stream:e,streamid:r,mediaElement:p,blobURL:p.mozSrcObject?URL.createObjectURL(e):p.src,type:"local",userid:k.userid,extra:k.extra,session:l,isVideo:!!e.isVideo,isAudio:!!e.isAudio,isScreen:!!e.isScreen,isInitiator:!!k.isInitiator,rtcMultiConnection:k};R&&k.attachStreams.push(e),R=!1,k.streams[r]=k._getStream(h),i||k.onstream(h),k.setDefaultEventsForMediaElement&&k.setDefaultEventsForMediaElement(p,r),a&&a(e,h),k.onspeaking&&M({stream:e,streamedObject:h,connection:k})}var w,k=this;k.channel=a||RMCDefaultChannel,k.isAcceptNewSession=!0,k.open=function(e){k.isAcceptNewSession=!1,k.isInitiator=!0;var t=!1;return e&&(r(e)?k.sessionid=e:(o(e.transmitRoomOnce)||(k.transmitRoomOnce=e.transmitRoomOnce),o(e.dontTransmit)||(t=e.dontTransmit),o(e.sessionid)||(k.sessionid=e.sessionid))),k.socket&&k.socket.remove&&k.socket.remove(),k.sessionid||(k.sessionid=k.channel),k.sessionDescription={sessionid:k.sessionid,userid:k.userid,session:k.session,extra:k.extra},k.sessionDescriptions[k.sessionDescription.sessionid]||(k.numberOfSessions++,k.sessionDescriptions[k.sessionDescription.sessionid]=k.sessionDescription),d(function(){w.captureUserMediaOnDemand=e?!!e.captureUserMediaOnDemand:!1,e&&e.onMediaCaptured&&(k.onMediaCaptured=e.onMediaCaptured),w.captureUserMediaOnDemand||h(function(){w.initSession({sessionDescription:k.sessionDescription,dontTransmit:t}),C(k)}),w.captureUserMediaOnDemand&&w.initSession({sessionDescription:k.sessionDescription,dontTransmit:t})}),k.sessionDescription},k.connect=function(e){return e&&(k.sessionid=e),d(function(){m("Signaling channel is ready.")}),this},k.join=u,k.send=function(e,t){if(k.numberOfConnectedUsers<=0)return void setTimeout(function(){k.send(e,t)},1e3);if(!e)throw"No file, data or text message to share.";if(e instanceof Array&&!o(e[0].size)&&!o(e[0].type))for(var n=0;n<e.length;n++)e[n].size&&e[n].type&&k.send(e[n],t);else if(o(e.size)||o(e.type))le.send({text:e,channel:w,_channel:t,connection:k});else{if(!k.enableFileSharing)throw'"enableFileSharing" boolean MUST be "true" to support file sharing.';if(!w.fileBufferReader)return void T(k,function(n){w.fileBufferReader=n,k.send(e,t)});var i=b({userid:k.userid},e.extra||k.extra);w.fileBufferReader.readAsArrayBuffer(e,function(e){w.fileBufferReader.getNextChunk(e,function(e,n,i){t?t.send(e):w.send(e)})},i)}},k.disconnect=function(){w&&w.disconnect(),w=null};var R=!0;k.captureUserMedia=h,k.leave=function(e){return w?(R=!0,e?void k.eject(e):void w.leave()):void 0},k.eject=function(e){if(!k.isInitiator)throw"Only session-initiator can eject a user.";if(!k.peers[e])throw"You ejected invalid user.";k.peers[e].sendCustomMessage({ejected:!0})},k.close=function(){k.autoCloseEntireSession=!0,k.leave()},k.renegotiate=function(e,t){return k.numberOfConnectedUsers<=0?void setTimeout(function(){k.renegotiate(e,t)},1e3):void w.addStream({renegotiate:t||b({oneway:!0},k.session),stream:e})},k.attachExternalStream=function(e,t){var n={};e.getAudioTracks&&e.getAudioTracks().length&&(n.audio=!0),e.getVideoTracks&&e.getVideoTracks().length&&(n.video=!0);var i={video:{chromeMediaSource:"fake"}},o=t?i:n;S(e,!1,"",null,o,!1,!1,i,n,n)},k.addStream=function(e,t){function n(n){w.addStream({stream:n,renegotiate:e||k.session,socket:t})}if(k.numberOfConnectedUsers<=0)return void setTimeout(function(){k.addStream(e,t)},1e3);if(e){var i;!k.isInitiator&&e.oneway&&(e.oneway=!1,i=!0),h(function(t){i&&(e.oneway=!0),n(t)},e)}else n()},k.removeStream=function(e,t){function n(e,t){t.local&&"local"!=e.type||t.remote&&"remote"!=e.type||(t.screen&&e.isScreen&&k.detachStreams.push(e.streamid),t.audio&&e.isAudio&&k.detachStreams.push(e.streamid),t.video&&e.isVideo&&k.detachStreams.push(e.streamid),t.audio||t.video||t.screen||k.detachStreams.push(e.streamid),-1!=k.detachStreams.indexOf(e.streamid)&&(m("removing stream",e.streamid),g(e,k),t.stop&&k.stopMediaStream(e.stream)))}if(k.numberOfConnectedUsers<=0)return void setTimeout(function(){k.removeStream(e,t)},1e3);if(e||(e="all"),!r(e)||-1!=e.search(/all|audio|video|screen/gi)){for(var i in k.streams)if(-1==k._skip.indexOf(i))if(_stream=k.streams[i],"all"==e)n(_stream,{audio:!0,video:!0,screen:!0});else if(r(e)){var o={};o[e]=!0,n(_stream,o)}else n(_stream,e);return void(!t&&k.detachStreams.length&&k.renegotiate())}var i=k.streams[e];return i?(k.detachStreams.push(i.streamid),m("removing stream",i.streamid),g(i,k),void(t||k.renegotiate())):p("No such stream exists. Stream-id:",e)},k.switchStream=function(e){return k.numberOfConnectedUsers<=0?void setTimeout(function(){k.switchStream(e)},1e3):(k.removeStream("all",!0),void k.addStream(e))},k.sendCustomMessage=function(e){return w&&w.defaultSocket?void w.defaultSocket.send({customMessage:!0,message:e}):setTimeout(function(){k.sendCustomMessage(e)},1e3)},U(k)};var F=[],L=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,N="undefined"!=typeof window.InstallTrigger,V=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,_=!!window.chrome&&!L,B=!!document.documentMode,j=V||B,W=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),H=!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]);window.MediaStream=window.MediaStream||window.webkitMediaStream,window.AudioContext=window.AudioContext||window.webkitAudioContext;var z=50,q=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);_&&q&&q[2]&&(z=parseInt(q[2],10));var G=50;q=navigator.userAgent.match(/Firefox\/(.*)/),N&&q&&q[1]&&(G=parseInt(q[1],10));var J=window.console||{log:function(){},error:function(){},warn:function(){}};if(_||N||V)var m=J.log.bind(J),l=J.error.bind(J),p=J.warn.bind(J);var Y,K,Q={},X={},Z='Make sure that you are using Firefox Nightly and you enabled: media.getusermedia.screensharing.enabled flag from about:config page. You also need to add your domain in "media.getusermedia.screensharing.allowed_domains" flag. If you are using WinXP then also enable "media.getusermedia.screensharing.allow_on_old_platforms" flag. NEVER forget to use "only" HTTPs for screen capturing!',ee="HTTPs i.e. SSL-based URI is mandatory to use screen capturing.",te="ajhifddimkapgcifgcodmmfdlknahffk",ne=-1!=document.domain.indexOf("webrtc-experiment.com");attachEventListener=function(e,t,n,i){e.addEventListener(t,n,i)};var ie=window.PluginRTC||{};window.onPluginRTCInitialized=function(e){ie=e,MediaStreamTrack=ie.MediaStreamTrack,re=ie.RTCPeerConnection,ue=ie.RTCIceCandidate,ce=ie.RTCSessionDescription,m(j?"Java-Applet":"ActiveX","plugin has been loaded.")},s(ie)||window.onPluginRTCInitialized(ie),j&&y("https://cdn.webrtc-experiment.com/Plugin.EveryWhere.js");var oe=window.MediaStream;"undefined"==typeof oe&&"undefined"!=typeof webkitMediaStream&&(oe=webkitMediaStream),"undefined"==typeof oe||"stop"in oe.prototype||(oe.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop()}),this.getVideoTracks().forEach(function(e){e.stop()})});var re,se={mandatory:{},optional:[]},ae={streams:[],mutex:!1,queueRequests:[]},de=function(){function e(e){var i=[];return i.push(t("stun:stun.l.google.com:19302")),i.push(n("stun:webrtcweb.com:7788","muazkh","muazkh")),i.push(n("turn:webrtcweb.com:7788","muazkh","muazkh")),i.push(n("turn:webrtcweb.com:8877","muazkh","muazkh")),i.push(n("turns:webrtcweb.com:7788","muazkh","muazkh")),i.push(n("turns:webrtcweb.com:8877","muazkh","muazkh")),i.push(n("stun:webrtcweb.com:4455","muazkh","muazkh")),i.push(n("turn:webrtcweb.com:4455","muazkh","muazkh")),i.push(n("turn:webrtcweb.com:5544?transport=tcp","muazkh","muazkh")),i}function t(e){var t="urls";"undefined"!=typeof j&&(t="url");var n={};return n[t]=e,n}function n(e,t,n){var i="urls";"undefined"!=typeof j&&(i="url");var o={username:t,credential:n};return o[i]=e,o}return{getIceServers:e}}(),ce=window.RTCSessionDescription||window.mozRTCSessionDescription,ue=window.RTCIceCandidate||window.mozRTCIceCandidate;"undefined"!=typeof mozRTCPeerConnection?re=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection?re=webkitRTCPeerConnection:"undefined"!=typeof window.RTCPeerConnection?re=window.RTCPeerConnection:J.error("WebRTC 1.0 (RTCPeerConnection) API seems NOT available in this browser.");var me={SaveToDisk:A},le={send:function(e){function t(e,n){var r={type:"text",uuid:m,sendingTime:l};e&&(n=e,r.packets=parseInt(n.length/d)),n.length>d?r.message=n.slice(0,d):(r.message=n,r.last=!0,r.isobject=u),o.send(r,s),c=n.slice(r.message.length),c.length&&setTimeout(function(){t(null,c)},i.chunkInterval||100)}var i=e.connection;if(e.text instanceof ArrayBuffer||e.text instanceof DataView)return e.channel.send(e.text,e._channel);var o=e.channel,s=e._channel,a=e.text,d=i.chunkSize||1e3,c="",u=!1;r(a)||(u=!0,a=JSON.stringify(a));var m=n(),l=(new Date).getTime();t(a)}};!function(){"use strict";function e(){var e,t,n,i=(o.appVersion,o.userAgent),r=o.appName,a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10);return-1!==(t=i.indexOf("Opera"))?(r="Opera",a=i.substring(t+6),-1!==(t=i.indexOf("Version"))&&(a=i.substring(t+8))):-1!==(t=i.indexOf("MSIE"))?(r="IE",a=i.substring(t+5)):-1!==(t=i.indexOf("Chrome"))?(r="Chrome",a=i.substring(t+7)):-1!==(t=i.indexOf("Safari"))?(r="Safari",a=i.substring(t+7),-1!==(t=i.indexOf("Version"))&&(a=i.substring(t+8))):-1!==(t=i.indexOf("Firefox"))?(r="Firefox",a=i.substring(t+8)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(r=i.substring(e,t),a=i.substring(t+1),r.toLowerCase()===r.toUpperCase()&&(r=o.appName)),s&&(r="Edge",a=parseInt(o.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10)),-1!==(n=a.indexOf(";"))&&(a=a.substring(0,n)),-1!==(n=a.indexOf(" "))&&(a=a.substring(0,n)),d=parseInt(""+a,10),isNaN(d)&&(a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10)),{fullVersion:a,version:d,name:r}}function t(e){n(function(t){e(t.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+t:"Public: "+t)})}function n(e){function t(t){var i=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,o=i.exec(t)[1];void 0===n[o]&&e(o),n[o]=!0}var n={},i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,o=!!window.webkitRTCPeerConnection;if(!i){var r=document.getElementById("iframe");if(!r)throw"NOTE: you need to have an iframe in the page right above the script tag.";var s=r.contentWindow;i=s.RTCPeerConnection||s.mozRTCPeerConnection||s.webkitRTCPeerConnection,o=!!s.webkitRTCPeerConnection}var a,d={optional:[{RtpDataChannels:!0}]};o&&(a={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},"undefined"!=typeof v&&v.browser.isFirefox&&v.browser.version<=38&&(a[0]={url:a[0].urls}));var c=new i(a,d);c.onicecandidate=function(e){e.candidate&&t(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&t(e)})},1e3)}function i(e){return!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices?(m=[],void o.enumerateDevices(function(t){t.forEach(function(e){var t={};for(var n in e)t[n]=e[n];var i;m.forEach(function(e){e.id===t.id&&(i=!0)}),i||("audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label||(t.label="Please invoke getUserMedia once.",g||(t.label="HTTPs is required to get label of this "+t.kind+" device.")),("audioinput"===t.kind||"audio"===t.kind)&&(p=!0),"audiooutput"===t.kind&&(f=!0),("videoinput"===t.kind||"video"===t.kind)&&(h=!0),m.push(t))}),"undefined"!=typeof v&&(v.MediaDevices=m,v.hasMicrophone=p,v.hasSpeakers=f,v.hasWebcam=h),e&&e()})):void(e&&e())}var o=window.navigator;o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){o.mediaDevices.enumerateDevices().then(e)}),"undefined"!=typeof o?("undefined"!=typeof o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),"undefined"!=typeof o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){}};var r=!!o.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),s=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),a={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return a.Android()||a.BlackBerry()||a.iOS()||a.Opera()||a.Windows()},getOsName:function(){var e="Unknown OS";return a.Android()&&(e="Android"),a.BlackBerry()&&(e="BlackBerry"),a.iOS()&&(e="iOS"),a.Opera()&&(e="Opera Mini"),a.Windows()&&(e="Windows"),e}},d="Unknown OS";a.any()?d=a.getOsName():(-1!==o.appVersion.indexOf("Win")&&(d="Windows"),-1!==o.appVersion.indexOf("Mac")&&(d="MacOS"),-1!==o.appVersion.indexOf("X11")&&(d="UNIX"),-1!==o.appVersion.indexOf("Linux")&&(d="Linux"));var c=!1,u=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(c=!0),e in document.createElement("video")&&(u=!0)});var m=[],l=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?l=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(l=!0);var p=l,f=l,h=l;i();var v={};v.browser=e(),v.browser["is"+v.browser.name]=!0;var g="https:"===location.protocol,S=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){e in window&&(S=!0)}),v.isWebRTCSupported=S,v.isORTCSupported="undefined"!=typeof RTCIceGatherer;var w=!1;v.browser.isChrome&&v.browser.version>=35?w=!0:v.browser.isFirefox&&v.browser.version>=34&&(w=!0),g||(w=!1),v.isScreenCapturingSupported=w;var C={};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){C.isSupported&&C.isCreateMediaStreamSourceSupported||e in window&&(C.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(C.isCreateMediaStreamSourceSupported=!0))}),v.isAudioContextSupported=C.isSupported,v.isCreateMediaStreamSourceSupported=C.isCreateMediaStreamSourceSupported;var b=!1;v.browser.isChrome&&v.browser.version>31&&(b=!0),v.isRtpDataChannelsSupported=b;var y=!1;if(v.browser.isFirefox&&v.browser.version>28?y=!0:v.browser.isChrome&&v.browser.version>25?y=!0:v.browser.isOpera&&v.browser.version>=11&&(y=!0),v.isSctpDataChannelsSupported=y,v.isMobileDevice=r,v.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,v.isWebSocketsBlocked="Checking",v.isWebSocketsSupported){var k=new WebSocket("wss://echo.websocket.org:443/");k.onopen=function(){v.isWebSocketsBlocked=!1,v.loadCallback&&v.loadCallback()},k.onerror=function(){v.isWebSocketsBlocked=!0,v.loadCallback&&v.loadCallback()}}var T=!1;o.getUserMedia?T=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(T=!0),v.browser.isChrome&&v.browser.version>=47&&!g&&(v.isGetUserMediaSupported="Requires HTTPs"),v.isGetUserMediaSupported=T,v.osName=d,v.isCanvasSupportsStreamCapturing=c,v.isVideoSupportsStreamCapturing=u,v.DetectLocalIPAddress=t,v.load=function(e){this.loadCallback=e,i(e)},v.MediaDevices=m,v.hasMicrophone=p,v.hasSpeakers=f,v.hasWebcam=h;var x=!1;"setSinkId"in document.createElement("video")&&(x=!0),v.isSetSinkIdSupported=x;var R=!1;v.browser.isFirefox?"getSenders"in mozRTCPeerConnection.prototype&&(R=!0):v.browser.isChrome&&"getSenders"in webkitRTCPeerConnection.prototype&&(R=!0),v.isRTPSenderReplaceTracksSupported=R;var M=!1;v.browser.isFirefox&&v.browser.version>38&&(M=!0),v.isRemoteStreamProcessingSupported=M;var D=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(D=!0),v.isApplyConstraintsSupported=D;var O=!1;v.browser.isFirefox&&v.browser.version>=43&&(O=!0),v.isMultiMonitorScreenCapturingSupported=O,window.DetectRTC=v}();var pe;DetectRTC.screen={chromeMediaSource:"screen",extensionid:te,getSourceId:function(e){function t(t){return"installed-enabled"==t?(pe=e,void window.postMessage("get-sourceId","*")):(DetectRTC.screen.chromeMediaSource="screen",void e("No-Response"))}if(!e)throw'"callback" parameter is mandatory.';DetectRTC.screen.status?t(DetectRTC.screen.status):DetectRTC.screen.getChromeExtensionStatus(t)},onMessageCallback:function(e){if(r(e)||e.sourceId){if(m("chrome message",e),"PermissionDeniedError"==e){if(DetectRTC.screen.chromeMediaSource="PermissionDeniedError",pe)return pe("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(DetectRTC.screen.chromeMediaSource="desktop",DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable(),DetectRTC.screen.onScreenCapturingExtensionAvailable=null)),e.sourceId&&(DetectRTC.screen.sourceId=e.sourceId,pe&&pe(DetectRTC.screen.sourceId))}},getChromeExtensionStatus:function(e,t){function n(e){DetectRTC.screen.status=e,t(e)}if(N)return n("not-chrome");2!=arguments.length&&(t=e,e=this.extensionid);var i=document.createElement("img");i.src="chrome-extension://"+e+"/icon.png",i.onload=function(){DetectRTC.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){n("screen"==DetectRTC.screen.chromeMediaSource?"desktop"==DetectRTC.screen.chromeMediaSource?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},i.onerror=function(){n("not-installed")}}},window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.addEventListener("message",function(e){e.origin==window.location.origin&&DetectRTC.screen.onMessageCallback(e.data)})}();